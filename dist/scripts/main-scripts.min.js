function checkLoginStatus(e,t){$.ajax({type:"POST",url:"ajax/check_login.php"}).done(function(n){var o=JSON.parse(n);o.success?e&&e():t!==!0&&(window.location="index.html?url="+encodeURIComponent(window.location))})}function logout(){confirm("If you have unsaved changes logging out will cause you to lose them. Continue?")&&$.ajax({type:"POST",url:"ajax/logout.php"}).done(function(){window.location="index.html"})}!function(){"use strict";function e(){if(t(m.value,u.value)){var e;e={fromDate:m.value,toDate:u.value,active:$("#active").is(":checked"),not_visited:$("#not-visited").is(":checked"),ty_card_not_sent:!1,signed_up_for_baptism:!1,baptized:!1,interested_in_gkids:!1,interested_in_next:!1,interested_in_ggroups:!1,interested_in_gteams:!1,interested_in_joining:!1,would_like_visit:$("#would-like-visit").is(":checked"),no_agent:!1,commitment_christ:!1,recommitment_christ:!1,commitment_tithe:!1,commitment_ministry:!1,attendance_frequency:!1},n(e)}}function t(e,t){var n="";return l(e,!0)||(n+="From Date must be a valid date<br />"),l(t,!0)||(n+="To Date must be a valid date<br />"),n?($().toastmessage("showErrorToast",n),!1):!0}function n(e){$(".address-view-form").mask("Loading..."),$.ajax({type:"POST",url:"ajax/get_report.php",data:{type:4,params:JSON.stringify(e)}}).done(function(e){var t=JSON.parse(e);t.success?(a(t.people),$(".address-view-form").unmask()):1===t.error?logout():$().toastmessage("showErrorToast","Error searching people")}).fail(function(){$().toastmessage("showErrorToast","Error searching people")})}function o(e,t){if(null===e)return"";var n="";return e.first_name||e.last_name?(e.last_name&&(n+=e.last_name),e.last_name&&e.first_name?t===!0?n+=", "+e.first_name:n=e.first_name+" "+n:e.first_name&&(n+=e.first_name+" ")):n=e.description,n}function a(e){$("#address-view-table tbody tr").remove();for(var t=0;t<e.length;t++)r(e[t])}function r(e){var t=o(e);$("#address-view-table > tbody:last").append('<tr person_id="'+e.id+'"><td data-th="Name" person_name="'+t+'"><a class="person_name" href="manage-person.html?id='+e.id+'">'+t+'</a></td><td data-th="Address">'+c(e)+'</td><td data-th="Visit" class="checkbox-table-col"><label for="visit-checkbox-'+e.id+'"><input id="visit-checkbox-'+e.id+'" class="visit-checkbox" type="checkbox" address="'+s(e)+'" /></label></td></tr>')}function i(){var e,t,n,o=$(".visit-checkbox:checked"),a=y;if(o.length>k.length)return $().toastmessage("showErrorToast","Can't show more than "+k.length+" people at once."),void 0;_.innerHTML="";for(var r=0;r<o.length;r++)n=o[r].getAttribute("address"),"OH"!==n&&""!==n&&(a+=b+k[r]+"|"+n,e=o[r].parentElement.parentElement.previousElementSibling.innerHTML,t=o[r].parentElement.parentElement.previousElementSibling.previousElementSibling.getAttribute("person_name"),_.innerHTML+=' <div class="map-legend-item"><span style="font-weight: bold;">'+k[r]+"</span> : "+t+'<br /><a href="'+g+e+'" target="_blank">'+e+"</a></div>");""!==_.innerHTML?(v.innerHTML='<img border="0" src="'+a+'" />',$("#map-legend")[0].style.setProperty("display","block"),$("#map-note")[0].style.setProperty("display","block")):(v.innerHTML="",$("#map-legend")[0].style.setProperty("display","none"),$("#map-note")[0].style.setProperty("display","none"),$().toastmessage("showWarningToast","Must select at least 1 person with an address"))}function s(e){var t="";return t+=e.street1||"",t+=" ",t+=e.street2||"",t+=" ",t+=e.city||"",t+=" ",t+=e.state||"",t+=" ",t+=e.zip||"",t.trim()}function c(e){var t="";return t+=e.street1||"",e.street1&&(t+="<br />"),t+=e.street2||"",e.street2&&(t+="<br />"),t+=e.city||"",e.city&&e.state&&(t+=","),t+=" ",t+=e.state||"",t+=" ",t+=e.zip||"",t.trim()}function l(e,t){var n=e;if(""===n)return!!t;var o=/^(\d{1,2})(\/|-)(\d{1,2})(\/|-)(\d{4})$/,a=n.match(o);if(null===a)return!1;var r=a[1],i=a[3],s=a[5];if(1>r||r>12)return!1;if(1>i||i>31)return!1;if((4==r||6==r||9==r||11==r)&&31==i)return!1;if(2==r){var c=s%4===0&&(s%100!==0||s%400===0);if(i>29||29==i&&!c)return!1}return!0}function d(e){var t=$("#address-view-table-container"),n=-1==e.target.id.indexOf("top")?t[0].scrollHeight:0;t.stop().animate({scrollTop:n},h,"swing",function(){$("<style></style>").appendTo($(document.body)).remove()})}if(0!==$(".address-view-form").length){$("#from-date").datepicker(),$("#to-date").datepicker();var u=document.querySelector("#to-date"),m=document.querySelector("#from-date"),p=document.querySelector("#go-arrow"),f=document.querySelector("#gen-map"),h=1e3,v=document.querySelector("#address-map-panel"),_=document.querySelector("#map-legend"),y="//maps.googleapis.com/maps/api/staticmap?zoom=11&size=500x500",g="https://www.google.com/maps/place/",b="&markers=color:red%7Clabel:",k=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","1","2","3","4","5","6","7","8","9","0"];$(".navigation-links a").on("click",d),p.addEventListener("click",e),f.addEventListener("click",i),checkLoginStatus()}}(),function(){"use strict";function e(){window.location="ajax/export_attendance.php"}function t(){var e=$("#service-label-1"),t=$("#service-label-2");$.each(St.service_labels,function(n,o){e.append('<option value="'+n+'">'+o+"</option>"),t.append('<option value="'+n+'">'+o+"</option>")}),t.append('<option value="">--None--</option>'),e.val(St.default_first_service_label),t.val(St.default_second_service_label),e=$("#campus"),$.each(St.campuses,function(t,n){e.append('<option value="'+t+'">'+n+"</option>")}),e.val(St.default_campus)}function n(){try{y()&&($(".attendance-form").mask("Loading..."),setTimeout(o,50))}catch(e){$(".attendance-form").unmask()}}function o(){var e,t,n,o,a,r,i,s,c=[];for(t=$("#attendance-table > tbody:last").children(),e=0;e<t.length;e++)if(null!==t[e].getAttribute("modified")){if(n=t[e].getAttribute("personId"),a=t[e].querySelector("[name=name_description]"),r=L(n),i=A(n),a){if(o=$.trim(a.value),""===o)continue}else o=void 0;-1===n.indexOf("-")&&(s=j(n),s&&(s.first=r,s.second=i)),c.push({id:n,adult:Tt,display:o,attendanceDate:R,first:r,second:i})}c.length>0||ut!=pt||mt!=ft?x(c):($(".attendance-form").unmask(),$().toastmessage("showWarningToast","No attendance was modified"))}function a(){(bt||confirm("Clear out any unsaved changes?"))&&r()}function r(){i(),m(_t)}function i(){bt=!0,$("#attendance-table > tbody:last").children().remove()}function s(){st.blur(),bt=!1;var e={id:C(),adult:!0},t=f(e,R);$("#attendance-table > tbody:last").append(t),$("[personid="+e.id+"] input:checkbox").on("change",v),$("#attendance-table-container").animate({scrollTop:$("#attendance-table-container")[0].scrollHeight},$t),$(".attendance-table-attendance-col[service=second]").css("display",at?"":"none")}function c(e){if(!e){var t=new Date,n=t.getDate()-t.getDay();e=new Date(t.setDate(n))}$("#attendance-date").datepicker("setDate",e),R=V.value,U=e,ct.innerHTML=l(e)}function l(e){return wt[e.getMonth()]+" "+e.getDate()+", "+e.getFullYear()}function d(){if(bt||confirm("If you change the date you will lose any unsaved changes. Continue?")){if(et.value==tt.value)return $().toastmessage("showErrorToast","First and Second Service cannot be the same"),void 0;U=new Date(V.value),R=V.value,i(),q(!1)}else $("#attendance-date").datepicker("setDate",U);ct.innerHTML=l($("#attendance-date").datepicker("getDate"))}function u(e){var t="#attendance-table-container",n=$(t),o=-1==e.target.id.indexOf("top")?n[0].scrollHeight:0;n.stop().animate({scrollTop:o},$t,"swing",function(){$("<style></style>").appendTo($(document.body)).remove()})}function m(e){D(),P(),$(".attendance-table-attendance-col input:checkbox").off("change"),w(),_t=e;for(var t=R,n="",o=0;o<_t.length;o++)_t[o].active==Y.checked&&(n+=p(_t[o],t));S(qt),$("#attendance-table > tbody:last").append(n),$(".attendance-table-attendance-col input:checkbox").on("change",v),H()}function p(e){J(e.id,e.last_name,e.adult);var t=e.first?"checked":"",n=e.second?"checked":"",o="",a="";return o='<a class="person_name" href="manage-person.html?id='+e.id+'">'+e.display+"</a>",at&&(Et=N(),a='<td class="attendance-table-attendance-col" service="second" data-th="Second?"><label for="'+Et+'"><input id="'+Et+'" type="checkbox" '+n+"/></label></td>"),Et=N(),'<tr adult="'+e.adult+'" personId="'+e.id+'"><td data-th="Name"><button class="attendance-history-button"><i class="fa fa-archive" /></button>'+o+'</td><td class="attendance-table-attendance-col" service="first" data-th="First?"><label for="'+Et+'"><input id="'+Et+'" type="checkbox" '+t+"/></label></td>"+a+"</tr>"}function f(e){var t="";return at&&(Et=N(),t='<td class="attendance-table-attendance-col" service="second" data-th="Second?"><label for="'+Et+'"><input id="'+Et+'" type="checkbox" /></label></td>'),Et=N(),'<tr adult="'+e.adult+'" personId="'+e.id+'" modified="true"><td data-th="Name"><input name="name_description" type="text" placeholder="Last, First or Description" /></td><td class="attendance-table-attendance-col" service="first" data-th="First?"><label for="'+Et+'"><input id="'+Et+'" type="checkbox" /></label></td>'+t+"</tr>"}function h(e){if(bt=!0,e&&0!==e.length){var t,n,o,a,r,i,s=[],c=0;for($("[personid^=-]").remove(),t=0;t<e.length;t++)_t.push(e[t]),s.push(p(e[t],R));for(t=0;t<e.length;t++){for(a=e[t],r=!1,n=0;n<_t.length;n++)if(o=_t[n],c=n,-1===M(a,o)){$(s[t]).insertBefore("[personid="+o.id+"]"),_t.splice(n,0,a),r=!0;break}r===!1&&($("#attendance-table > tbody:last").append(s[t]),_t.splice(c+1,0,a)),i=$("[personid="+a.id+"]"),i.find("a.person_name").on("click",z),i.find("button.attendance-history-button").on("click",I),i.find("input:checkbox").on("change",v)}}}function v(e){var t=e.target,n=t.parentElement.parentElement.parentElement.getAttribute("personId"),o="first"===t.parentElement.parentElement.getAttribute("service"),a=(Tt?"adult":"kid")+"_total_count",r=(Tt?"adult":"kid")+"_"+(o?"first":"second")+"_count",i=at?o?A:L:function(){return!1};bt=!1,t.parentElement.parentElement.parentElement.setAttribute("modified",!0),t.checked?(qt[r]++,i(n)||qt[a]++):(qt[r]--,i(n)||qt[a]--),_()}function _(){Tt?(xt.adult_first_count.innerHTML=qt.adult_first_count+ut,xt.adult_second_count.innerHTML=qt.adult_second_count+mt,xt.adult_total_count.innerHTML=qt.adult_total_count+ut+mt,xt.kid_first_count.innerHTML=qt.kid_first_count+ht,xt.kid_second_count.innerHTML=qt.kid_second_count+vt,xt.kid_total_count.innerHTML=qt.kid_total_count+ht+vt):(xt.adult_first_count.innerHTML=qt.adult_first_count+ht,xt.adult_second_count.innerHTML=qt.adult_second_count+vt,xt.adult_total_count.innerHTML=qt.adult_total_count+ht+vt,xt.kid_first_count.innerHTML=qt.kid_first_count+ut,xt.kid_second_count.innerHTML=qt.kid_second_count+mt,xt.kid_total_count.innerHTML=qt.kid_total_count+ut+mt),qt.total_first_count=qt.adult_first_count+qt.kid_first_count,qt.total_second_count=qt.adult_second_count+qt.kid_second_count,qt.total_total_count=qt.adult_total_count+qt.kid_total_count,xt.total_first_count.innerHTML=qt.total_first_count+ut+ht,xt.total_second_count.innerHTML=qt.total_second_count+mt+vt,xt.total_total_count.innerHTML=qt.total_total_count+ut+mt+ht+vt}function y(){var e=parseInt(lt.value||0),t=parseInt(dt.value||0),n="";return(isNaN(e)||isNaN(t))&&(n+="Visitor count must be a number"),(0>e||0>t)&&(n+="Number of visitors cannot be negative"),n?($().toastmessage("showErrorToast",n),!1):(ut=e,mt=t,_(),!0)}function g(e){$("#person-attendance-history-table > tbody:last").children().remove(),kt.dialog("open"),kt[0].querySelector("#person-name").innerHTML=O(e,!1);for(var t="",n=0;n<e.attendance.length;n++)t+=b(e.attendance[n]);$("#person-attendance-history-table > tbody:last").append(t)}function b(e){var t=e.first?"checked":"",n="";return at&&(n='<td class="attendance-table-attendance-col" service="second" data-th="Second?"><input type="checkbox" '+(e.second?"checked":"")+" disabled/></td>"),'<tr><td data-th="Date">'+e.date+'</td><td class="attendance-table-attendance-col" service="first" data-th="First?"><input type="checkbox" '+t+" disabled/></td>"+n+"</tr>"}function k(){for(var e in qt)qt.hasOwnProperty(e)&&(qt[e]=parseInt(qt[e]))}function w(){lt.value=ut=pt,dt.value=mt=ft,qt=jQuery.extend({},G);for(var e in qt)qt.hasOwnProperty(e)&&(xt[e].innerHTML=qt[e]);y()}function S(e){qt.total_first_count=qt.adult_first_count+qt.kid_first_count,qt.total_second_count=qt.adult_second_count+qt.kid_second_count,qt.total_total_count=qt.adult_total_count+qt.kid_total_count;for(var t in e)e.hasOwnProperty(t)&&(qt[t]=e[t],xt[t].innerHTML=e[t])}function E(e){$(".attendance-form").mask("Loading..."),$.ajax({type:"GET",url:"ajax/get_person_attendance.php",data:{campus:rt,label1:ot,label2:at,id:e}}).done(function(e){$(".attendance-form").unmask();var t=JSON.parse(e);t.success?(g(t.person),at?$(".attendance-table-attendance-col[service=second]").css("display",""):$(".attendance-table-attendance-col[service=second]").css("display","none")):1===t.error?logout():$().toastmessage("showErrorToast","Error loading person's attendance history")}).fail(function(){$(".attendance-form").unmask(),$().toastmessage("showErrorToast","Error loading person's attendance history")})}function T(){$(".attendance-form").mask("Loading..."),$.ajax({type:"POST",url:"ajax/get_service_options.php"}).done(function(e){var n=JSON.parse(e);n.success&&n.options?(St=n.options,t(),q()):1===n.error?logout():$().toastmessage("showErrorToast","Error loading settings")}).fail(function(){$(".attendance-form").unmask(),$().toastmessage("showErrorToast","Error loading settings")})}function q(e){"undefined"==typeof e&&(e=!0),e||$(".attendance-form").mask("Loading..."),$.ajax({type:"POST",url:"ajax/get_attendance.php",data:{date:V.value,active:Y.checked,adult:Q.checked,campus:nt.value,label1:et.value,label2:tt.value,isDefaultLoad:e}}).done(function(e){var t=JSON.parse(e);if(t.success){if(ft=0,vt=0,t.attendance_dt&&c(new Date(t.attendance_dt)),"undefined"!=typeof t.attendance_adults){var n="true"==t.attendance_adults;Q.checked=n,W.checked=!n}if("undefined"!=typeof t.attendance_active){var o="true"==t.attendance_active;Y.checked=o,B.checked=!o}"undefined"!=typeof t.campus&&(nt.value=t.campus),"undefined"!=typeof t.label1&&(et.value=t.label1),"undefined"!=typeof t.label2&&(tt.value=t.label2),Tt=Q.checked,rt=nt.value,ot=et.value,at=tt.value;var a=$("#service-label-2").val();Tt?(pt=ut=parseInt(t.visitors1.adult_visitors),ht=parseInt(t.visitors1.kid_visitors),a&&(ft=mt=parseInt(t.visitors2.adult_visitors),vt=parseInt(t.visitors2.kid_visitors))):(pt=ut=parseInt(t.visitors1.kid_visitors),ht=parseInt(t.visitors1.adult_visitors),a&&(ft=mt=parseInt(t.visitors2.kid_visitors),vt=parseInt(t.visitors2.adult_visitors))),qt=t.totals,k(),G=jQuery.extend({},qt),m(t.people),y(),$("#name-table-header").text(Tt?"Adults":"Kids");var r=St.service_labels[$("#service-label-1").val()];if($(".first-service-header").text(r),$("#first-service-total-header").text(r+" Attendance"),$("#visitors-first-service-label").text(r+" Visitors"),a?($(".second-service-header").text(St.service_labels[a]),$("#second-service-total-header").text(St.service_labels[a]+" Attendance"),$(".second-service-header").css("display",""),$("#first-service-total-row").css("display",""),$("#second-service-total-row").css("display",""),$(".attendance-table-attendance-col[service=second]").css("display",""),$("#visitors-second-service-label").css("display","").text(St.service_labels[a]+" Visitors"),$("#visitors-second-service").css("display","")):($(".second-service-header").css("display","none"),$("#first-service-total-row").css("display","none"),$("#second-service-total-row").css("display","none"),$(".attendance-table-attendance-col[service=second]").css("display","none"),$("#visitors-second-service-label").css("display","none"),$("#visitors-second-service").css("display","none")),$(".campus-text").text(St.campuses[$("#campus").val()]),t.scroll_to_id&&t.scroll_to_id>=0){var i=$("[personid="+t.scroll_to_id+"]")[0];if(i){var s="#attendance-table-container",l=$(s).offset().top,d=i.offsetTop;$("body").animate({scrollTop:l},300),$(s).animate({scrollTop:d},$t)}}$(".attendance-form").unmask()}else $(".attendance-form").unmask(),1===t.error?logout():$().toastmessage("showErrorToast","Error loading")}).fail(function(){$(".attendance-form").unmask(),$().toastmessage("showErrorToast","Error loading")})}function x(e){$.ajax({type:"POST",url:"ajax/save_people.php",data:{people:JSON.stringify(e),campus:rt,label1:ot,label2:at,visitors1:ut,visitors2:mt,adult:Tt,date:R}}).done(function(e){$(".attendance-form").unmask();var t=JSON.parse(e);t.success?(G=jQuery.extend({},qt),h(t.people),$(".attendance-table-attendance-col[service=second]").css("display",at?"":"none"),$().toastmessage("showSuccessToast","Save successful")):1===t.error?logout():$().toastmessage("showErrorToast","Error saving")})}function L(e){return $("[personId="+e+"] input:checkbox:first")[0].checked}function A(e){return $("[personId="+e+"] input:checkbox:last")[0].checked}function M(e,t){if(e==t)return 0;if(null===e)return-1;if(null===t)return 1;var n=O(e,!0),o=O(t,!0);if(e.first_name||e.last_name){if(!t.first_name&&!t.last_name)return-1;if(n==o)return 0;if(n.toLowerCase()<o.toLowerCase())return-1;if(n.toLowerCase()>o.toLowerCase())return 1}else{if(t.first_name||t.last_name)return 1;if(n==o)return 0;if(n.toLowerCase()<o.toLowerCase())return-1;if(n.toLowerCase()>o.toLowerCase())return 1}}function O(e,t){if(null===e)return"";var n="";return e.first_name||e.last_name?(e.last_name&&(n+=e.last_name),e.last_name&&e.first_name?t===!0?n+=", "+e.first_name:n=e.first_name+" "+n:e.first_name&&(n+=e.first_name+" ")):n=e.description,n}function j(e){for(var t=0;t<_t.length;t++)if(_t[t].id===e)return _t[t];return null}function N(){return"id-"+ ++yt}function C(){return--gt}function H(){$("#attendance-nav").on("click",z),$("#reports-nav").on("click",z),$("a.person_name").on("click",z),$("button.attendance-history-button").on("click",I)}function P(){$("#attendance-nav").off("click",z),$("#reports-nav").off("click",z),$("a.person_name").off("click",z),$("button.attendance-history-button").off("click",I)}function I(){var e=this.parentElement.parentElement.getAttribute("personId");E(e)}function D(){document.querySelector("#jump-to").innerHTML="<option>--Jump To Letter--</option>"}function J(e,t){if(t){var n=t.substr(0,1).toUpperCase();if(!($('#jump-to option:contains("'+n+'")').length>0)){var o=document.querySelector("#jump-to"),a=document.createElement("option");a.setAttribute("scroll_to_id",e),a.innerHTML=n,o.appendChild(a)}}}function F(e){var t=e.target.options[e.target.options.selectedIndex];if(t){var n=$("[personid="+t.getAttribute("scroll_to_id")+"]")[0];if(n){var o="#attendance-table-container",a=$(o).offset().top,r=n.offsetTop;$("body").animate({scrollTop:a},300),$(o).animate({scrollTop:r},$t)}}}function z(e){bt||confirm("If you continue you will lose any unsaved changes. Continue?")||e.preventDefault()}if(0!==$("#attendance").length){$("#attendance-date").datepicker({dateFormat:"m/d/yy"});var U,R,G,V=document.querySelector("#attendance-date"),Y=document.querySelector("#active-true"),B=document.querySelector("#active-false"),Q=document.querySelector("#adults-true"),W=document.querySelector("#adults-false"),K=document.querySelector("#update"),Z=document.querySelector("#cancel"),X=document.querySelector("#export"),et=document.querySelector("#service-label-1"),tt=document.querySelector("#service-label-2"),nt=document.querySelector("#campus"),ot=-1,at=-1,rt=-1,it=document.querySelector("#go-arrow"),st=document.querySelector("#add-person"),ct=document.querySelector("#attendance-date-display"),lt=document.querySelector("#visitors-first-service"),dt=document.querySelector("#visitors-second-service"),ut=0,mt=0,pt=0,ft=0,ht=0,vt=0,_t=[],yt=0,gt=-1,bt=!0,$t=1e3,kt=$(".dialog-form").dialog({autoOpen:!1,height:450,width:450,modal:!0}),wt=["January","February","March","April","May","June","July","August","September","October","November","December"],St={},Et=-1,Tt=!0,qt={},xt={total_first_count:document.querySelector("#total-first-count"),total_second_count:document.querySelector("#total-second-count"),total_total_count:document.querySelector("#total-total-count"),adult_first_count:document.querySelector("#adult-first-count"),adult_second_count:document.querySelector("#adult-second-count"),adult_total_count:document.querySelector("#adult-total-count"),kid_first_count:document.querySelector("#kid-first-count"),kid_second_count:document.querySelector("#kid-second-count"),kid_total_count:document.querySelector("#kid-total-count")};c(),K.addEventListener("click",n),Z.addEventListener("click",a),X.addEventListener("click",e),it.addEventListener("click",d),st.addEventListener("click",s),$(".jump-to").on("change",F),$(".navigation-links a").on("click",u),$("#refresh-visitors").on("click",y),checkLoginStatus(T)}}(),function(){function e(e){var t=document.getElementById("error-container"),n=!!e;t?(document.getElementById("error-msg").innerHTML=n?e:"",t.style.display=n?"":"none"):n&&alert(e)}function t(){$.ajax({type:"POST",url:"ajax/email_error.php",data:{msg:n}}).done(function(t){var o=JSON.parse(t);o.success?e(n+"<br /><br /> Email sent"):e(n+"<br /><br /> Error sending email")}).fail(function(){e(n+"<br /><br /> Error sending email")})}var n="",o=document.querySelector("#email-error");window.onerror=function(t,o,a,r,i){$(".masked").unmask(),t=i||t||"",o=o||"",a=a||"",r=r||"",n="Message: "+t+"<br />File: "+o+"<br />Line: "+a+"<br />Column: "+r,e(n)},o&&o.addEventListener("click",t)}(),function(){"use strict";function e(){var e=$("#follow-up-frequency");$.each(St,function(t,n){e.append("<option value="+t+">"+n+"</option>")}),e.val("")}function t(){var e=$("#follow-up-type");$.each(wt,function(t,n){e.append("<option value="+t+">"+n+"</option>")}),e.val("2")}function n(){var e=$.trim(_t.value);""===e?$().toastmessage("showErrorToast","Must enter Name"):a(e)}function o(){var e=$.trim(_t.value);""===e?$().toastmessage("showErrorToast","Must enter Name"):r(e)}function a(e){$.ajax({type:"POST",url:"ajax/create_person.php",data:{person_display:e}}).done(function(e){var t=JSON.parse(e);t.success?f(t.person_id,t.person_name):1===t.error?logout():$().toastmessage("showErrorToast","Error loading visitors")}).fail(function(){$().toastmessage("showErrorToast","Error loading visitors")})}function r(e){$.ajax({type:"GET",url:"ajax/search.php",data:{search:e}}).done(function(e){var t=JSON.parse(e);t.success?v(t.people):1===t.error?logout():$().toastmessage("showErrorToast","Error loading visitors")}).fail(function(){$().toastmessage("showErrorToast","Error loading visitors")})}function i(){$.ajax({type:"GET",url:"ajax/get_visitors.php"}).done(function(n){var o=JSON.parse(n);o.success?(F=o.people,w(),t(),e(),s()):1===o.error?logout():$().toastmessage("showErrorToast","Error loading visitors")}).fail(function(){$().toastmessage("showErrorToast","Error loading visitors")})}function s(){$.ajax({type:"POST",url:"ajax/get_follow_ups.php",data:{date:B.value}}).done(function(e){var t=JSON.parse(e);t.success?g(t.follow_ups):1===t.error?logout():$().toastmessage("showErrorToast","Error loading visitors")}).fail(function(){$().toastmessage("showErrorToast","Error loading visitors")})}function c(e,t,n){$.ajax({type:"POST",url:"ajax/save_follow_up.php",data:{follow_up:JSON.stringify(e)}}).done(function(o){var a=JSON.parse(o);a.success?(e.id=a.follow_up_id,t.call(this,e,n),$().toastmessage("showSuccessToast","Save successful")):1===a.error?logout():a.warning?$().toastmessage("showErrorToast",a.warning):$().toastmessage("showErrorToast","Error saving follow up")}).fail(function(){$().toastmessage("showErrorToast","Error saving follow up")})}function l(e,t){$.ajax({type:"POST",url:"ajax/delete_follow_up.php",data:{id:e,personId:t}}).done(function(t){var n=JSON.parse(t);n.success?$("#follow-up-table tr[follow_up_id="+e+"]").remove():1===n.error?logout():n.warning?$().toastmessage("showErrorToast",n.warning):$().toastmessage("showErrorToast","Error deleting Follow Up")}).fail(function(){$().toastmessage("showErrorToast","Error deleting Follow Up")})}function d(e,t){if(null===e)return"";var n="";return e.first_name||e.last_name?(e.last_name&&(n+=e.last_name),e.last_name&&e.first_name?t===!0?n+=", "+e.first_name:n=e.first_name+" "+n:e.first_name&&(n+=e.first_name+" ")):n=e.description,n}function u(){U.text("Add Follow Up"),G.innerHTML="(Select a person)",G.setAttribute("personid",""),G.setAttribute("person_name",""),V.value="2",Y.value="",Q.value="",K.checked=!1,Z.checked=!1,X.checked=!1,et.checked=!1,tt.checked=!1,nt.checked=!1,ot.checked=!1,at.checked=!1,rt.checked=!1,it.checked=!1,st.checked=!1,ut.value="",lt.checked=!1,Y.disabled=!1;for(var e=dt.querySelectorAll("input"),t=0;t<e.length;t++)e[t].checked=!1;H()}function m(){var e=$.trim(G.getAttribute("person_name")),t=$.trim(G.getAttribute("personid")),n=$.trim(Y.value),o=$.trim(V.value),a=$.trim(ut.value),r={frequency:Q.value,commitment_christ:!1,recommitment_christ:!1,commitment_tithe:!1,commitment_ministry:!1,commitment_baptism:!1,info_next:!1,info_gkids:!1,info_ggroups:!1,info_gteams:!1,info_member:!1,info_visit:!1},i=[],s=[],c="",l="";(""===t||0>t)&&(c+="Must select a person<br />"),""!==a||1!=o&&2!=o||(c+="Must specify comments<br />"),""!==n||lt.checked||(c+="Must specify a date or mark it unknown<br />"),a.length>5e3&&(c+="Comments cannot exceed 5000 characters<br />");for(var d=dt.querySelectorAll("input"),u=0;u<d.length;u++)d[u].checked&&(i.push($.trim(d[u].nextSibling.innerHTML)),s.push(d[u].getAttribute("personid")));return 0===s.length&&(c+="Must specify a visitor<br />"),c?($().toastmessage("showErrorToast",c),!1):(3==o&&(r={frequency:Q.value,commitment_christ:K.checked,recommitment_christ:Z.checked,commitment_tithe:X.checked,commitment_ministry:et.checked,commitment_baptism:tt.checked,info_next:nt.checked,info_gkids:ot.checked,info_ggroups:at.checked,info_gteams:rt.checked,info_member:it.checked,info_visit:st.checked}),{id:L()?D():R.value,date:n,name:e,personId:t,spouseId:l,typeCd:o,type:V.selectedOptions[0].text,comments:a,communication_card_options:r,visitors:i,visitorsIds:s})}function p(e){var t=e.currentTarget.parentElement.parentElement,n=t.getAttribute("person_id"),o=t.children[0].getAttribute("person_name");f(n,o)}function f(e,t){M(),G.innerHTML='<a class="person_name" href="manage-person.html?id='+e+'">'+t+"</a>",G.setAttribute("personid",e),G.setAttribute("person_name",t)}function h(e){var t=e.currentTarget.parentElement.parentElement,n=t.getAttribute("person_id");window.location="manage-person.html?id="+n}function v(e){$("a.person_name").off("click",p),$("button.search-button").off("click",h),$("#search-table tbody tr").remove();for(var t=0;t<e.length;t++)_(e[t]);$("a.person_name").on("click",p),$("button.search-button").on("click",h)}function _(e){var t=d(e);$("#search-table > tbody:last").append('<tr person_id="'+e.id+'"><td data-th="Name" person_name="'+t+'"><a class="person_name" href="javascript:void(0);">'+t+'</a></td><td data-th="Address">'+y(e)+'</td><td data-th="" class="search-table-button-col"><button class="search-button button--blue-x-small">Manage</button></td></tr>')}function y(e){var t="";return t+=e.street1||"",e.street1&&(t+="<br />"),t+=e.street2||"",e.street2&&(t+="<br />"),t+=e.city||"",e.city&&e.state&&(t+=","),t+=" ",t+=e.state||"",t+=" ",t+=e.zip||"",t.trim()}function g(e){I(),$("#follow-up-table tbody tr").remove();for(var t=0;t<e.length;t++)b(e[t]);P()}function b(e){!e.type&&e.typeCd&&(e.type=wt[e.typeCd]||""),e.date=e.date||"",e.name=e.name||"";var t,n=e.name;e.personId>=0&&(t='<a class="person_name" href="manage-person.html?id='+e.personId+'">'+n+"</a>");var o=[];for(var a in e.communication_card_options)e.communication_card_options.hasOwnProperty(a)&&e.communication_card_options[a]===!0&&o.push(a);$("#follow-up-table > tbody:last").append('<tr class="'+("1"==e.communication_card_options.frequency?"first-time-visitor":"")+'" follow_up_id="'+e.id+'" communication_card_options="'+o.join(",")+'" frequency="'+e.communication_card_options.frequency+'"><td data-th="Name" personid="'+e.personId+'" person_name="'+n+'">'+t+'</td><td data-th="Type" typeCd="'+e.typeCd+'">'+e.type+'</td><td data-th="Date" class="follow-up-table-date-col">'+e.date+'</td><td data-th="By" visitorsIds="'+e.visitorsIds.join(",")+'">'+e.visitors.join(", ")+'</td><td data-th="Comments" class="follow-up-table-comments-col">'+e.comments+'</td><td data-th="" class="follow-up-table-button-col"><button class="edit-follow-up"><i class="fa fa-edit"></i></button><button class="delete-follow-up"><i class="fa fa-minus-circle"></i></button></td></tr>')}function k(e){var t=$("#follow-up-table tr[follow_up_id="+e.id+"]"),n=t.children(),o=[];t[0].setAttribute("class","1"==e.communication_card_options.frequency?"first-time-visitor":"");for(var a in e.communication_card_options)e.communication_card_options.hasOwnProperty(a)&&e.communication_card_options[a]===!0&&o.push(a);t[0].setAttribute("frequency",e.communication_card_options.frequency),t[0].setAttribute("communication_card_options",o.join(",")),n[0].setAttribute("personid",e.personId),n[0].setAttribute("person_name",e.name),n[0].innerHTML='<a class="person_name" href="manage-person.html?id='+e.personId+'">'+e.name+"</a>",n[1].setAttribute("typeCd",e.typeCd),n[1].innerHTML=e.type,n[2].innerHTML=e.date,n[3].innerHTML=e.visitors.join(", "),n[4].setAttribute("visitorsIds",e.visitorsIds.join(",")),n[4].innerHTML=e.comments}function w(){if(""===dt.innerHTML.trim())for(var e,t=0;t<F.length;t++)e=F[t],dt.innerHTML+='<div class="check-field"><input type="checkbox" personid="'+e.id+'" id="follow-up-by-'+e.id+'"/><label for="follow-up-by-'+e.id+'">'+d(e)+"</label></div>"}function S(e,t){b(e),$("button.edit-follow-up:last").on("click",x),$("button.delete-follow-up:last").on("click",N),t===!0&&u()}function E(e,t){k(e),t===!0&&u()}function T(){var e=m();return e===!1?!1:(c(e,L()?S:E,!1),void 0)}function q(){var e=m();return e===!1?!1:(c(e,L()?S:E,!0),void 0)}function x(e){var t,n=e.currentTarget.parentElement.parentElement,o=n.children[2].innerHTML||"",a=(n.getAttribute("communication_card_options")||"").split(","),r={commitment_christ:!1,recommitment_christ:!1,commitment_tithe:!1,commitment_ministry:!1,commitment_baptism:!1,info_next:!1,info_gkids:!1,info_ggroups:!1,info_gteams:!1,info_member:!1,info_visit:!1};for(t=0;t<a.length;t++)r[a[t]]=!0;G.setAttribute("personid",n.children[0].getAttribute("personid")||""),G.setAttribute("person_name",n.children[0].getAttribute("person_name")||""),G.innerHTML=n.children[0].innerHTML||"",V.value=n.children[1].getAttribute("typeCd")||"",Y.value=o,Q.value=n.getAttribute("frequency")||"",K.checked=r.commitment_christ,Z.checked=r.recommitment_christ,X.checked=r.commitment_tithe,et.checked=r.commitment_ministry,tt.checked=r.commitment_baptism,nt.checked=r.info_next,ot.checked=r.info_gkids,at.checked=r.info_ggroups,rt.checked=r.info_gteams,it.checked=r.info_member,st.checked=r.info_visit,ut.value=n.children[4].innerHTML||"",R.value=n.getAttribute("follow_up_id"),lt.checked=""===o,Y.disabled=lt.checked;var i=n.children[3].getAttribute("visitorsIds")||"",s=i.split(","),c=dt.querySelectorAll("input");for(t=0;t<c.length;t++)c[t].checked=s.indexOf(c[t].getAttribute("personid"))>=0;H(),U.text("Edit Follow Up");var l=$(".follow-ups-form").offset().top;$("body").animate({scrollTop:l},200),$(".follow-ups-form").effect("highlight",{},1200)}function L(){return-1===U.text().indexOf("Edit")}function A(){gt.dialog("open")}function M(){gt.dialog("close")}function O(e){z||confirm("If you continue you will lose any unsaved changes. Continue?")||e.preventDefault()}function j(){confirm("If you continue you will lose any unsaved changes. Continue?")&&u()}function N(e){if(confirm("Are you sure you would like to PERMANENTLY delete this Follow Up?")){var t=e.currentTarget.parentElement.parentElement,n=t.getAttribute("follow_up_id"),o=t.children[0].getAttribute("personid");l(n,o)}}function C(e){Y.disabled=e.target.checked,Y.value=""
}function H(){$("#follow-up-frequency-container").css("display",3==V.value?"inherit":"none"),W.style.display=3==V.value?"inherit":"none"}function P(){$("#attendance-nav").on("click",O),$("#reports-nav").on("click",O),$("button.edit-follow-up").on("click",x),$("button.delete-follow-up").on("click",N)}function I(){$("#attendance-nav").off("click",O),$("#reports-nav").off("click",O),$("button.edit-follow-up").off("click",x),$("button.delete-follow-up").off("click",N)}function D(){return--kt}function J(e){var t=$("#search-table-container"),n=-1==e.target.id.indexOf("top")?t[0].scrollHeight:0;t.stop().animate({scrollTop:n},bt,"swing",function(){$("<style></style>").appendTo($(document.body)).remove()})}if(0!==$(".follow-ups-form").length){$("#follow-up-date").datepicker(),$("#follow-ups-for-date").datepicker({dateFormat:"m/d/yy"}),$("#follow-ups-for-date").datepicker("setDate",new Date);var F=[],z=!0,U=$("#follow-ups-form-title"),R=document.querySelector("#follow-up-id"),G=document.querySelector("#follow-up-person"),V=document.querySelector("#follow-up-type"),Y=document.querySelector("#follow-up-date"),B=document.querySelector("#follow-ups-for-date"),Q=document.querySelector("#follow-up-frequency"),W=document.querySelector(".communication-card-options"),K=document.querySelector("#follow-up-commitment-christ"),Z=document.querySelector("#follow-up-recommitment-christ"),X=document.querySelector("#follow-up-commitment-tithe"),et=document.querySelector("#follow-up-commitment-ministry"),tt=document.querySelector("#follow-up-commitment-baptism"),nt=document.querySelector("#follow-up-info-next"),ot=document.querySelector("#follow-up-info-gkids"),at=document.querySelector("#follow-up-info-ggroups"),rt=document.querySelector("#follow-up-info-gteams"),it=document.querySelector("#follow-up-info-member"),st=document.querySelector("#follow-up-info-visit"),ct=document.querySelector("#get-follow-ups"),lt=document.querySelector("#unknown-date"),dt=document.querySelector("#follow-up-visitors"),ut=document.querySelector("#follow-up-comments"),mt=document.querySelector("#add-clear"),pt=document.querySelector("#add-copy"),ft=document.querySelector("#clear"),ht=document.querySelector("#add-new-person"),vt=document.querySelector("#search"),_t=document.querySelector("#search-name"),yt=document.querySelector("#close"),gt=$("#search-form").dialog({autoOpen:!1,height:430,width:510,modal:!0}),bt=1e3,$t=document.querySelector("#select-person-btn"),kt=-1,wt={1:"Phone Call",2:"Visit",3:"Communication Card",4:"Entered in The City",5:"Thank You Card Sent"},St={1:"1st Time",2:"2nd Time",3:"Often",4:"Member","":"--None Provided--"};$(".navigation-links a").on("click",J),pt.addEventListener("click",T),mt.addEventListener("click",q),ft.addEventListener("click",j),$t.addEventListener("click",A),ht.addEventListener("click",n),vt.addEventListener("click",o),_t.addEventListener("keydown",function(e){13==e.keyCode&&o()}),yt.addEventListener("click",M),ct.addEventListener("click",s),$("#unknown-date").on("change",C),$("#follow-up-type").on("change",H),u(),checkLoginStatus(i)}}(),function(){"use strict";function e(){var e=i.value,n=s.value;t(e,n)&&o(e,$.md5(n))}function t(e,t){var n="";return $.trim(e)||(n+="Username cannot be blank<br />"),t||(n+="Password cannot be blank<br />"),n?($().toastmessage("showErrorToast",n),!1):!0}function n(e){for(var t=window.location.search.substring(1),n=t.split("&"),o=0;o<n.length;o++){var a=n[o].split("=");if(a[0]==e)return decodeURIComponent(a[1])}return null}function o(e,t){$.ajax({type:"POST",url:"ajax/login.php",data:{username:e,password:t}}).done(function(e){var t=JSON.parse(e);if(t.success){var o=n("url");window.location=o?o:"attendance.html"}else $().toastmessage("showErrorToast","Username or password is incorrect")})}function a(){var e=n("url");window.location=e?e:"attendance.html"}var r=document.querySelector("#login-btn"),i=document.querySelector("#username"),s=document.querySelector("#password");r&&(r.addEventListener("click",e),$(document).keypress(function(t){13==t.which&&e()}),checkLoginStatus(a,!0))}(),function(){"use strict";function e(){o.classList.remove("open"),n.classList.remove("open")}function t(){o.classList.toggle("open"),n.classList.toggle("open")}if(0!==$(".menu").length){var n=document.querySelector(".navdrawer-container"),o=document.querySelector(".app-bar"),a=document.querySelector(".menu"),r=document.querySelector("main");r.addEventListener("touchstart",e),r.addEventListener("click",e),a.addEventListener("click",t),n.addEventListener("click",function(t){("A"===t.target.nodeName||"LI"===t.target.nodeName)&&e()})}}(),function(){"use strict";function e(e){var t=$("#state");$.each(e,function(e,n){t.append("<option value="+n.abbreviation+">"+n.name+"</option>")}),t.val("OH")}function t(){var e=$("#follow-up-frequency");$.each(uo,function(t,n){e.append("<option value="+t+">"+n+"</option>")}),e.val("")}function n(){var e=$("#follow-up-type");$.each(so,function(t,n){e.append("<option value="+t+">"+n+"</option>")}),e.val("2"),e=$("#relationship-type"),$.each(co,function(t,n){e.append("<option value="+t+">"+n+"</option>")}),e.val("1"),e=$("#attender-status"),$.each(lo,function(t,n){e.append("<option value="+t+">"+n+"</option>")}),e.val("3")}function o(e){St.value=e.first_name,Et.value=e.last_name,Tt.value=e.description,qt.value=e.first_visit,xt.innerHTML=e.first_attendance_dt||'<span style="font-style: italic;">(None)</span>',Lt.value=e.attender_status,At.checked=e.adult,Mt.checked=e.active,Ot.checked=e.baptized,jt.checked=e.saved,Nt.checked=e.visitor,Ct.checked=e.assigned_agent,Ht.checked=e.starting_point_notified,Pt.value=e.street1,It.value=e.street2,Dt.value=e.city,Jt.value=e.zip,e.state&&(Vt.value=e.state),Ft.value=e.email,zt.value=bt(e.primary_phone),Rt.value=e.primary_phone_type,Ut.value=bt(e.secondary_phone),Gt.value=e.secondary_phone_type,a(e),r(e),J(e.follow_ups),U(e.relationships),x()}function a(e){Yt.checked=e.commitment_christ,Bt.checked=e.recommitment_christ,Qt.checked=e.commitment_tithe,Wt.checked=e.commitment_ministry,Kt.checked=e.commitment_baptism,Zt.checked=e.info_next,Xt.checked=e.info_gkids,en.checked=e.info_ggroups,tn.checked=e.info_gteams,nn.checked=e.info_member,on.checked=e.info_visit}function r(e){var t=ut(e);ao.innerHTML="OH"===t||""===t?"":'<a href="'+io+t+'" target="_blank"><img border="0" src="'+ro+t+'" /></a>'}function i(){var e={id:kt.id,first_name:$.trim(St.value),last_name:$.trim(Et.value),description:$.trim(Tt.value),first_visit:$.trim(qt.value),attender_status:Lt.value,adult:At.checked,active:Mt.checked,baptized:Ot.checked,saved:jt.checked,visitor:Nt.checked,assigned_agent:Ct.checked,street1:$.trim(Pt.value),street2:$.trim(It.value),city:$.trim(Dt.value),zip:$.trim(Jt.value),state:$.trim(Vt.value),email:$.trim(Ft.value),primary_phone:$.trim(zt.value),primary_phone_type:Rt.value,secondary_phone:$.trim(Ut.value),secondary_phone_type:Gt.value,commitment_christ:Yt.checked,recommitment_christ:Bt.checked,commitment_tithe:Qt.checked,commitment_ministry:Wt.checked,commitment_baptism:Kt.checked,info_next:Zt.checked,info_gkids:Xt.checked,info_ggroups:en.checked,info_gteams:tn.checked,info_member:nn.checked,info_visit:on.checked};"OH"===$.trim(ut(e))&&(e.state=""),l(e)&&g(e)}function s(){var e=[];return $("#follow-up-table tbody tr").each(function(t,n){var o=n.children[0].getAttribute("typeCd")||"";e.push({id:n.getAttribute("follow_up_id"),typeCd:o,type:so[o],date:n.children[1].innerHTML||"",comments:n.children[3].innerHTML||"",visitorsIds:n.children[2].getAttribute("visitorsIds").split(",")||"",visitors:n.children[2].innerHTML.split(", ")||""})}),e}function c(){var e=[];return $("#relationship-table tbody tr").each(function(t,n){var o=n.children[0].getAttribute("typeCd")||"";e.push({id:n.getAttribute("relationship_id"),typeCd:o,type:co[o],person_id:kt.id,relation_id:n.children[1].getAttribute("relationid"),name:n.children[1].getAttribute("relationname")})}),e}function l(e){var t="",n=!!e.first_name,o=!!e.last_name,a=!!e.description;return!n&&o?t+="First Name cannot be blank if Last Name is specified<br />":n&&!o?t+="Last Name cannot be blank if First Name is specified<br />":n||o||a||(t+="Must specify either First and Last Name or Description<br />"),e.first_name.length>50&&(t+="First Name cannot exceed 50 characters<br />"),e.last_name.length>50&&(t+="Last Name cannot exceed 50 characters<br />"),e.description.length>250&&(t+="Description cannot exceed 250 characters<br />"),e.email.length>100&&(t+="Email cannot exceed 100 characters<br />"),Ft.checkValidity()||(t+="Email is not valid<br />"),e.primary_phone.length>15?t+="Primary Phone cannot exceed 15 characters<br />":e.primary_phone.length>0&&!oo.test(e.primary_phone)&&(t+="Primary Phone is not a valid phone number format<br />"),e.secondary_phone.length>15?t+="Secondary Phone cannot exceed 15 characters<br />":e.secondary_phone.length>0&&!oo.test(e.secondary_phone)&&(t+="Secondary Phone is not a valid phone number format<br />"),e.street1.length>100&&(t+="Street 1 cannot exceed 100 characters<br />"),e.street2.length>100&&(t+="Street 2 cannot exceed 100 characters<br />"),e.city.length>100&&(t+="City cannot exceed 100 characters<br />"),e.zip.length>5&&(t+="Zip Code cannot exceed 5 characters<br />"),e.street1.length>100&&(t+="Street 1 cannot exceed 100 characters<br />"),t?($().toastmessage("showErrorToast",t),!1):!0}function d(){confirm("Deleting someone also deletes their attendance history. Continue?")&&b()}function u(){confirm("If you continue you will lose any unsaved changes. Continue?")&&(o(kt),no=!0)}function m(){var e=$.trim(wn.value);""===e?$().toastmessage("showErrorToast","Must enter Name"):f(e)}function p(){var e=$.trim(wn.value);""===e?$().toastmessage("showErrorToast","Must enter Name"):h(e)}function f(e){$.ajax({type:"POST",url:"ajax/create_person.php",data:{person_display:e}}).done(function(e){var t=JSON.parse(e);t.success?A(t.person_id,t.person_name):1===t.error?logout():$().toastmessage("showErrorToast","Error loading visitors")}).fail(function(){$().toastmessage("showErrorToast","Error loading visitors")})}function h(e){$.ajax({type:"GET",url:"ajax/search.php",data:{search:e}}).done(function(e){var t=JSON.parse(e);t.success?O(t.people):1===t.error?logout():$().toastmessage("showErrorToast","Error loading visitors")}).fail(function(){$().toastmessage("showErrorToast","Error loading visitors")})}function v(){$.ajax({type:"GET",url:"ajax/states.json"}).done(function(o){if($.isArray(o))e(o);else{var a=JSON.parse(o);e(a)}n(),t(),y(),_()}).fail(function(){$().toastmessage("showErrorToast","Error loading states")})}function _(){$.ajax({type:"GET",url:"ajax/get_visitors.php"}).done(function(e){var t=JSON.parse(e);t.success?wt=t.people:1===t.error?logout():$().toastmessage("showErrorToast","Error loading visitors")}).fail(function(){$().toastmessage("showErrorToast","Error loading visitors")})}function y(){$.ajax({type:"GET",url:"ajax/get_person.php",data:{id:$t.id}}).done(function(e){var t=JSON.parse(e);t.success?(kt=t.person,o(t.person)):1===t.error?logout():$().toastmessage("showErrorToast","Error loading")}).fail(function(){$().toastmessage("showErrorToast","Error loading person")})}function g(e){$.ajax({type:"POST",url:"ajax/save_person.php",data:{person:JSON.stringify(e)}}).done(function(t){var n=JSON.parse(t);n.success?(e.follow_ups=s(),e.relationships=c(),kt=e,no=!0,r(e),$().toastmessage("showSuccessToast","Save successful")):1===n.error?logout():$().toastmessage("showErrorToast","Error saving person")}).fail(function(){$().toastmessage("showErrorToast","Error saving person")})}function b(){$.ajax({type:"POST",url:"ajax/delete_person.php",data:{id:kt.id}}).done(function(e){var t=JSON.parse(e);t.success?window.location="attendance.html":1===t.error?logout():$().toastmessage("showErrorToast","Error deleting person")}).fail(function(){$().toastmessage("showErrorToast","Error deleting person")})}function k(e,t){$.ajax({type:"POST",url:"ajax/save_follow_up.php",data:{follow_up:JSON.stringify(e)}}).done(function(n){var o=JSON.parse(n);o.success?(e.id=o.follow_up_id,S(o.communication_card_options[0]),a(o.communication_card_options[0]),t.call(this,e),$().toastmessage("showSuccessToast","Follow up save successful")):1===o.error?logout():o.warning?$().toastmessage("showErrorToast",o.warning):$().toastmessage("showErrorToast","Error saving follow up")}).fail(function(){$().toastmessage("showErrorToast","Error saving follow up")})}function w(e){$.ajax({type:"POST",url:"ajax/delete_follow_up.php",data:{id:e,personId:kt.id}}).done(function(t){var n=JSON.parse(t);n.success?($("#follow-up-table tr[follow_up_id="+e+"]").remove(),S(n.communication_card_options[0]),a(n.communication_card_options[0])):1===n.error?logout():n.warning?$().toastmessage("showErrorToast",n.warning):$().toastmessage("showErrorToast","Error deleting follow up")}).fail(function(){$().toastmessage("showErrorToast","Error deleting follow up")})}function S(e){for(var t in e)e.hasOwnProperty(t)&&(e[t]="true"===e[t])}function E(e,t){$.ajax({type:"POST",url:"ajax/save_relationship.php",data:{relationship:JSON.stringify(e)}}).done(function(n){var o=JSON.parse(n);if(o.success)e.id=o.relationship_id,t.call(this,e),x(),$().toastmessage("showSuccessToast","Relationship save successful");else if(1===o.error)logout();else{var a="Error saving relationship";o.msg&&(a=o.msg),$().toastmessage("showErrorToast",a)}}).fail(function(){$().toastmessage("showErrorToast","Error saving relationship")})}function T(e){$.ajax({type:"POST",url:"ajax/delete_relationship.php",data:{id:e}}).done(function(t){var n=JSON.parse(t);n.success?($("#relationship-table tr[relationship_id="+e+"]").remove(),x()):1===n.error?logout():$().toastmessage("showErrorToast","Error deleting relationship")}).fail(function(){$().toastmessage("showErrorToast","Error deleting relationship")})}function q(){$.ajax({type:"POST",url:"ajax/copy_address_to_spouse.php",data:{personId:kt.id}}).done(function(e){var t=JSON.parse(e);t.success?$().toastmessage("showSuccessToast","Address copied successful"):1===t.error?logout():$().toastmessage("showErrorToast","Error copying address")}).fail(function(){$().toastmessage("showErrorToast","Error copying address")})}function x(){ln.style.display=$("#relationship-table td[typecd=1]").length>0?"":"none"}function L(e){var t=e.currentTarget.parentElement.parentElement,n=t.getAttribute("person_id"),o=t.children[0].getAttribute("person_name");A(n,o)}function A(e,t){C(),_n.innerHTML='<a class="person_name" href="manage-person.html?id='+e+'">'+t+"</a>",_n.setAttribute("relationid",e),_n.setAttribute("person_name",t)}function M(e){var t=e.currentTarget.parentElement.parentElement,n=t.getAttribute("person_id");window.location="manage-person.html?id="+n}function O(e){$("a.person_name").off("click",L),$("button.search-button").off("click",M),$("#search-table tbody tr").remove();for(var t=0;t<e.length;t++)j(e[t]);$("a.person_name").on("click",L),$("button.search-button").on("click",M)}function j(e){var t=P(e);$("#search-table > tbody:last").append('<tr person_id="'+e.id+'"><td data-th="Name" person_name="'+t+'"><a class="person_name" href="javascript:void(0);">'+t+'</a></td><td data-th="Address">'+H(e)+'</td><td data-th="" class="search-table-button-col"><button class="search-button button--blue-x-small">Manage</button></td></tr>')}function N(){bn.dialog("open")}function C(){bn.dialog("close")}function H(e){var t="";return t+=e.street1||"",e.street1&&(t+="<br />"),t+=e.street2||"",e.street2&&(t+="<br />"),t+=e.city||"",e.city&&e.state&&(t+=","),t+=" ",t+=e.state||"",t+=" ",t+=e.zip||"",t.trim()}function P(e,t){if(null===e)return"";var n="";return e.first_name||e.last_name?(e.last_name&&(n+=e.last_name),e.last_name&&e.first_name?t===!0?n+=", "+e.first_name:n=e.first_name+" "+n:e.first_name&&(n+=e.first_name+" ")):n=e.description,n}function I(){Cn.value="2",Hn.value="",Hn.disabled=!1,Pn.checked=!1,Zn.value="",Fn.checked=!1,zn.checked=!1,Un.checked=!1,Rn.checked=!1,Gn.checked=!1,Vn.checked=!1,Yn.checked=!1,Bn.checked=!1,Qn.checked=!1,Wn.checked=!1,Kn.checked=!1,ft();var e=$("#relationship-table td[typecd=1]");On.style.display=e.length>0?"inherit":"none",jn.checked=!0;for(var t=In.querySelectorAll("input"),n=0;n<t.length;n++)t[n].checked=!1}function D(){var e=$.trim(Hn.value),t=$.trim(Cn.value),n=$.trim(Zn.value),o=[],a=[],r={frequency:Dn.value,commitment_christ:!1,recommitment_christ:!1,commitment_tithe:!1,commitment_ministry:!1,commitment_baptism:!1,info_next:!1,info_gkids:!1,info_ggroups:!1,info_gteams:!1,info_member:!1,info_visit:!1},i="",s="";""!==n||1!=t&&2!=t||(i+="Must specify comments<br />"),""!==e||Pn.checked||(i+="Must specify a date or mark it unknown<br />"),n.length>5e3&&(i+="Comments cannot exceed 5000 characters<br />");for(var c=In.querySelectorAll("input"),l=0;l<c.length;l++)c[l].checked&&(o.push($.trim(c[l].nextSibling.innerHTML)),a.push(c[l].getAttribute("personid")));if(0===a.length&&(i+="Must specify a visitor<br />"),i)return $().toastmessage("showErrorToast",i),!1;var d=$("#relationship-table td[typecd=1]");return d.length>0&&jn.checked&&-1===Xn.text().indexOf("Edit")&&(s=d.next()[0].getAttribute("relationid")),3==t&&(r={frequency:Dn.value,commitment_christ:Fn.checked,recommitment_christ:zn.checked,commitment_tithe:Un.checked,commitment_ministry:Rn.checked,commitment_baptism:Gn.checked,info_next:Vn.checked,info_gkids:Yn.checked,info_ggroups:Bn.checked,info_gteams:Qn.checked,info_member:Wn.checked,info_visit:Kn.checked}),{id:-1===Xn.text().indexOf("Edit")?yt():Nn.value,personId:kt.id,spouseId:s,date:e,typeCd:t,type:Cn.selectedOptions[0].text,comments:n,visitors:o,visitorsIds:a,communication_card_options:r}}function J(e){_t(),$("#follow-up-table tbody tr").remove();for(var t=0;t<e.length;t++)F(e[t]);vt()}function F(e){!e.type&&e.typeCd&&(e.type=so[e.typeCd]||""),e.date=e.date||"";var t=[];for(var n in e.communication_card_options)e.communication_card_options.hasOwnProperty(n)&&e.communication_card_options[n]===!0&&t.push(n);$("#follow-up-table > tbody:last").append('<tr follow_up_id="'+e.id+'" communication_card_options="'+t.join(",")+'" frequency="'+e.communication_card_options.frequency+'"><td data-th="Type" typeCd="'+e.typeCd+'">'+e.type+'</td><td data-th="Date" class="follow-up-table-date-col">'+e.date+'</td><td data-th="By" visitorsIds="'+e.visitorsIds.join(",")+'">'+e.visitors.join(", ")+'</td><td data-th="Comments" class="follow-up-table-comments-col">'+e.comments+'</td><td data-th="" class="follow-up-table-button-col"><button class="edit-follow-up"><i class="fa fa-edit"></i></button><button class="delete-follow-up"><i class="fa fa-minus-circle"></i></button></td></tr>')}function z(e){var t=$("#follow-up-table tr[follow_up_id="+e.id+"]"),n=t.children(),o=[];for(var a in e.communication_card_options)e.communication_card_options.hasOwnProperty(a)&&e.communication_card_options[a]===!0&&o.push(a);t[0].setAttribute("frequency",e.communication_card_options.frequency),t[0].setAttribute("communication_card_options",o.join(",")),n[0].setAttribute("typeCd",e.typeCd),n[0].innerHTML=e.type,n[1].innerHTML=e.date,n[2].innerHTML=e.visitors.join(", "),n[2].setAttribute("visitorsIds",e.visitorsIds.join(",")),n[3].innerHTML=e.comments}function U(e){_t(),$("#relationship-table tbody tr").remove();for(var t=0;t<e.length;t++)R(e[t]);vt()}function R(e){!e.type&&e.typeCd&&(e.type=co[e.typeCd]||""),$("#relationship-table > tbody:last").append('<tr relationship_id="'+e.id+'"><td data-th="Type" typeCd="'+e.typeCd+'">'+e.type+'</td><td data-th="Name" relationId="'+e.relation_id+'" relationname="'+e.name+'"><a class="person_name" href="manage-person.html?id='+e.relation_id+'">'+e.name+'</a></td><td data-th="" class="relationship-table-button-col"><button class="edit-relationship"><i class="fa fa-edit"></i></button><button class="delete-relationship"><i class="fa fa-minus-circle"></i></button></td></tr>')}function G(e){var t=$("#relationship-table tr[relationship_id="+e.id+"]").children();t[0].setAttribute("typeCd",e.typeCd),t[0].innerHTML=e.type,t[1].innerHTML=e.name}function V(){if(""===In.innerHTML.trim())for(var e,t=0;t<wt.length;t++)e=wt[t],In.innerHTML+='<div class="check-field"><input type="checkbox" personid="'+e.id+'" id="follow-up-by-'+e.id+'"/><label for="follow-up-by-'+e.id+'">'+P(e)+"</label></div>"}function Y(){dn.dialog("open"),Q(),eo.text("Add Relationship"),pn.innerHTML=P(kt)}function B(){dn.dialog("close")}function Q(){mn.value="1",_n.innerHTML="(Select a person)",_n.setAttribute("relationid",""),_n.setAttribute("person_name",""),yn.style.display="none"}function W(){var e=X();return e===!1?!1:(E(e,function(e){R(e),$("button.edit-relationship:last").on("click",et),$("button.delete-relationship:last").on("click",tt),dn.dialog("close")}),void 0)}function K(){var e=X();return e===!1?!1:(E(e,function(e){G(e),dn.dialog("close")}),void 0)}function Z(){-1===eo.text().indexOf("Edit")?W():K()}function X(){var e=$.trim(mn.value),t=_n.getAttribute("relationid"),n="",o="";if(t?t==kt.id&&(n+="Person cannot have a relationship with themself<br />"):n+="Must select a person<br />",n)return $().toastmessage("showErrorToast",n),!1;var a=$("#relationship-table td[typecd=1]");return a.length>0&&"2"===e&&gn.checked&&(o=a.next()[0].getAttribute("relationid")),{id:-1===eo.text().indexOf("Edit")?gt():un.value,spouseId:o,typeCd:e,type:mn.selectedOptions[0].text,person_id:kt.id,relation_id:t,name:_n.getAttribute("person_name")}}function et(e){dn.dialog("open");var t=e.currentTarget.parentElement.parentElement;mn.value=t.children[0].getAttribute("typeCd")||"",un.value=t.getAttribute("relationship_id"),A(t.children[1].getAttribute("relationid"),t.children[1].getAttribute("relationname")),eo.text("Edit Follow Up")}function tt(e){if(confirm("Are you sure you would like to PERMANENTLY delete this Relationship?")){var t=e.currentTarget.parentElement.parentElement.getAttribute("relationship_id");T(t)}}function nt(){Mn.dialog("open"),I(),V(),Xn.text("Add Follow Up")}function ot(){Mn.dialog("close")}function at(e){var t=D();return t===!1?!1:(k(t,function(t){F(t),$("button.edit-follow-up:last").on("click",lt),$("button.delete-follow-up:last").on("click",dt),no=!1,e.call(this)}),void 0)}function rt(e){var t=D();return t===!1?!1:(k(t,function(t){z(t),no=!1,e.call(this)}),void 0)}function it(){-1===Xn.text().indexOf("Edit")?at():rt()}function st(){-1===Xn.text().indexOf("Edit")?at(I):rt(I)}function ct(){-1===Xn.text().indexOf("Edit")?at(ot):rt(ot)}function lt(e){Mn.dialog("open"),On.style.display="none",V();var t,n=e.currentTarget.parentElement.parentElement,o=n.children[1].innerHTML||"",a=(n.getAttribute("communication_card_options")||"").split(","),r={commitment_christ:!1,recommitment_christ:!1,commitment_tithe:!1,commitment_ministry:!1,commitment_baptism:!1,info_next:!1,info_gkids:!1,info_ggroups:!1,info_gteams:!1,info_member:!1,info_visit:!1};for(t=0;t<a.length;t++)r[a[t]]=!0;Dn.value=n.getAttribute("frequency")||"",Cn.value=n.children[0].getAttribute("typeCd")||"",Hn.value=o,Zn.value=n.children[3].innerHTML||"",Nn.value=n.getAttribute("follow_up_id"),Pn.checked=""===o,Fn.checked=r.commitment_christ,zn.checked=r.recommitment_christ,Un.checked=r.commitment_tithe,Rn.checked=r.commitment_ministry,Gn.checked=r.commitment_baptism,Vn.checked=r.info_next,Yn.checked=r.info_gkids,Bn.checked=r.info_ggroups,Qn.checked=r.info_gteams,Wn.checked=r.info_member,Kn.checked=r.info_visit,Hn.disabled=Pn.checked;var i=n.children[2].getAttribute("visitorsIds")||"",s=i.split(","),c=In.querySelectorAll("input");for(t=0;t<c.length;t++)c[t].checked=s.indexOf(c[t].getAttribute("personid"))>=0;ft(),Xn.text("Edit Follow Up")}function dt(e){if(confirm("Are you sure you would like to PERMANENTLY delete this Follow Up?")){var t=e.currentTarget.parentElement.parentElement.getAttribute("follow_up_id");w(t)}}function ut(e){var t="";return t+=e.street1||"",t+=" ",t+=e.street2||"",t+=" ",t+=e.city||"",t+=" ",t+=e.state||"",t+=" ",t+=e.zip||"",t.trim()}function mt(e){Hn.disabled=e.currentTarget.checked,Hn.value=""}function pt(){var e=$.trim(mn.value);if("2"===e){var t=$("#relationship-table td[typecd=1]");yn.style.display=t.length>0?"inherit":"none",gn.checked=!0}else yn.style.display="none"}function ft(){$("#follow-up-frequency-container").css("display",3==Cn.value?"inherit":"none"),Jn.style.display=3==Cn.value?"inherit":"none"}function ht(e){no||confirm("If you continue you will lose any unsaved changes. Continue?")||e.preventDefault()}function vt(){$("#attendance-nav").on("click",ht),$("#reports-nav").on("click",ht),$("button.edit-follow-up").on("click",lt),$("button.delete-follow-up").on("click",dt),$("button.edit-relationship").on("click",et),$("button.delete-relationship").on("click",tt)}function _t(){$("#attendance-nav").off("click",ht),$("#reports-nav").off("click",ht),$("button.edit-follow-up").off("click",lt),$("button.delete-follow-up").off("click",dt),$("button.edit-relationship").off("click",et),$("button.delete-relationship").off("click",tt)}function yt(){return to--}function gt(){return Tn--}function bt(e){if(e=e||"",null===e.match(/\D/g,"")){var t=e.replace(/\D/g);7===t.length?e=t.substr(0,3)+"-"+t.substr(3):10===t.length&&(e="("+t.substr(0,3)+") "+t.substr(3,3)+"-"+t.substr(6))}return e}if(0!==$("#manage-person").length){$("#follow-up-date").datepicker(),$("#first-visit").datepicker();var $t={},kt={},wt=[],St=document.querySelector("#first-name"),Et=document.querySelector("#last-name"),Tt=document.querySelector("#description"),qt=document.querySelector("#first-visit"),xt=document.querySelector("#first-recorded-visit"),Lt=document.querySelector("#attender-status"),At=document.querySelector("#adult"),Mt=document.querySelector("#active"),Ot=document.querySelector("#baptized"),jt=document.querySelector("#saved"),Nt=document.querySelector("#visitor"),Ct=document.querySelector("#assigned-agent"),Ht=document.querySelector("#starting-point-notified"),Pt=document.querySelector("#street1"),It=document.querySelector("#street2"),Dt=document.querySelector("#city"),Jt=document.querySelector("#zip"),Ft=document.querySelector("#email"),zt=document.querySelector("#primary-phone"),Ut=document.querySelector("#secondary-phone"),Rt=document.querySelector("#primary-phone-type"),Gt=document.querySelector("#secondary-phone-type"),Vt=document.querySelector("#state"),Yt=document.querySelector("#commitment-christ"),Bt=document.querySelector("#recommitment-christ"),Qt=document.querySelector("#commitment-tithe"),Wt=document.querySelector("#commitment-ministry"),Kt=document.querySelector("#commitment-baptism"),Zt=document.querySelector("#info-next"),Xt=document.querySelector("#info-gkids"),en=document.querySelector("#info-ggroups"),tn=document.querySelector("#info-gteams"),nn=document.querySelector("#info-member"),on=document.querySelector("#info-visit"),an=document.querySelector("#update"),rn=document.querySelector("#cancel"),sn=document.querySelector("#delete"),cn=document.querySelector("#add-follow-up"),ln=document.querySelector("#copy-address-to-spouse"),dn=$(".manage-person-relationship-form").dialog({autoOpen:!1,height:400,width:510,modal:!0}),un=dn[0].querySelector("#relationship-id"),mn=dn[0].querySelector("#relationship-type"),pn=dn[0].querySelector("#relationship-person-name"),fn=document.querySelector("#add-relationship"),hn=document.querySelector("#add-close-relationship"),vn=document.querySelector("#close-relationship"),_n=document.querySelector("#relationship-relation"),yn=dn[0].querySelector("#add-to-spouse-container-relationship"),gn=dn[0].querySelector("#add-to-spouse-relationship"),bn=$(".select-person-form").dialog({autoOpen:!1,height:430,width:510,modal:!0}),$n=document.querySelector("#add-new-person"),kn=document.querySelector("#search"),wn=document.querySelector("#search-name"),Sn=bn[0].querySelector("#close-select-person"),En=document.querySelector("#select-person-btn"),Tn=-1,qn=document.querySelector("#add-clear"),xn=document.querySelector("#add-copy"),Ln=document.querySelector("#add-close"),An=document.querySelector("#close"),Mn=$(".manage-person-follow-up-form").dialog({autoOpen:!1,height:400,width:510,modal:!0}),On=Mn[0].querySelector("#add-to-spouse-container-follow-up"),jn=Mn[0].querySelector("#add-to-spouse-follow-up"),Nn=Mn[0].querySelector("#follow-up-id"),Cn=Mn[0].querySelector("#follow-up-type"),Hn=Mn[0].querySelector("#follow-up-date"),Pn=document.querySelector("#manage-unknown-date"),In=Mn[0].querySelector("#follow-up-visitors"),Dn=Mn[0].querySelector("#follow-up-frequency"),Jn=Mn[0].querySelector(".communication-card-options"),Fn=Mn[0].querySelector("#follow-up-commitment-christ"),zn=Mn[0].querySelector("#follow-up-recommitment-christ"),Un=Mn[0].querySelector("#follow-up-commitment-tithe"),Rn=Mn[0].querySelector("#follow-up-commitment-ministry"),Gn=Mn[0].querySelector("#follow-up-commitment-baptism"),Vn=Mn[0].querySelector("#follow-up-info-next"),Yn=Mn[0].querySelector("#follow-up-info-gkids"),Bn=Mn[0].querySelector("#follow-up-info-ggroups"),Qn=Mn[0].querySelector("#follow-up-info-gteams"),Wn=Mn[0].querySelector("#follow-up-info-member"),Kn=Mn[0].querySelector("#follow-up-info-visit"),Zn=Mn[0].querySelector("#follow-up-comments"),Xn=$(".ui-dialog-title").text("Edit Follow Up"),eo=$(".ui-dialog-title").text("Edit Relationship"),to=-1,no=!0,oo=/^((\(?([2-9][0-8][0-9])\))|([2-9][0-8][0-9]))?[-. ]?([2-9][0-9]{2})[-. ]?([0-9]{4})$/,ao=document.querySelector("#map-panel"),ro="//maps.googleapis.com/maps/api/staticmap?zoom=11&size=400x400&markers=color:red%7Clabel:A|",io="https://www.google.com/maps/place/",so={1:"Phone Call",2:"Visit",3:"Communication Card",4:"Entered in The City",5:"Thank You Card Sent"},co={1:"Spouse",2:"Child",3:"Parent"},lo={1:"Member",2:"Regular",3:"Irregular"},uo={1:"1st Time",2:"2nd Time",3:"Often",4:"Member","":"--None Provided--"};(window.onpopstate=function(){var e,t=/\+/g,n=/([^&=]+)=?([^&]*)/g,o=function(e){return decodeURIComponent(e.replace(t," "))},a=window.location.search.substring(1);for($t={};null!==(e=n.exec(a));)$t[o(e[1])]=o(e[2])}).call(),$t.id||(window.location="attendance.html"),an.addEventListener("click",i),rn.addEventListener("click",u),sn.addEventListener("click",d),cn.addEventListener("click",nt),xn.addEventListener("click",it),qn.addEventListener("click",st),Ln.addEventListener("click",ct),An.addEventListener("click",ot),ln.addEventListener("click",q),$("#follow-up-type").on("change",ft),fn.addEventListener("click",Y),hn.addEventListener("click",Z),vn.addEventListener("click",B),$("#relationship-type").on("change",pt),En.addEventListener("click",N),$n.addEventListener("click",m),kn.addEventListener("click",p),wn.addEventListener("keydown",function(e){13==e.keyCode&&p()}),Sn.addEventListener("click",C),$("#manage-unknown-date").on("change",mt),checkLoginStatus(v)}}(),function(){"use strict";function e(){var e=$("#service-label-1"),t=$("#service-label-2");$.each(D.service_labels,function(n,o){e.append('<option value="'+n+'">'+o+"</option>"),t.append('<option value="'+n+'">'+o+"</option>")}),t.append('<option value="">--None--</option>'),e.val(D.default_first_service_label),t.val(D.default_second_service_label),e=$("#campus"),$.each(D.campuses,function(t,n){e.append('<option value="'+t+'">'+n+"</option>")}),e.val(D.default_campus)}function t(e,t){L.innerHTML=e?e:"N/A",A.innerHTML=t?t:"N/A";var n=new Date;x.value=$.datepicker.formatDate("mm/dd/yy",new Date(n.getFullYear(),n.getMonth(),1,0,0,0,0)),q.value=$.datepicker.formatDate("mm/dd/yy",n)}function n(){var e=parseInt(M.value);$("#from-to-dates")[0].style.setProperty("display",3===e||5===e?"none":""),$(".service-label-container").css("display",3===e||4===e||5===e?"none":""),(3===e||4===e||5===e)&&(x.value="",q.value=""),$("#first-last-dates")[0].style.setProperty("display",4===e?"none":"inherit"),$("#communication-card-header")[0].style.setProperty("display",4===e?"inherit":"none"),$("#follow-up-options")[0].style.setProperty("display",4===e?"inline-block":"none"),$("#follow-up-options-spacer")[0].style.setProperty("display",4===e?"inherit":"none")
}function o(){var e=parseInt(M.value);if((1===e||2===e)&&O.value==j.value)return $().toastmessage("showErrorToast","First and Second Service cannot be the same"),void 0;if(i(x.value,q.value,1===e||2===e)){switch(r(),z=N.value,J=O.value,F="",e){case 1:$("#attendance-by-date-container")[0].style.setProperty("display","inherit"),I={fromDate:x.value,toDate:q.value,campus:N.value,label1:O.value,label2:j.value},F=j.value,F?($(".service-header").css("display",""),$(".first-service-header").text(D.service_labels[J]),$(".second-service-header").text(D.service_labels[F])):$(".service-header").css("display","none");break;case 2:$("#attendance-by-person-container")[0].style.setProperty("display","inherit"),I={fromDate:x.value,toDate:q.value,campus:N.value,label1:O.value,label2:j.value},F=j.value,F?($(".service-header").css("display",""),$(".first-service-header").text(D.service_labels[J]),$(".second-service-header").text(D.service_labels[F])):$(".service-header").css("display","none");break;case 3:$("#attendance-by-mia-container")[0].style.setProperty("display","inherit"),I={fromDate:"",toDate:"",campus:N.value};break;case 4:$("#follow-up-container")[0].style.setProperty("display","inherit"),I=a(),I.campus=N.value;break;case 5:$("#people-by-attender-status-container")[0].style.setProperty("display","inherit"),I={fromDate:"",toDate:"",campus:N.value}}b(e,I)}}function a(){return{fromDate:x.value,toDate:q.value,active:$("#active").is(":checked"),not_visited:$("#not-visited").is(":checked"),ty_card_not_sent:$("#ty-card-not-sent").is(":checked"),signed_up_for_baptism:$("#signed-up-for-baptism").is(":checked"),baptized:$("#baptized").is(":checked"),interested_in_gkids:$("#interested-in-gkids").is(":checked"),interested_in_next:$("#interested-in-next").is(":checked"),interested_in_ggroups:$("#interested-in-ggroups").is(":checked"),interested_in_gteams:$("#interested-in-gteams").is(":checked"),interested_in_joining:$("#interested-in-joining").is(":checked"),would_like_visit:$("#would-like-visit").is(":checked"),no_agent:$("#no-agent").is(":checked"),commitment_christ:$("#commitment-christ").is(":checked"),recommitment_christ:$("#recommitment-christ").is(":checked"),commitment_tithe:$("#commitment-tithe").is(":checked"),commitment_ministry:$("#commitment-ministry").is(":checked"),attendance_frequency:$("#first-time-visitor").is(":checked")}}function r(){$("#attendance-by-person-container")[0].style.setProperty("display","none"),$("#attendance-by-date-container")[0].style.setProperty("display","none"),$("#attendance-by-mia-container")[0].style.setProperty("display","none"),$("#follow-up-container")[0].style.setProperty("display","none"),$("#people-by-attender-status-container")[0].style.setProperty("display","none")}function i(e,t,n){var o="";return w(e,!0)||(o+="From Date must be a valid date<br />"),w(t,!0)||(o+="To Date must be a valid date<br />"),o?($().toastmessage("showErrorToast",o),!1):!n||e||t?!0:($().toastmessage("showErrorToast","From Date or To Date must be specified"),!1)}function s(e,t){$("#attendance-date-table > tbody:last").empty(),$("#attendance-date-aggregates-table > tbody:last").empty();for(var n="",o=0;o<e.length;o++)n+=c(e[o]);$("#attendance-date-table > tbody:last").append(n),$("#attendance-date-aggregates-table > tbody:last").append(l(t))}function c(e){return U=""===F?"":'<td class="report-attendance-table-attendance-col" data-th="First">'+e.First_Service_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Second">'+e.Second_Service_Attendance+"</td>",'<tr><td data-th="Date">'+e.Attendance_dt+'</td><td class="report-attendance-table-attendance-col" data-th="Total">'+e.Total_Attendance+"</td>"+U+"</tr>"}function l(e){var t="";return U=""===F?"":'<td class="report-attendance-table-attendance-col" data-th="Average First">'+e.Avg_First_Service_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Average Second">'+e.Avg_Second_Service_Attendance+"</td>",t+='<tr><td data-th="Aggregate">Average</td><td class="report-attendance-table-attendance-col" data-th="Average Total">'+e.Avg_Total_Attendance+"</td>"+U+"</tr>",U=""===F?"":'<td class="report-attendance-table-attendance-col" data-th="Max First">'+e.Max_First_Service_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Max Second">'+e.Max_Second_Service_Attendance+"</td>",t+='<tr><td data-th="Aggregate">Max</td><td class="report-attendance-table-attendance-col" data-th="Max Total">'+e.Max_Total_Attendance+"</td>"+U+"</tr>",U=""===F?"":'<td class="report-attendance-table-attendance-col" data-th="Min First">'+e.Min_First_Service_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Min Second">'+e.Min_Second_Service_Attendance+"</td>",t+='<tr><td data-th="Aggregate">Min</td><td class="report-attendance-table-attendance-col" data-th="Min Total">'+e.Min_Total_Attendance+"</td>"+U+"</tr>"}function d(e){$("#adult-attendance-table > tbody:last").empty();for(var t="",n=0;n<e.length;n++)t+=v(e[n]);$("#adult-attendance-table > tbody:last").append(t)}function u(e){$("#mia-attendance-table > tbody:last").empty();for(var t="",n=0;n<e.length;n++)t+=h(e[n]);$("#mia-attendance-table > tbody:last").append(t)}function m(e){$("#follow-up-table > tbody:last").empty();for(var t="",n=0;n<e.length;n++)t+=_(e[n]);$("#follow-up-table > tbody:last").append(t)}function p(e){if($("#people-by-attender-status-table > tbody:last").empty(),0!==e.length){for(var t="",n="",o=0;o<e.length;o++)"true"==e[o].adult&&(e[o].attender_status!=n&&(t+=f(R[e[o].attender_status]),n=e[o].attender_status),t+=h(e[o]));$("#people-by-attender-status-table > tbody:last").append(t)}}function f(e){return'<tr class="row-header"><td>'+e+"</td></tr>"}function h(e){var t="";return e.first_name||e.last_name?(e.first_name&&(t+=e.first_name+" "),e.last_name&&(t+=e.last_name)):t=e.description,t='<a class="person_name" href="manage-person.html?id='+e.id+'">'+t+"</a>",'<tr adult="'+e.adult+'" personId="'+e.id+'"><td data-th="Name">'+t+"</td></tr>"}function v(e){return U=""===F?"":'<td class="report-attendance-table-attendance-col" data-th="First">'+e.First_Service_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Second">'+e.Second_Service_Attendance+"</td>",'<tr personId="'+e.id+'"><td data-th="Name"><a class="person_name" href="manage-person.html?id='+e.id+'">'+e.display+"</a></td>"+U+'<td class="report-attendance-table-attendance-col" data-th="Total">'+e.Total_Attendance+"</td></tr>"}function _(e){var t="",n=e.primary_phone||"";return e.first_name||e.last_name?(e.first_name&&(t+=e.first_name+" "),e.last_name&&(t+=e.last_name)):t=e.description,t='<a class="person_name" href="manage-person.html?id='+e.id+'">'+t+"</a>",n=S(n),'<tr personId="'+e.id+'"><td data-th="Name">'+t+'</td><td class="checkbox-table-col" data-th="Visited?"><input type="checkbox" disabled '+("true"===e.visited?"checked ":"")+'/></td><td class="checkbox-table-col" data-th="Phone Number">'+n+'</td><td data-th="Thank You<br />Card Sent">'+(e.ty_card_date||"")+'</td><td data-th="Communication Card<br />Received">'+(e.communication_card_date||"")+"</td></tr>"}function y(e){var t="#"+e.target.parentElement.previousElementSibling.id,n=-1==e.target.id.indexOf("top")?$(t)[0].scrollHeight:0;$(t).animate({scrollTop:n},G,"swing",function(){$("<style></style>").appendTo($(document.body)).remove()})}function g(){$.ajax({type:"POST",url:"ajax/get_service_options.php"}).done(function(t){$(".reports-form").unmask();var n=JSON.parse(t);n.success&&n.options?(D=n.options,e()):1===n.error?logout():$().toastmessage("showErrorToast","Error loading settings")}).fail(function(){$(".reports-form").unmask(),$().toastmessage("showErrorToast","Error loading settings")})}function b(e,t){$(".reports-form").mask("Loading..."),$.ajax({type:"POST",url:"ajax/get_report.php",data:{type:e,params:JSON.stringify(t)}}).done(function(t){$(".reports-form").unmask();var n=JSON.parse(t);if(n.success)switch(e){case 1:s(n.totals,n.aggregates);break;case 2:d(n.people);break;case 3:u(n.people);break;case 4:m(n.people);break;case 5:p(n.people)}else 1===n.error?logout():$().toastmessage("showErrorToast","Error loading report")}).fail(function(){$(".reports-form").unmask(),$().toastmessage("showErrorToast","Error loading report")})}function k(){$(".reports-form").mask("Loading..."),$.ajax({type:"GET",url:"ajax/get_first_last_service_dates.php"}).done(function(e){var n=JSON.parse(e);n.success?(t(n.first_dt,n.last_dt),g()):1===n.error?logout():$().toastmessage("showErrorToast","Error loading data")}).fail(function(){$(".reports-form").unmask(),$().toastmessage("showErrorToast","Error loading data")})}function w(e,t){var n=e;if(""===n)return!!t;var o=/^(\d{1,2})(\/|-)(\d{1,2})(\/|-)(\d{4})$/,a=n.match(o);if(null===a)return!1;var r=a[1],i=a[3],s=a[5];if(1>r||r>12)return!1;if(1>i||i>31)return!1;if((4==r||6==r||9==r||11==r)&&31==i)return!1;if(2==r){var c=s%4===0&&(s%100!==0||s%400===0);if(i>29||29==i&&!c)return!1}return!0}function S(e){if(e=e||"",null===e.match(/\D/g,"")){var t=e.replace(/\D/g);7===t.length?e=t.substr(0,3)+"-"+t.substr(3):10===t.length&&(e="("+t.substr(0,3)+") "+t.substr(3,3)+"-"+t.substr(6))}return e}function E(){var e=$.trim(H.value);return e&&H.checkValidity()?($(".reports-form").mask("Sending..."),$.ajax({type:"POST",url:"ajax/email_follow_up_summary.php",data:{email:e,params:JSON.stringify(I)}}).done(function(e){$(".reports-form").unmask();var t=JSON.parse(e);t.success?$().toastmessage("showSuccessToast","Summary sent successfully"):1===t.error?logout():$().toastmessage("showErrorToast","Error sending summary")}).fail(function(){$(".reports-form").unmask(),$().toastmessage("showErrorToast","Error sending summary")}),void 0):($().toastmessage("showErrorToast","Must specify a valid email"),void 0)}function T(){var e=$("#include-all-checkboxes input[type=checkbox]");$("#toggle-check").is(":checked")?e.each(function(e,t){t.checked=!0}):e.each(function(e,t){t.checked=!1})}if(0!==$("#reports").length){$("#from-date").datepicker(),$("#to-date").datepicker();var q=document.querySelector("#to-date"),x=document.querySelector("#from-date"),L=document.querySelector("#first-date"),A=document.querySelector("#last-date"),M=document.querySelector("#report-type"),O=document.querySelector("#service-label-1"),j=document.querySelector("#service-label-2"),N=document.querySelector("#campus"),C=document.querySelector("#go-arrow"),H=document.querySelector("#email"),P=document.querySelector("#email-summary"),I=null,D={},J=-1,F=-1,z=-1,U="",R={1:"Member",2:"Regular",3:"Irregular"},G=300;M.value="1",C.addEventListener("click",o),P.addEventListener("click",E),M.addEventListener("change",n),$(".top-bottom-links a").on("click",y),$("#toggle-check").on("change",T),checkLoginStatus(k)}}(),function(){"use strict";function e(){var e=$.trim(c.value);""===e?$().toastmessage("showErrorToast","Must enter Name"):t(e)}function t(e){$(".search-form").mask("Loading..."),$.ajax({type:"GET",url:"ajax/search.php",data:{search:e}}).done(function(e){var t=JSON.parse(e);t.success?(o(t.people),$(".search-form").unmask()):1===t.error?logout():$().toastmessage("showErrorToast","Error searching people")}).fail(function(){$().toastmessage("showErrorToast","Error searching people")})}function n(e,t){if(null===e)return"";var n="";return e.first_name||e.last_name?(e.last_name&&(n+=e.last_name),e.last_name&&e.first_name?t===!0?n+=", "+e.first_name:n=e.first_name+" "+n:e.first_name&&(n+=e.first_name+" ")):n=e.description,n}function o(e){$("#search-table tbody tr").remove();for(var t=0;t<e.length;t++)a(e[t])}function a(e){var t=n(e);$("#search-table > tbody:last").append('<tr person_id="'+e.id+'"><td data-th="Name" person_name="'+t+'"><a class="person_name" href="manage-person.html?id='+e.id+'">'+t+'</a></td><td data-th="Email">'+e.email+'</td><td data-th="Address">'+r(e)+"</td></tr>")}function r(e){var t="";return t+=e.street1||"",e.street1&&(t+="<br />"),t+=e.street2||"",e.street2&&(t+="<br />"),t+=e.city||"",e.city&&e.state&&(t+=","),t+=" ",t+=e.state||"",t+=" ",t+=e.zip||"",t.trim()}function i(e){var t=$("#search-table-container"),n=-1==e.target.id.indexOf("top")?t[0].scrollHeight:0;t.stop().animate({scrollTop:n},l,"swing",function(){$("<style></style>").appendTo($(document.body)).remove()})}if(0!==$(".search-form").length){var s=document.querySelector("#search"),c=document.querySelector("#search-name"),l=1e3;$(".navigation-links a").on("click",i),s.addEventListener("click",e),c.addEventListener("keydown",function(t){13==t.keyCode&&e()}),checkLoginStatus()}}(),function(){"use strict";function e(){var e="",n=$.trim(r.value),o=$.trim(i.value);return $.trim(a.value).length>500&&(e+="Email(s) cannot exceed 500 characters<br />"),n.length>500&&(e+="Campus(es) cannot exceed 500 characters<br />"),t(n)||(e+="Campus(es) have incorrect format<br />"),o.length>500&&(e+="Service Label(s) cannot exceed 500 characters<br />"),t(o)||(e+="Service Label(s) have incorrect format<br />"),l.validity.valid||(e+="Default Campus id must be greater than or equal to 1<br />"),s.validity.valid||(e+="Default First Service Label id must be greater than or equal to 1<br />"),c.validity.valid||(e+="Default Second Service Label id must be greater than or equal to 1<br />"),e?($().toastmessage("showErrorToast",e),!1):!0}function t(e){if(0===e.length)return!0;for(var t,n,o=e.split(","),a=0;a<o.length;a++){if(-1===o[a].indexOf("|"))return!1;if(t=o[a].split("|"),n=parseInt(t[0]),isNaN(n)||1>n)return!1;if(""===$.trim(t[1]))return!1}return!0}function n(){e()&&$.ajax({type:"POST",url:"ajax/save_settings.php",data:{startingPointEmails:a.value,campuses:r.value,serviceLabels:i.value,defaultCampus:l.value,defaultFirstServiceLabel:s.value,defaultSecondServiceLabel:c.value}}).done(function(e){var t=JSON.parse(e);t.success?$().toastmessage("showSuccessToast","Settings updated successfully"):1===t.error?logout():2===t.error?window.location="attendance.html":$().toastmessage("showErrorToast","Error updating settings")}).fail(function(){$().toastmessage("showErrorToast","Error updating settings")})}function o(){$.ajax({type:"POST",url:"ajax/get_settings.php"}).done(function(e){var t=JSON.parse(e);t.success?(a.value=t.starting_point_emails,r.value=t.campuses,i.value=t.service_labels,l.value=t.default_campus,s.value=t.default_first_service_label,c.value=t.default_second_service_label):1===t.error?logout():2===t.error?window.location="attendance.html":$().toastmessage("showErrorToast","Error loading settings")}).fail(function(){$().toastmessage("showErrorToast","Error loading settings")})}if(0!==$(".settings-form").length){var a=document.querySelector("#starting-point-emails"),r=document.querySelector("#campuses"),i=document.querySelector("#service-labels"),s=document.querySelector("#default-service-label-first"),c=document.querySelector("#default-service-label-second"),l=document.querySelector("#default-campus");document.getElementById("update").addEventListener("click",n),checkLoginStatus(o)}}();