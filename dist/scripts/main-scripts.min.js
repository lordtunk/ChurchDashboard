function checkLoginStatus(e){$.ajax({type:"POST",url:"ajax/check_login.php"}).done(function(t){var n=JSON.parse(t);n.success?e&&e():window.location="index.html"})}function logout(){confirm("If you have unsaved changes logging out will cause you to lose them. Continue?")&&$.ajax({type:"POST",url:"ajax/logout.php"}).done(function(){window.location="index.html"})}!function(){"use strict";function e(){window.location="ajax/export_attendance.php"}function t(){try{$(".attendance-form").mask("Loading..."),setTimeout(n,50)}catch(e){$(".attendance-form").unmask()}}function n(){var e,t,n,a,o,r,i,c,d,s,l=[];for(n=$("#adult-attendance-table > tbody:last").children(),e=0;e<n.length;e++)if(null!==n[e].getAttribute("modified")){if(a=n[e].getAttribute("personId"),r=n[e].querySelector("[name=name_description]"),c=_(a),d=k(a),r){if(o=$.trim(r.value),""===o)continue}else o=void 0;if(-1===a.indexOf("-")&&(s=x(a))){for(i=!1,t=0;t<s.attendance.length;t++)s.attendance[t].date===D&&(s.attendance[t].first=c,s.attendance[t].second=d,i=!0);i||s.attendance.push({date:D,first:c,second:d})}l.push({id:a,adult:!0,display:o,attendanceDate:D,first:c,second:d})}for(n=$("#kid-attendance-table > tbody:last").children(),e=0;e<n.length;e++)if(null!==n[e].getAttribute("modified")){if(a=n[e].getAttribute("personId"),r=n[e].querySelector("[name=name_description]")){if(o=$.trim(r.value),!o)continue}else o=void 0;l.push({id:a,adult:!1,display:o,attendanceDate:D,first:_(a),second:k(a)})}l.length>0?b(l):($(".attendance-form").unmask(),$().toastmessage("showWarningToast","No attendance was modified"))}function a(){(st||confirm("Clear out any unsaved changes?"))&&o()}function o(){st=!0,$("#adult-attendance-table > tbody:last").children().remove(),$("#kid-attendance-table > tbody:last").children().remove(),l(et)}function r(){K.blur(),st=!1;var e={id:L(),adult:!0},t=p(e,D);$("#adult-attendance-table > tbody:last").append(t),$("[personid="+e.id+"] input:checkbox").on("change",m),$("#adult-attendance-table-container").animate({scrollTop:$("#adult-attendance-table-container")[0].scrollHeight},lt)}function i(){Q.blur(),st=!1;var e={id:L(),adult:!1},t=p(e,D);$("#kid-attendance-table > tbody:last").append(t),$("[personid="+e.id+"] input:checkbox").on("change",m),$("#kid-attendance-table-container").animate({scrollTop:$("#kid-attendance-table-container")[0].scrollHeight},lt)}function c(){var e=new Date,t=e.getDate()-e.getDay(),n=new Date(e.setDate(t));I.value=E(n),D=I.value,F=n,X.innerHTML=I.value}function d(){st||confirm("If you change the date you will lose any unsaved changes. Continue?")?(F=new Date(I.value),D=I.value,o()):I.value=E(F),X.innerHTML=I.value}function s(e){var t="#"+(-1==e.target.id.indexOf("adult")?"kid":"adult")+"-attendance-table-container",n=$(t),a=-1==e.target.id.indexOf("top")?n[0].scrollHeight:0;n.stop().animate({scrollTop:a},lt,"swing",function(){$("<style></style>").appendTo($(document.body)).remove()})}function l(e){H(),M(),$(".attendance-table-attendance-col input:checkbox").off("change"),tt=0,nt=0,at=0,ot=0,rt=0,it=0,et=e;for(var t=D,n="",a="",o=0;o<et.length;o++)et[o].active==R.checked&&(et[o].adult?n+=u(et[o],t):a+=u(et[o],t));g(tt,nt,at,ot,rt,it),$("#adult-attendance-table > tbody:last").append(n),$("#kid-attendance-table > tbody:last").append(a),$(".attendance-table-attendance-col input:checkbox").on("change",m),q()}function u(e,t){j(e.id,e.last_name,e.adult);var n,a="",o="",r="",i=A(),c=A();return-1!=(n=T(e,t))&&(a=e.attendance[n].first?"checked":"",o=e.attendance[n].second?"checked":""),r=S(e),r='<a class="person_name" href="manage-person.html?id='+e.id+'">'+r+"</a>",e.adult?(a&&++nt,o&&++at,(a||o)&&++tt):(a&&++rt,o&&++it,(a||o)&&++ot),'<tr adult="'+e.adult+'" personId="'+e.id+'"><td data-th="Name"><button class="attendance-history-button"><i class="fa fa-archive" /></button>'+r+'</td><td class="attendance-table-attendance-col" service="first" data-th="First?"><label for="'+i+'"><input id="'+i+'" type="checkbox" '+a+'/></label></td><td class="attendance-table-attendance-col" service="second" data-th="Second?"><label for="'+c+'"><input id="'+c+'" type="checkbox" '+o+"/></label></td></tr>"}function p(e){var t=A(),n=A();return'<tr adult="'+e.adult+'" personId="'+e.id+'" modified="true"><td data-th="Name"><input name="name_description" type="text" placeholder="Last, First or Description" /></td><td class="attendance-table-attendance-col" service="first" data-th="First?"><label for="'+t+'"><input id="'+t+'" type="checkbox" /></label></td><td class="attendance-table-attendance-col" service="second" data-th="Second?"><label for="'+n+'"><input id="'+n+'" type="checkbox" /></label></td></tr>'}function f(e){if(st=!0,e&&0!==e.length){var t,n,a,o,r,i,c=[],d=0,s=0;for($("[personid^=-]").remove(),t=0;t<e.length;t++)et.push(e[t]),c.push(u(e[t],D));for(t=0;t<e.length;t++){for(o=e[t],r=!1,n=0;n<et.length;n++)if(a=et[n],a.adult===!0?d=n:s=n,a.adult===o.adult&&-1===w(o,a)){$(c[t]).insertBefore("[personid="+a.id+"]"),et.splice(n,0,o),r=!0;break}r===!1&&(o.adult===!0?($("#adult-attendance-table > tbody:last").append(c[t]),et.splice(d+1,0,o)):($("#kid-attendance-table > tbody:last").append(c[t]),et.splice(s+1,0,o))),i=$("[personid="+o.id+"]"),i.find("a.person_name").on("click",N),i.find("button.attendance-history-button").on("click",C),i.find("input:checkbox").on("change",m)}}}function m(e){var t=e.target,n=t.parentElement.parentElement.parentElement.getAttribute("personId"),a=t.parentElement.parentElement.parentElement.getAttribute("adult");st=!1,t.parentElement.parentElement.parentElement.setAttribute("modified",!0),"true"==a?("first"===t.parentElement.parentElement.getAttribute("service")?(t.checked?(++nt,k(n)||++tt):(--nt,k(n)||--tt),J.innerHTML=nt):"second"===t.parentElement.parentElement.getAttribute("service")&&(t.checked?(++at,_(n)||++tt):(--at,_(n)||--tt),U.innerHTML=at),P.innerHTML=tt):("first"===t.parentElement.parentElement.getAttribute("service")?(t.checked?(++rt,k(n)||++ot):(--rt,k(n)||--ot),G.innerHTML=rt):"second"===t.parentElement.parentElement.getAttribute("service")&&(t.checked?(++it,_(n)||++ot):(--it,_(n)||--ot),Y.innerHTML=it),z.innerHTML=ot)}function h(e){var t=x(e);if(t){$("#person-attendance-history-table > tbody:last").children().remove(),ut.dialog("open"),ut[0].querySelector("#person-name").innerHTML=S(t,!1);for(var n="",a=0;a<t.attendance.length;a++)n+=v(t.attendance[a]);$("#person-attendance-history-table > tbody:last").append(n)}}function v(e){var t=e.first?"checked":"",n=e.second?"checked":"";return'<tr><td data-th="Date">'+e.date+'</td><td class="attendance-table-attendance-col" service="first" data-th="First?"><input type="checkbox" '+t+' disabled/></td><td class="attendance-table-attendance-col" service="second" data-th="Second?"><input type="checkbox" '+n+" disabled/></td></tr>"}function g(e,t,n,a,o,r){tt=e,nt=t,at=n,P.innerHTML=e,J.innerHTML=t,U.innerHTML=n,ot=a,rt=o,it=r,z.innerHTML=a,G.innerHTML=o,Y.innerHTML=r}function y(){$(".attendance-form").mask("Loading..."),$.ajax({type:"GET",url:"ajax/get_attendance.php"}).done(function(e){$(".attendance-form").unmask();var t=JSON.parse(e);if(t.success){if(l(t.people),t.scroll_to_id&&t.scroll_to_id>=0){var n=$("[personid="+t.scroll_to_id+"]")[0];if(n){var a="true"==n.getAttribute("adult")?"adult":"kid",o="#"+a+"-attendance-table-container",r=$(o).offset().top,i=n.offsetTop;$("body").animate({scrollTop:r},300),$(o).animate({scrollTop:i},lt)}}}else 1===t.error?logout():$().toastmessage("showErrorToast","Error loading")}).fail(function(){$(".attendance-form").unmask(),$().toastmessage("showErrorToast","Error loading")})}function b(e){$.ajax({type:"POST",url:"ajax/save_people.php",data:{people:JSON.stringify(e)}}).done(function(e){$(".attendance-form").unmask();var t=JSON.parse(e);t.success?(f(t.people),$().toastmessage("showSuccessToast","Save successful")):1===t.error?logout():$().toastmessage("showErrorToast","Error saving")})}function _(e){return $("[personId="+e+"] input:checkbox:first")[0].checked}function k(e){return $("[personId="+e+"] input:checkbox:last")[0].checked}function w(e,t){if(e==t)return 0;if(null===e)return-1;if(null===t)return 1;var n=S(e,!0),a=S(t,!0);if(e.first_name||e.last_name){if(!t.first_name&&!t.last_name)return-1;if(n===a)return 0;if(n.toLowerCase()<a.toLowerCase())return-1;if(n.toLowerCase()>a.toLowerCase())return 1}else{if(t.first_name||t.last_name)return 1;if(n===a)return 0;if(n.toLowerCase()<a.toLowerCase())return-1;if(n.toLowerCase()>a.toLowerCase())return 1}}function S(e,t){if(null===e)return"";var n="";return e.first_name||e.last_name?(e.last_name&&(n+=e.last_name),e.last_name&&e.first_name?t===!0?n+=", "+e.first_name:n=e.first_name+" "+n:e.first_name&&(n+=e.first_name+" ")):n=e.description,n}function T(e,t){for(var n=0;n<e.attendance.length;n++)if(e.attendance[n].date===t)return n;return-1}function E(e){var t=e.getDate(),n=e.getMonth(),a=e.getFullYear();return t=10>t?"0"+t:""+t,n++,n=10>n?"0"+n:""+n,n+"/"+t+"/"+a}function x(e){for(var t=0;t<et.length;t++)if(et[t].id===e)return et[t];return null}function A(){return"id-"+ ++ct}function L(){return--dt}function q(){$("#attendance-nav").on("click",N),$("#reports-nav").on("click",N),$("a.person_name").on("click",N),$("button.attendance-history-button").on("click",C)}function M(){$("#attendance-nav").off("click",N),$("#reports-nav").off("click",N),$("a.person_name").off("click",N),$("button.attendance-history-button").off("click",C)}function C(){var e=this.parentElement.parentElement.getAttribute("personId");h(e)}function H(){document.querySelector("#adult-jump-to").innerHTML="<option>--Jump To Letter--</option>",document.querySelector("#kid-jump-to").innerHTML="<option>--Jump To Letter--</option>"}function j(e,t,n){if(t){var a="#"+(n?"adult":"kid")+"-jump-to",o=t.substr(0,1).toUpperCase();if(!($(a+' option:contains("'+o+'")').length>0)){var r=document.querySelector(a),i=document.createElement("option");i.setAttribute("scroll_to_id",e),i.innerHTML=o,r.appendChild(i)}}}function O(e){var t=e.target.options[e.target.options.selectedIndex];if(t){var n=$("[personid="+t.getAttribute("scroll_to_id")+"]")[0];if(n){var a="#"+(-1==e.target.id.indexOf("adult")?"kid":"adult")+"-attendance-table-container",o=$(a).offset().top,r=n.offsetTop;$("body").animate({scrollTop:o},300),$(a).animate({scrollTop:r},lt)}}}function N(e){st||confirm("If you continue you will lose any unsaved changes. Continue?")||e.preventDefault()}if(0!==$("#attendance").length){$("#attendance-date").datepicker();var F,D,I=document.querySelector("#attendance-date"),P=document.querySelector("#adult-total-attendance"),J=document.querySelector("#adult-first-service-attendance"),U=document.querySelector("#adult-second-service-attendance"),z=document.querySelector("#kid-total-attendance"),G=document.querySelector("#kid-first-service-attendance"),Y=document.querySelector("#kid-second-service-attendance"),R=document.querySelector("#active-true"),V=(document.querySelector("#active-false"),document.querySelector("#update")),B=document.querySelector("#cancel"),W=document.querySelector("#export"),Z=document.querySelector("#go-arrow"),K=document.querySelector("#add-adult"),Q=document.querySelector("#add-kid"),X=document.querySelector("#attendance-date-display"),et=[],tt=0,nt=0,at=0,ot=0,rt=0,it=0,ct=0,dt=-1,st=!0,lt=1e3,ut=$(".dialog-form").dialog({autoOpen:!1,height:400,width:450,modal:!0});c(),V.addEventListener("click",t),B.addEventListener("click",a),W.addEventListener("click",e),Z.addEventListener("click",d),K.addEventListener("click",r),Q.addEventListener("click",i),$(".jump-to").on("change",O),$(".navigation-links a").on("click",s),checkLoginStatus(y)}}(),function(){"use strict";function e(){var e=$("#follow-up-type");$.each(P,function(t,n){e.append("<option value="+t+">"+n+"</option>")}),e.val("2")}function t(){$.ajax({type:"GET",url:"ajax/get_visitors.php"}).done(function(t){var a=JSON.parse(t);a.success?(T=a.people,u(),e(),n()):1===a.error?logout():$().toastmessage("showErrorToast","Error loading visitors")}).fail(function(){$().toastmessage("showErrorToast","Error loading visitors")})}function n(){$.ajax({type:"GET",url:"ajax/get_follow_ups.php"}).done(function(e){var t=JSON.parse(e);t.success?d(t.follow_ups):1===t.error?logout():$().toastmessage("showErrorToast","Error loading visitors")}).fail(function(){$().toastmessage("showErrorToast","Error loading visitors")})}function a(e,t,n){$.ajax({type:"POST",url:"ajax/save_follow_up.php",data:{follow_up:JSON.stringify(e)}}).done(function(a){var o=JSON.parse(a);o.success?(e.id=o.follow_up_id,t.call(this,e,n),$().toastmessage("showSuccessToast","Save successful")):1===o.error?logout():$().toastmessage("showErrorToast","Error saving follow up")}).fail(function(){$().toastmessage("showErrorToast","Error saving follow up")})}function o(e){$.ajax({type:"POST",url:"ajax/delete_follow_up.php",data:{id:e}}).done(function(t){var n=JSON.parse(t);n.success?$("#follow-up-table tr[follow_up_id="+e+"]").remove():1===n.error?logout():$().toastmessage("showErrorToast","Error deleting Follow Up")}).fail(function(){$().toastmessage("showErrorToast","Error deleting Follow Up")})}function r(e,t){if(null===e)return"";var n="";return e.first_name||e.last_name?(e.last_name&&(n+=e.last_name),e.last_name&&e.first_name?t===!0?n+=", "+e.first_name:n=e.first_name+" "+n:e.first_name&&(n+=e.first_name+" ")):n=e.description,n}function i(){x.text("Add Follow Up"),L.innerHTML="",L.setAttribute("personid",""),q.value="2",M.value="",H.value="";for(var e=C.querySelectorAll("input"),t=0;t<e.length;t++)e[t].checked=!1}function c(){var e=$.trim(L.innerHTML),t=$.trim(L.getAttribute("personid")),n=$.trim(M.value),a=$.trim(q.value),o=$.trim(H.value),r=[],i=[];if(""===n&&""===o)return $().toastmessage("showErrorToast","Must specify either Date or Comments"),!1;if(o.length>5e3)return $().toastmessage("showErrorToast","Comments cannot exceed 5000 characters"),!1;for(var c=C.querySelectorAll("input"),d=0;d<c.length;d++)c[d].checked&&(r.push($.trim(c[d].previousSibling.innerHTML)),i.push(c[d].getAttribute("personid")));return{id:g()?S():A.value,date:n,name:e,personId:t,typeCd:a,type:q.selectedOptions[0].text,comments:o,visitors:r,visitorsIds:i}}function d(e){w(),$("#follow-up-table tbody tr").remove();for(var t=0;t<e.length;t++)s(e[t]);_()}function s(e){!e.type&&e.typeCd&&(e.type=P[e.typeCd]||""),e.date=e.date||"",e.name=e.name||"";var t=e.name;e.personId>=0&&(t='<a class="person_name" href="manage-person.html?id='+e.personId+'">'+t+"</a>"),$("#follow-up-table > tbody:last").append('<tr follow_up_id="'+e.id+'"><td data-th="Name" personid="'+e.personId+'">'+t+'</td><td data-th="Type" typeCd="'+e.typeCd+'">'+e.type+'</td><td data-th="Date" class="follow-up-table-date-col">'+e.date+'</td><td data-th="By" visitorsIds="'+e.visitorsIds.join(",")+'">'+e.visitors.join(", ")+'</td><td data-th="Comments" class="follow-up-table-comments-col">'+e.comments+'</td><td data-th="" class="follow-up-table-button-col"><button class="edit-follow-up"><i class="fa fa-edit"></i></button><button class="delete-follow-up"><i class="fa fa-minus-circle"></i></button></td></tr>')}function l(e){var t=$("#follow-up-table tr[follow_up_id="+e.id+"]").children();t[0].setAttribute("personid",e.personId),t[0].innerHTML=e.name,t[1].setAttribute("typeCd",e.typeCd),t[1].innerHTML=e.type,t[2].innerHTML=e.date,t[3].innerHTML=e.visitors.join(", "),t[4].setAttribute("visitorsIds",e.visitorsIds.join(",")),t[4].innerHTML=e.comments}function u(){if(""===C.innerHTML.trim())for(var e,t=0;t<T.length;t++)e=T[t],C.innerHTML+='<div class="check-field"><label for="follow-up-by-'+e.id+'">'+r(e)+'</label><input type="checkbox" personid="'+e.id+'" id="follow-up-by-'+e.id+'"/></div>'}function p(e,t){s(e),$("button.edit-follow-up:last").on("click",v),$("button.delete-follow-up:last").on("click",k),t===!0&&i()}function f(e,t){l(e),t===!0&&i()}function m(){var e=c();return e===!1?!1:(a(e,g()?p:f,!1),void 0)}function h(){var e=c();return e===!1?!1:(a(e,g()?p:f,!0),void 0)}function v(e){var t=e.currentTarget.parentElement.parentElement;L.setAttribute("personid",t.children[0].getAttribute("personid")||""),L.innerHTML=t.children[0].innerHTML||"",q.value=t.children[1].getAttribute("typeCd")||"",M.value=t.children[2].innerHTML||"",H.value=t.children[4].innerHTML||"",A.value=t.getAttribute("follow_up_id");for(var n=t.children[3].getAttribute("visitorsIds")||"",a=n.split(","),o=C.querySelectorAll("input"),r=0;r<o.length;r++)o[r].checked=a.indexOf(o[r].getAttribute("personid"))>=0;x.text("Edit Follow Up")}function g(){return-1===x.text().indexOf("Edit")}function y(){F.dialog("open")}function b(e){E||confirm("If you continue you will lose any unsaved changes. Continue?")||e.preventDefault()}function _(){$("#attendance-nav").on("click",b),$("#reports-nav").on("click",b),$("button.edit-follow-up").on("click",v),$("button.delete-follow-up").on("click",k)}function k(e){if(confirm("Are you sure you would like to PERMANENTLY delete this Follow Up?")){var t=e.currentTarget.parentElement.parentElement.getAttribute("follow_up_id");o(t)}}function w(){$("#attendance-nav").off("click",b),$("#reports-nav").off("click",b),$("button.edit-follow-up").off("click",v),$("button.delete-follow-up").off("click",k)}function S(){return--I}if(0!==$(".follow-ups-form").length){$("#follow-up-date").datepicker();var T=[],E=!0,x=$("#follow-ups-form-title"),A=document.querySelector("#follow-up-id"),L=document.querySelector("#follow-up-person"),q=document.querySelector("#follow-up-type"),M=document.querySelector("#follow-up-date"),C=document.querySelector("#follow-up-visitors"),H=document.querySelector("#follow-up-comments"),j=document.querySelector("#add-clear"),O=document.querySelector("#add-copy"),N=document.querySelector("#clear"),F=$(".dialog-form").dialog({autoOpen:!1,height:400,width:510,modal:!0}),D=document.querySelector("#select-person-btn"),I=-1,P={1:"Phone Call",2:"Visit",3:"Communication Card",4:"Entered in The City",5:"Thank You Card Sent"};O.addEventListener("click",m),j.addEventListener("click",h),N.addEventListener("click",i),D.addEventListener("click",y),checkLoginStatus(t)}}(),function(){"use strict";function e(){var e=o.value,a=r.value;t(e,a)&&n(e,$.md5(a))}function t(e,t){var n="";return $.trim(e)||(n+="Username cannot be blank<br />"),t||(n+="Password cannot be blank<br />"),n?($().toastmessage("showErrorToast",n),!1):!0}function n(e,t){$.ajax({type:"POST",url:"ajax/login.php",data:{username:e,password:t}}).done(function(e){var t=JSON.parse(e);t.success?window.location="attendance.html":$().toastmessage("showErrorToast","Username or password is incorrect")})}var a=document.querySelector("#login-btn"),o=document.querySelector("#username"),r=document.querySelector("#password");a&&(a.addEventListener("click",e),$(document).keypress(function(t){13==t.which&&e()}))}(),function(){"use strict";function e(){a.classList.remove("open"),n.classList.remove("open")}function t(){a.classList.toggle("open"),n.classList.toggle("open")}if(0!==$(".menu").length){var n=document.querySelector(".navdrawer-container"),a=document.querySelector(".app-bar"),o=document.querySelector(".menu"),r=document.querySelector("main");r.addEventListener("touchstart",e),r.addEventListener("click",e),o.addEventListener("click",t),n.addEventListener("click",function(t){("A"===t.target.nodeName||"LI"===t.target.nodeName)&&e()})}}(),function(){"use strict";function e(e){var t=$("#state");$.each(e,function(e,n){t.append("<option value="+n.abbreviation+">"+n.name+"</option>")}),t.val("OH")}function t(){var e=$("#follow-up-type");$.each(Ft,function(t,n){e.append("<option value="+t+">"+n+"</option>")}),e.val("2")}function n(e){J.value=e.first_name,U.value=e.last_name,z.value=e.description,G.value=e.first_visit,Y.innerHTML=e.first_attendance_dt||"",R.checked=e.adult,V.checked=e.active,B.checked=e.baptized,W.checked=e.saved,Z.checked=e.member,K.checked=e.visitor,Q.checked=e.assigned_agent,X.value=e.street1,et.value=e.street2,tt.value=e.city,nt.value=e.zip,e.state&&(rt.value=e.state),email.value=e.email,at.value=F(e.primary_phone),ot.value=F(e.secondary_phone),it.checked=e.commitment_christ,ct.checked=e.recommitment_christ,dt.checked=e.commitment_tithe,st.checked=e.commitment_ministry,lt.checked=e.commitment_baptism,ut.checked=e.info_next,pt.checked=e.info_gkids,ft.checked=e.info_ggroups,mt.checked=e.info_gteams,ht.checked=e.info_member,vt.checked=e.info_visit,a(e),y(e.follow_ups)}function a(e){var t=C(e);jt.innerHTML="OH"===t||""===t?"":'<a href="'+Nt+t+'" target="_blank"><img border="0" src="'+Ot+t+'" /></a>'}function o(){var e={id:I.id,first_name:$.trim(J.value),last_name:$.trim(U.value),description:$.trim(z.value),first_visit:$.trim(G.value),adult:R.checked,active:V.checked,baptized:B.checked,saved:W.checked,member:Z.checked,visitor:K.checked,assigned_agent:Q.checked,street1:$.trim(X.value),street2:$.trim(et.value),city:$.trim(tt.value),zip:$.trim(nt.value),state:$.trim(rt.value),email:$.trim(email.value),primary_phone:$.trim(at.value),secondary_phone:$.trim(ot.value),commitment_christ:it.checked,recommitment_christ:ct.checked,commitment_tithe:dt.checked,commitment_ministry:st.checked,commitment_baptism:lt.checked,info_next:ut.checked,info_gkids:pt.checked,info_ggroups:ft.checked,info_gteams:mt.checked,info_member:ht.checked,info_visit:vt.checked,follow_ups:r()};i(e)&&p(e)}function r(){var e=[];return $("#follow-up-table tbody tr").each(function(t,n){e.push({id:n.getAttribute("follow_up_id"),typeCd:n.children[0].getAttribute("typeCd")||"",date:n.children[1].innerHTML||"",comments:n.children[3].innerHTML||"",visitorsIds:n.children[2].getAttribute("visitorsIds").split(",")||"",visitors:n.children[2].innerHTML.split(", ")||""})}),e}function i(e){var t="",n="",a=!!e.first_name,o=!!e.last_name,r=!!e.description;return!a&&o?t+="First Name cannot be blank if Last Name is specified<br />":a&&!o?t+="Last Name cannot be blank if First Name is specified<br />":a||o||r||(t+="Must specify either First and Last Name or Description<br />"),e.first_name.length>50&&(t+="First Name cannot exceed 50 characters<br />"),e.last_name.length>50&&(t+="Last Name cannot exceed 50 characters<br />"),e.description.length>250&&(t+="Description cannot exceed 250 characters<br />"),e.email.length>100&&(t+="Email cannot exceed 100 characters<br />"),email.checkValidity()||(n+="Email is not valid<br />"),e.primary_phone.length>15&&(t+="Primary Phone cannot exceed 15 characters<br />"),e.secondary_phone.length>15&&(t+="Secondary Phone cannot exceed 15 characters<br />"),e.street1.length>100&&(t+="Street 1 cannot exceed 100 characters<br />"),e.street2.length>100&&(t+="Street 2 cannot exceed 100 characters<br />"),e.city.length>100&&(t+="City cannot exceed 100 characters<br />"),e.zip.length>5&&(t+="Zip Code cannot exceed 5 characters<br />"),e.street1.length>100&&(t+="Street 1 cannot exceed 100 characters<br />"),t?($().toastmessage("showErrorToast",t),!1):(n&&$().toastmessage("showWarningToast",n),!0)}function c(){confirm("Deleting someone also deletes their attendance history. Continue?")&&f()}function d(){n(I),Ht=!0}function s(){$.ajax({type:"GET",url:"ajax/states.json"}).done(function(n){if($.isArray(n))e(n);else{var a=JSON.parse(n);e(a)}t(),u(),l()}).fail(function(){$().toastmessage("showErrorToast","Error loading states")})}function l(){$.ajax({type:"GET",url:"ajax/get_visitors.php"}).done(function(e){var t=JSON.parse(e);t.success?P=t.people:1===t.error?logout():$().toastmessage("showErrorToast","Error loading visitors")}).fail(function(){$().toastmessage("showErrorToast","Error loading visitors")})}function u(){$.ajax({type:"GET",url:"ajax/get_person.php",data:{id:D.id}}).done(function(e){var t=JSON.parse(e);t.success?(I=t.person,n(t.person)):1===t.error?logout():$().toastmessage("showErrorToast","Error loading")}).fail(function(){$().toastmessage("showErrorToast","Error loading person")})}function p(e){$.ajax({type:"POST",url:"ajax/save_person.php",data:{person:JSON.stringify(e)}}).done(function(t){var n=JSON.parse(t);n.success?(Ht=!0,a(e),$().toastmessage("showSuccessToast","Save successful")):1===n.error?logout():$().toastmessage("showErrorToast","Error saving person")}).fail(function(){$().toastmessage("showErrorToast","Error saving person")})}function f(){$.ajax({type:"POST",url:"ajax/delete_person.php",data:{id:I.id}}).done(function(e){var t=JSON.parse(e);t.success?window.location="attendance.html":1===t.error?logout():$().toastmessage("showErrorToast","Error deleting person")}).fail(function(){$().toastmessage("showErrorToast","Error deleting person")})}function m(e){$.ajax({type:"POST",url:"ajax/delete_follow_up.php",data:{id:e}}).done(function(t){var n=JSON.parse(t);n.success?$("#follow-up-table tr[follow_up_id="+e+"]").remove():1===n.error?logout():$().toastmessage("showErrorToast","Error deleting Follow Up")}).fail(function(){$().toastmessage("showErrorToast","Error deleting Follow Up")})}function h(e,t){if(null===e)return"";var n="";return e.first_name||e.last_name?(e.last_name&&(n+=e.last_name),e.last_name&&e.first_name?t===!0?n+=", "+e.first_name:n=e.first_name+" "+n:e.first_name&&(n+=e.first_name+" ")):n=e.description,n}function v(){xt.value="2",At.value="",qt.value="";for(var e=Lt.querySelectorAll("input"),t=0;t<e.length;t++)e[t].checked=!1}function g(){var e=$.trim(At.value),t=$.trim(xt.value),n=$.trim(qt.value),a=[],o=[];if(""===e&&""===n)return $().toastmessage("showErrorToast","Must specify either Date or Comments"),!1;if(n.length>5e3)return $().toastmessage("showErrorToast","Comments cannot exceed 5000 characters"),!1;for(var r=Lt.querySelectorAll("input"),i=0;i<r.length;i++)r[i].checked&&(a.push($.trim(r[i].previousSibling.innerHTML)),o.push(r[i].getAttribute("personid")));return{id:-1===Mt.text().indexOf("Edit")?N():Et.value,date:e,typeCd:t,type:xt.selectedOptions[0].text,comments:n,visitors:a,visitorsIds:o}}function y(e){O(),$("#follow-up-table tbody tr").remove();for(var t=0;t<e.length;t++)b(e[t]);j()}function b(e){!e.type&&e.typeCd&&(e.type=Ft[e.typeCd]||""),e.date=e.date||"",$("#follow-up-table > tbody:last").append('<tr follow_up_id="'+e.id+'"><td data-th="Type" typeCd="'+e.typeCd+'">'+e.type+'</td><td data-th="Date" class="follow-up-table-date-col">'+e.date+'</td><td data-th="By" visitorsIds="'+e.visitorsIds.join(",")+'">'+e.visitors.join(", ")+'</td><td data-th="Comments" class="follow-up-table-comments-col">'+e.comments+'</td><td data-th="" class="follow-up-table-button-col"><button class="edit-follow-up"><i class="fa fa-edit"></i></button><button class="delete-follow-up"><i class="fa fa-minus-circle"></i></button></td></tr>')}function _(e){var t=$("#follow-up-table tr[follow_up_id="+e.id+"]").children();t[0].setAttribute("typeCd",e.typeCd),t[0].innerHTML=e.type,t[1].innerHTML=e.date,t[2].innerHTML=e.visitors.join(", "),t[2].setAttribute("visitorsIds",e.visitorsIds.join(",")),t[3].innerHTML=e.comments}function k(){if(""===Lt.innerHTML.trim())for(var e,t=0;t<P.length;t++)e=P[t],Lt.innerHTML+='<div class="check-field"><label for="follow-up-by-'+e.id+'">'+h(e)+'</label><input type="checkbox" personid="'+e.id+'" id="follow-up-by-'+e.id+'"/></div>'}function w(){Tt.dialog("open"),v(),k(),Mt.text("Add Follow Up")}function S(){Tt.dialog("close")}function T(){var e=g();return e===!1?!1:(b(e),$("button.edit-follow-up:last").on("click",q),$("button.delete-follow-up:last").on("click",M),Ht=!1,e)}function E(){var e=g();return e===!1?!1:(_(e),Ht=!1,e)}function x(){-1===Mt.text().indexOf("Edit")?T():E()}function A(){var e;e=-1===Mt.text().indexOf("Edit")?T():E(),e&&v()}function L(){var e;e=-1===Mt.text().indexOf("Edit")?T():E(),e&&Tt.dialog("close")}function q(e){Tt.dialog("open"),k();var t=e.currentTarget.parentElement.parentElement;xt.value=t.children[0].getAttribute("typeCd")||"",At.value=t.children[1].innerHTML||"",qt.value=t.children[3].innerHTML||"",Et.value=t.getAttribute("follow_up_id");for(var n=t.children[2].getAttribute("visitorsIds")||"",a=n.split(","),o=Lt.querySelectorAll("input"),r=0;r<o.length;r++)o[r].checked=a.indexOf(o[r].getAttribute("personid"))>=0;Mt.text("Edit Follow Up")}function M(e){if(confirm("Are you sure you would like to PERMANENTLY delete this Follow Up?")){var t=e.currentTarget.parentElement.parentElement.getAttribute("follow_up_id");m(t)}}function C(e){var t="";return t+=e.street1||"",t+=" ",t+=e.street2||"",t+=" ",t+=e.city||"",t+=" ",t+=e.state||"",t+=" ",t+=e.zip||"",t.trim()}function H(e){Ht||confirm("If you continue you will lose any unsaved changes. Continue?")||e.preventDefault()}function j(){$("#attendance-nav").on("click",H),$("#reports-nav").on("click",H),$("button.edit-follow-up").on("click",q),$("button.delete-follow-up").on("click",M)}function O(){$("#attendance-nav").off("click",H),$("#reports-nav").off("click",H),$("button.edit-follow-up").off("click",q),$("button.delete-follow-up").off("click",M)}function N(){return--Ct}function F(e){if(e=e||"",null===e.match(/\D/g,"")){var t=e.replace(/\D/g);7===t.length?e=t.substr(0,3)+"-"+t.substr(3):10===t.length&&(e="("+t.substr(0,3)+") "+t.substr(3,3)+"-"+t.substr(6))}return e}if(0!==$("#manage-person").length){$("#follow-up-date").datepicker(),$("#first-visit").datepicker();var D={},I={},P=[],J=document.querySelector("#first-name"),U=document.querySelector("#last-name"),z=document.querySelector("#description"),G=document.querySelector("#first-visit"),Y=document.querySelector("#first-recorded-visit"),R=document.querySelector("#adult"),V=document.querySelector("#active"),B=document.querySelector("#baptized"),W=document.querySelector("#saved"),Z=document.querySelector("#member"),K=document.querySelector("#visitor"),Q=document.querySelector("#assigned-agent"),X=document.querySelector("#street1"),et=document.querySelector("#street2"),tt=document.querySelector("#city"),nt=document.querySelector("#zip"),at=document.querySelector("#primary-phone"),ot=document.querySelector("#secondary-phone"),rt=document.querySelector("#state"),it=document.querySelector("#commitment-christ"),ct=document.querySelector("#recommitment-christ"),dt=document.querySelector("#commitment-tithe"),st=document.querySelector("#commitment-ministry"),lt=document.querySelector("#commitment-baptism"),ut=document.querySelector("#info-next"),pt=document.querySelector("#info-gkids"),ft=document.querySelector("#info-ggroups"),mt=document.querySelector("#info-gteams"),ht=document.querySelector("#info-member"),vt=document.querySelector("#info-visit"),gt=document.querySelector("#update"),yt=document.querySelector("#cancel"),bt=document.querySelector("#delete"),_t=document.querySelector("#add-follow-up"),$t=(document.querySelector("#edit-follow-up"),document.querySelector("#d-follow-up"),document.querySelector("#add-clear")),kt=document.querySelector("#add-copy"),wt=document.querySelector("#add-close"),St=document.querySelector("#close"),Tt=$(".dialog-form").dialog({autoOpen:!1,height:400,width:510,modal:!0}),Et=Tt[0].querySelector("#follow-up-id"),xt=Tt[0].querySelector("#follow-up-type"),At=Tt[0].querySelector("#follow-up-date"),Lt=Tt[0].querySelector("#follow-up-visitors"),qt=Tt[0].querySelector("#follow-up-comments"),Mt=$(".ui-dialog-title").text("Edit Follow Up"),Ct=-1,Ht=!0,jt=document.querySelector("#map-panel"),Ot="//maps.googleapis.com/maps/api/staticmap?zoom=11&size=400x400&markers=color:red%7Clabel:A|",Nt="https://www.google.com/maps/place/",Ft={1:"Phone Call",2:"Visit",3:"Communication Card",4:"Entered in The City",5:"Thank You Card Sent"};(window.onpopstate=function(){var e,t=/\+/g,n=/([^&=]+)=?([^&]*)/g,a=function(e){return decodeURIComponent(e.replace(t," "))},o=window.location.search.substring(1);for(D={};null!==(e=n.exec(o));)D[a(e[1])]=a(e[2])}).call(),D.id||(window.location="attendance.html"),gt.addEventListener("click",o),yt.addEventListener("click",d),bt.addEventListener("click",c),_t.addEventListener("click",w),kt.addEventListener("click",x),$t.addEventListener("click",A),wt.addEventListener("click",L),St.addEventListener("click",S),checkLoginStatus(s)}}(),function(){"use strict";function e(e,t){k.innerHTML=e?e:"N/A",w.innerHTML=t?t:"N/A";
var n=new Date;_.value=$.datepicker.formatDate("mm/dd/yy",new Date(n.getFullYear(),n.getMonth(),1,0,0,0,0)),b.value=$.datepicker.formatDate("mm/dd/yy",n)}function t(){var e=parseInt(S.value);$("#report-type-container")[0].style.setProperty("display",3===e?"inline-block":"block"),$("#from-to-dates")[0].style.setProperty("display",3===e?"none":"inline-block"),3===e&&(_.value="",b.value=""),$("#communication-card-header")[0].style.setProperty("display",4===e?"inherit":"none"),$("#follow-up-options")[0].style.setProperty("display",4===e?"inline-block":"none"),$("#follow-up-options-spacer")[0].style.setProperty("display",4===e?"inherit":"none")}function n(){var e=parseInt(S.value);if(o(_.value,b.value,1===e||2===e)){a();var t;switch(e){case 1:$("#attendance-by-date-container")[0].style.setProperty("display","inherit"),t={fromDate:_.value,toDate:b.value};break;case 2:$("#attendance-by-person-container")[0].style.setProperty("display","inherit"),t={fromDate:_.value,toDate:b.value};break;case 3:$("#attendance-by-mia-container")[0].style.setProperty("display","inherit");break;case 4:$("#follow-up-container")[0].style.setProperty("display","inherit"),t={fromDate:_.value,toDate:b.value,not_visited:$("#not-visited").is(":checked"),ty_card_not_sent:$("#ty-card-not-sent").is(":checked"),signed_up_for_baptism:$("#signed-up-for-baptism").is(":checked"),baptized:$("#baptized").is(":checked"),interested_in_gkids:$("#interested-in-gkids").is(":checked"),interested_in_next:$("#interested-in-next").is(":checked"),interested_in_ggroups:$("#interested-in-ggroups").is(":checked"),interested_in_gteams:$("#interested-in-gteams").is(":checked"),interested_in_joining:$("#interested-in-joining").is(":checked"),would_like_visit:$("#would-like-visit").is(":checked"),no_agent:$("#no-agent").is(":checked")}}h(e,t)}}function a(){$("#attendance-by-person-container")[0].style.setProperty("display","none"),$("#attendance-by-date-container")[0].style.setProperty("display","none"),$("#attendance-by-mia-container")[0].style.setProperty("display","none"),$("#follow-up-container")[0].style.setProperty("display","none")}function o(e,t,n){var a="";return g(e,!0)||(a+="From Date must be a valid date<br />"),g(t,!0)||(a+="To Date must be a valid date<br />"),a?($().toastmessage("showErrorToast",a),!1):!n||e||t?!0:($().toastmessage("showErrorToast","From Date or To Date must be specified"),!1)}function r(e,t){$("#attendance-date-table > tbody:last").empty(),$("#attendance-date-aggregates-table > tbody:last").empty();for(var n="",a=0;a<e.length;a++)n+=i(e[a]);$("#attendance-date-table > tbody:last").append(n),$("#attendance-date-aggregates-table > tbody:last").append(c(t))}function i(e){return'<tr><td data-th="Date">'+e.Attendance_dt+'</td><td class="report-attendance-table-attendance-col" data-th="Total">'+e.Total_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="First">'+e.First_Service_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Second">'+e.Second_Service_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="First Adult">'+e.First_Service_Adult_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Second Adult">'+e.Second_Service_Adult_Attendance+"</td></tr>"}function c(e){var t="",n=e[0];return t+='<tr><td data-th="Aggregate">Average</td><td class="report-attendance-table-attendance-col" data-th="Average Total">'+n.Avg_Total_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Average First">'+n.Avg_First_Service_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Average Second">'+n.Avg_Second_Service_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Average First Adult">'+n.Avg_First_Service_Adult_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Average Second Adult">'+n.Avg_Second_Service_Adult_Attendance+"</td></tr>",t+='<tr><td data-th="Aggregate">Max</td><td class="report-attendance-table-attendance-col" data-th="Max Total">'+n.Max_Total_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Max First">'+n.Max_First_Service_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Max Second">'+n.Max_Second_Service_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Max First Adult">'+n.Max_First_Service_Adult_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Max Second Adult">'+n.Max_Second_Service_Adult_Attendance+"</td></tr>",t+='<tr><td data-th="Aggregate">Min</td><td class="report-attendance-table-attendance-col" data-th="Min Total">'+n.Min_Total_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Min First">'+n.Min_First_Service_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Min Second">'+n.Min_Second_Service_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Min First Adult">'+n.Min_First_Service_Adult_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Min Second Adult">'+n.Min_Second_Service_Adult_Attendance+"</td></tr>"}function d(e){$("#adult-attendance-table > tbody:last").empty();for(var t="",n=0;n<e.length;n++)"true"==e[n].adult&&(t+=p(e[n]));$("#adult-attendance-table > tbody:last").append(t)}function s(e){$("#mia-attendance-table > tbody:last").empty();for(var t="",n=0;n<e.length;n++)"true"==e[n].adult&&(t+=u(e[n]));$("#mia-attendance-table > tbody:last").append(t)}function l(e){$("#follow-up-table > tbody:last").empty();for(var t="",n=0;n<e.length;n++)t+=f(e[n]);$("#follow-up-table > tbody:last").append(t)}function u(e){var t="";return e.first_name||e.last_name?(e.first_name&&(t+=e.first_name+" "),e.last_name&&(t+=e.last_name)):t=e.description,t='<a class="person_name" href="manage-person.html?id='+e.id+'">'+t+"</a>",'<tr adult="'+e.adult+'" personId="'+e.id+'"><td data-th="Name">'+t+"</td></tr>"}function p(e){var t="";return e.first_name||e.last_name?(e.first_name&&(t+=e.first_name+" "),e.last_name&&(t+=e.last_name)):t=e.description,t='<a class="person_name" href="manage-person.html?id='+e.id+'">'+t+"</a>",'<tr adult="'+e.adult+'" personId="'+e.id+'"><td data-th="Name">'+t+'</td><td class="report-attendance-table-attendance-col" data-th="First">'+e.First_Service_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Second">'+e.Second_Service_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Total">'+e.Total_Attendance+"</td></tr>"}function f(e){var t="",n=e.primary_phone||"";return e.first_name||e.last_name?(e.first_name&&(t+=e.first_name+" "),e.last_name&&(t+=e.last_name)):t=e.description,t='<a class="person_name" href="manage-person.html?id='+e.id+'">'+t+"</a>",n=y(n),'<tr personId="'+e.id+'"><td data-th="Name">'+t+'</td><td class="checkbox-table-col" data-th="Visited?"><input type="checkbox" disabled '+("true"===e.visited?"checked ":"")+'/></td><td class="checkbox-table-col" data-th="Phone Number">'+n+'</td><td data-th="Thank You<br />Card Sent">'+(e.ty_card_date||"")+'</td><td data-th="Communication Card<br />Received">'+(e.communication_card_date||"")+"</td></tr>"}function m(e){var t="#"+e.target.parentElement.previousElementSibling.id,n=-1==e.target.id.indexOf("top")?$(t)[0].scrollHeight:0;$(t).animate({scrollTop:n},E,"swing",function(){$("<style></style>").appendTo($(document.body)).remove()})}function h(e,t){$(".reports-form").mask("Loading..."),$.ajax({type:"POST",url:"ajax/get_report.php",data:{type:e,params:JSON.stringify(t)}}).done(function(t){$(".reports-form").unmask();var n=JSON.parse(t);if(n.success)switch(e){case 1:r(n.totals,n.aggregates);break;case 2:d(n.people);break;case 3:s(n.people);break;case 4:l(n.people)}else 1===n.error?logout():$().toastmessage("showErrorToast","Error loading report")}).fail(function(){$(".reports-form").unmask(),$().toastmessage("showErrorToast","Error loading report")})}function v(){$(".reports-form").mask("Loading..."),$.ajax({type:"GET",url:"ajax/get_first_last_service_dates.php"}).done(function(t){$(".reports-form").unmask();var n=JSON.parse(t);n.success?e(n.first_dt,n.last_dt):1===n.error?logout():$().toastmessage("showErrorToast","Error loading data")}).fail(function(){$(".reports-form").unmask(),$().toastmessage("showErrorToast","Error loading data")})}function g(e,t){var n=e;if(""===n)return!!t;var a=/^(\d{1,2})(\/|-)(\d{1,2})(\/|-)(\d{4})$/,o=n.match(a);if(null===o)return!1;var r=o[1],i=o[3],c=o[5];if(1>r||r>12)return!1;if(1>i||i>31)return!1;if((4==r||6==r||9==r||11==r)&&31==i)return!1;if(2==r){var d=c%4===0&&(c%100!==0||c%400===0);if(i>29||29==i&&!d)return!1}return!0}function y(e){if(e=e||"",null===e.match(/\D/g,"")){var t=e.replace(/\D/g);7===t.length?e=t.substr(0,3)+"-"+t.substr(3):10===t.length&&(e="("+t.substr(0,3)+") "+t.substr(3,3)+"-"+t.substr(6))}return e}if(0!==$("#reports").length){$("#from-date").datepicker(),$("#to-date").datepicker();var b=document.querySelector("#to-date"),_=document.querySelector("#from-date"),k=document.querySelector("#first-date"),w=document.querySelector("#last-date"),S=document.querySelector("#report-type"),T=document.querySelector("#go-arrow"),E=300;S.value="1",T.addEventListener("click",n),S.addEventListener("change",t),$(".top-bottom-links a").on("click",m),checkLoginStatus(v)}}();