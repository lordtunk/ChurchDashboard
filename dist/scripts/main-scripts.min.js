function checkLoginStatus(e){$.ajax({type:"POST",url:"ajax/check_login.php"}).done(function(t){var a=JSON.parse(t);a.success?e&&e():window.location="index.html"})}function logout(){confirm("If you have unsaved changes logging out will cause you to lose them. Continue?")&&$.ajax({type:"POST",url:"ajax/logout.php"}).done(function(e){var t=JSON.parse(e);t.success?window.location="index.html":$().toastmessage("showErrorToast","Problem logging out")})}!function(){"use strict";function e(){try{$(".attendance-form").mask("Loading..."),setTimeout(t,50)}catch(e){$(".attendance-form").unmask()}}function t(){var e,t,a,n,r,o=[];for(t=$("#adult-attendance-table > tbody:last").children(),e=0;e<t.length;e++){if(a=t[e].getAttribute("personId"),r=t[e].querySelector("[name=name_description]")){if(n=$.trim(r.value),""===n)continue}else n=void 0;o.push({id:a,adult:!0,display:n,attendanceDate:w,first:g(a),second:h(a)})}for(t=$("#kid-attendance-table > tbody:last").children(),e=0;e<t.length;e++){if(a=t[e].getAttribute("personId"),r=t[e].querySelector("[name=name_description]")){if(n=$.trim(r.value),!n)continue}else n=void 0;o.push({id:a,adult:!1,display:n,attendanceDate:w,first:g(a),second:h(a)})}v(o)}function a(){(W||confirm("Clear out any unsaved changes?"))&&n()}function n(){W=!0,$("#adult-attendance-table > tbody:last").children().remove(),$("#kid-attendance-table > tbody:last").children().remove(),i(G)}function r(){I.blur(),W=!1;var e={id:S(),adult:!0},t=u(e,w);$("#adult-attendance-table > tbody:last").append(t),$("[personid="+e.id+"] input:checkbox").on("change",p),$("#adult-attendance-table-container").animate({scrollTop:$("#adult-attendance-table-container")[0].scrollHeight},X)}function o(){J.blur(),W=!1;var e={id:S(),adult:!1},t=u(e,w);$("#kid-attendance-table > tbody:last").append(t),$("[personid="+e.id+"] input:checkbox").on("change",p),$("#kid-attendance-table-container").animate({scrollTop:$("#kid-attendance-table-container")[0].scrollHeight},X)}function c(){var e=new Date,t=e.getDate()-e.getDay(),a=new Date(e.setDate(t));x.value=b(a),w=x.value,E=a,C.innerHTML=x.value}function d(){W||confirm("If you change the date you will lose any unsaved changes. Continue?")?(E=new Date(x.value),w=x.value,n()):x.value=b(E),C.innerHTML=x.value}function s(e){var t="#"+(-1==e.target.id.indexOf("adult")?"kid":"adult")+"-attendance-table-container",a=$(t),n=-1==e.target.id.indexOf("top")?a[0].scrollHeight:0;a.stop().animate({scrollTop:n},X,"swing",function(){$("<style></style>").appendTo($(document.body)).remove()})}function i(e){T(),$(".attendance-table-attendance-col input:checkbox").off("change"),U=0,Y=0,R=0,z=0,B=0,K=0,G=e;for(var t=w,a="",n="",r=0;r<G.length;r++)G[r].active==O.checked&&(G[r].adult?a+=l(G[r],t):n+=l(G[r],t));m(U,Y,R,z,B,K),$("#adult-attendance-table > tbody:last").append(a),$("#kid-attendance-table > tbody:last").append(n),$(".attendance-table-attendance-col input:checkbox").on("change",p),k()}function l(e,t){var a,n="",r="",o="",c=_(),d=_();return-1!=(a=y(e,t))&&(n=e.attendance[a].first?"checked":"",r=e.attendance[a].second?"checked":""),e.first_name||e.last_name?(e.first_name&&(o+=e.first_name+" "),e.last_name&&(o+=e.last_name)):o=e.description,o='<a class="person_name" href="manage-person.html?id='+e.id+'">'+o+"</a>",e.adult?(n&&++Y,r&&++R,(n||r)&&++U):(n&&++B,r&&++K,(n||r)&&++z),'<tr adult="'+e.adult+'" personId="'+e.id+'"><td data-th="Name">'+o+'</td><td class="attendance-table-attendance-col" service="first" data-th="First?"><label for="'+c+'"><input id="'+c+'" type="checkbox" '+n+'/></label></td><td class="attendance-table-attendance-col" service="second" data-th="Second?"><label for="'+d+'"><input id="'+d+'" type="checkbox" '+r+"/></label></td></tr>"}function u(e){var t=_(),a=_();return'<tr adult="'+e.adult+'" personId="'+e.id+'"><td data-th="Name"><input name="name_description" type="text" placeholder="Last, First or Description" /></td><td class="attendance-table-attendance-col" service="first" data-th="First?"><label for="'+t+'"><input id="'+t+'" type="checkbox" /></label></td><td class="attendance-table-attendance-col" service="second" data-th="Second?"><label for="'+a+'"><input id="'+a+'" type="checkbox" /></label></td></tr>'}function p(e){var t=e.target,a=t.parentElement.parentElement.parentElement.getAttribute("personId"),n=t.parentElement.parentElement.parentElement.getAttribute("adult");W=!1,"true"==n?("first"===t.parentElement.parentElement.getAttribute("service")?(t.checked?(++Y,h(a)||++U):(--Y,h(a)||--U),M.innerHTML=Y):"second"===t.parentElement.parentElement.getAttribute("service")&&(t.checked?(++R,g(a)||++U):(--R,g(a)||--U),q.innerHTML=R),L.innerHTML=U):("first"===t.parentElement.parentElement.getAttribute("service")?(t.checked?(++B,h(a)||++z):(--B,h(a)||--z),N.innerHTML=B):"second"===t.parentElement.parentElement.getAttribute("service")&&(t.checked?(++K,g(a)||++z):(--K,g(a)||--z),D.innerHTML=K),F.innerHTML=z)}function m(e,t,a,n,r,o){U=e,Y=t,R=a,L.innerHTML=e,M.innerHTML=t,q.innerHTML=a,z=n,B=r,K=o,F.innerHTML=n,N.innerHTML=r,D.innerHTML=o}function f(){$(".attendance-form").mask("Loading..."),$.ajax({type:"GET",url:"ajax/get_attendance.php"}).done(function(e){$(".attendance-form").unmask();var t=JSON.parse(e);if(t.success){if(i(t.people),t.scroll_to_id&&t.scroll_to_id>=0){var a=$("[personid="+t.scroll_to_id+"]")[0];if(a){var n="true"==a.getAttribute("adult")?"adult":"kid",r="#"+n+"-attendance-table-container",o=$(r).offset().top,c=a.offsetTop;$("body").animate({scrollTop:o},300),$(r).animate({scrollTop:c},X)}}}else 1===t.error?logout():$().toastmessage("showErrorToast","Error loading")}).fail(function(){$(".attendance-form").unmask(),$().toastmessage("showErrorToast","Error loading")})}function v(e){$.ajax({type:"POST",url:"ajax/save_people.php",data:{people:JSON.stringify(e)}}).done(function(e){$(".attendance-form").unmask();var t=JSON.parse(e);t.success?(G=t.people,n(),$().toastmessage("showSuccessToast","Save successful")):1===t.error?logout():$().toastmessage("showErrorToast","Error saving")})}function g(e){return $("[personId="+e+"] input:checkbox:first")[0].checked}function h(e){return $("[personId="+e+"] input:checkbox:last")[0].checked}function y(e,t){for(var a=0;a<e.attendance.length;a++)if(e.attendance[a].date===t)return a;return-1}function b(e){var t=e.getDate(),a=e.getMonth(),n=e.getFullYear();return t=10>t?"0"+t:""+t,a++,a=10>a?"0"+a:""+a,a+"/"+t+"/"+n}function _(){return"id-"+ ++Q}function S(){return--V}function k(){$("#attendance-nav").on("click",A),$("#reports-nav").on("click",A),$("a.person_name").on("click",A)}function T(){$("#attendance-nav").off("click",A),$("#reports-nav").off("click",A),$("a.person_name").off("click",A)}function A(e){W||confirm("If you continue you will lose any unsaved changes. Continue?")||e.preventDefault()}if(0!==$("#attendance").length){$("#attendance-date").datepicker();var E,w,x=document.querySelector("#attendance-date"),L=document.querySelector("#adult-total-attendance"),M=document.querySelector("#adult-first-service-attendance"),q=document.querySelector("#adult-second-service-attendance"),F=document.querySelector("#kid-total-attendance"),N=document.querySelector("#kid-first-service-attendance"),D=document.querySelector("#kid-second-service-attendance"),O=document.querySelector("#active-true"),j=(document.querySelector("#active-false"),document.querySelector("#update")),H=document.querySelector("#cancel"),P=document.querySelector("#go-arrow"),I=document.querySelector("#add-adult"),J=document.querySelector("#add-kid"),C=document.querySelector("#attendance-date-display"),G=[],U=0,Y=0,R=0,z=0,B=0,K=0,Q=0,V=-1,W=!0,X=1e3;c(),j.addEventListener("click",e),H.addEventListener("click",a),P.addEventListener("click",d),I.addEventListener("click",r),J.addEventListener("click",o),$(".top-bottom-links a").on("click",s),checkLoginStatus(f)}}(),function(){"use strict";function e(){var e=r.value,n=o.value;t(e,n)&&a(e,$.md5(n))}function t(e,t){var a="";return $.trim(e)||(a+="Username cannot be blank<br />"),t||(a+="Password cannot be blank<br />"),a?($().toastmessage("showErrorToast",a),!1):!0}function a(e,t){$.ajax({type:"POST",url:"ajax/login.php",data:{username:e,password:t}}).done(function(e){var t=JSON.parse(e);t.success?window.location="attendance.html":$().toastmessage("showErrorToast","Username or password is incorrect")})}var n=document.querySelector("#login-btn"),r=document.querySelector("#username"),o=document.querySelector("#password");n&&(n.addEventListener("click",e),$(document).keypress(function(t){13==t.which&&e()}))}(),function(){"use strict";function e(){n.classList.remove("open"),a.classList.remove("open")}function t(){n.classList.toggle("open"),a.classList.toggle("open")}if(0!==$(".menu").length){var a=document.querySelector(".navdrawer-container"),n=document.querySelector(".app-bar"),r=document.querySelector(".menu"),o=document.querySelector("main");o.addEventListener("touchstart",e),o.addEventListener("click",e),r.addEventListener("click",t),a.addEventListener("click",function(t){("A"===t.target.nodeName||"LI"===t.target.nodeName)&&e()})}}(),function(){"use strict";function e(e){l.value=e.first_name,u.value=e.last_name,p.value=e.description,m.checked=e.adult,f.checked=e.active}function t(){var e=$.trim(l.value),t=$.trim(u.value),n=$.trim(p.value);a(e,t,n)&&c({id:i.id,first_name:e,last_name:t,description:n,adult:m.checked,active:f.checked})}function a(e,t,a){var n="",r=!!e,o=!!t,c=!!a;return!r&&o?n+="First Name cannot be blank if Last Name is specified<br />":r&&!o?n+="Last Name cannot be blank if First Name is specified<br />":r||o||c||(n+="Must specify either First and Last Name or Description<br />"),n?($().toastmessage("showErrorToast",n),!1):!0}function n(){confirm("Deleting someone also deletes their attendance history. Continue?")&&d()}function r(){e(i)}function o(){$.ajax({type:"GET",url:"ajax/get_person.php",data:{id:s.id}}).done(function(t){var a=JSON.parse(t);a.success?(i=a.person,e(a.person)):1===a.error?logout():$().toastmessage("showErrorToast","Error loading")}).fail(function(){$().toastmessage("showErrorToast","Error loading person")})}function c(e){$.ajax({type:"POST",url:"ajax/save_person.php",data:{person:JSON.stringify(e)}}).done(function(e){var t=JSON.parse(e);t.success?$().toastmessage("showSuccessToast","Save successful"):1===t.error?logout():$().toastmessage("showErrorToast","Error saving person")}).fail(function(){$().toastmessage("showErrorToast","Error saving person")})}function d(){$.ajax({type:"POST",url:"ajax/delete_person.php",data:{id:i.id}}).done(function(e){var t=JSON.parse(e);t.success?window.location="attendance.html":1===t.error?logout():$().toastmessage("showErrorToast","Error deleting person")}).fail(function(){$().toastmessage("showErrorToast","Error deleting person")})}if(0!==$("#manage-person").length){var s={},i={},l=document.querySelector("#first-name"),u=document.querySelector("#last-name"),p=document.querySelector("#description"),m=document.querySelector("#adult"),f=document.querySelector("#active"),v=document.querySelector("#update"),g=document.querySelector("#cancel"),h=document.querySelector("#delete");(window.onpopstate=function(){var e,t=/\+/g,a=/([^&=]+)=?([^&]*)/g,n=function(e){return decodeURIComponent(e.replace(t," "))},r=window.location.search.substring(1);for(s={};null!==(e=a.exec(r));)s[n(e[1])]=n(e[2])}).call(),s.id||(window.location="attendance.html"),v.addEventListener("click",t),g.addEventListener("click",r),h.addEventListener("click",n),checkLoginStatus(o)}}(),function(){"use strict";function e(e,t){y.innerHTML=e?e:"N/A",b.innerHTML=t?t:"N/A";var a=new Date;h.value=$.datepicker.formatDate("mm/dd/yy",new Date(a.getFullYear(),a.getMonth(),1,0,0,0,0)),g.value=$.datepicker.formatDate("mm/dd/yy",a)}function t(){var e=parseInt(_.value);3===e?($("#report-type-container")[0].style.setProperty("display","inline-block"),$("#from-to-dates")[0].style.setProperty("display","none")):($("#report-type-container")[0].style.setProperty("display","block"),$("#from-to-dates")[0].style.setProperty("display","inline-block"))}function a(){if(r(h.value,g.value)){var e=parseInt(_.value);switch(n(),e){case 1:$("#attendance-by-date-container")[0].style.setProperty("display","inherit");break;case 2:$("#attendance-by-person-container")[0].style.setProperty("display","inherit");break;case 3:$("#attendance-by-mia-container")[0].style.setProperty("display","inherit")}m(e,h.value,g.value)}}function n(){$("#attendance-by-person-container")[0].style.setProperty("display","none"),$("#attendance-by-date-container")[0].style.setProperty("display","none"),$("#attendance-by-mia-container")[0].style.setProperty("display","none")}function r(e,t){var a="";return v(e)||(a+="From Date must be a valid date<br />"),v(t)||(a+="To Date must be a valid date<br />"),a?($().toastmessage("showErrorToast",a),!1):!0}function o(e,t){$("#attendance-date-table > tbody:last").empty(),$("#attendance-date-aggregates-table > tbody:last").empty();for(var a="",n=0;n<e.length;n++)a+=c(e[n]);$("#attendance-date-table > tbody:last").append(a),$("#attendance-date-aggregates-table > tbody:last").append(d(t))}function c(e){return'<tr><td data-th="Date">'+e.Attendance_dt+'</td><td class="report-attendance-table-attendance-col" data-th="Total">'+e.Total_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="First">'+e.First_Service_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Second">'+e.Second_Service_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="First Adult">'+e.First_Service_Adult_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Second Adult">'+e.Second_Service_Adult_Attendance+"</td></tr>"}function d(e){var t="",a=e[0];return t+='<tr><td data-th="Aggregate">Average</td><td class="report-attendance-table-attendance-col" data-th="Average Total">'+a.Avg_Total_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Average First">'+a.Avg_First_Service_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Average Second">'+a.Avg_Second_Service_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Average First Adult">'+a.Avg_First_Service_Adult_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Average Second Adult">'+a.Avg_Second_Service_Adult_Attendance+"</td></tr>",t+='<tr><td data-th="Aggregate">Max</td><td class="report-attendance-table-attendance-col" data-th="Max Total">'+a.Max_Total_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Max First">'+a.Max_First_Service_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Max Second">'+a.Max_Second_Service_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Max First Adult">'+a.Max_First_Service_Adult_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Max Second Adult">'+a.Max_Second_Service_Adult_Attendance+"</td></tr>",t+='<tr><td data-th="Aggregate">Min</td><td class="report-attendance-table-attendance-col" data-th="Min Total">'+a.Min_Total_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Min First">'+a.Min_First_Service_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Min Second">'+a.Min_Second_Service_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Min First Adult">'+a.Min_First_Service_Adult_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Min Second Adult">'+a.Min_Second_Service_Adult_Attendance+"</td></tr>"}function s(e){$("#adult-attendance-table > tbody:last").empty();for(var t="",a=0;a<e.length;a++)"true"==e[a].adult&&(t+=u(e[a]));$("#adult-attendance-table > tbody:last").append(t)}function i(e){$("#mia-attendance-table > tbody:last").empty();for(var t="",a=0;a<e.length;a++)"true"==e[a].adult&&(t+=l(e[a]));$("#mia-attendance-table > tbody:last").append(t)}function l(e){var t="";return e.first_name||e.last_name?(e.first_name&&(t+=e.first_name+" "),e.last_name&&(t+=e.last_name)):t=e.description,t='<a class="person_name" href="manage-person.html?id='+e.id+'">'+t+"</a>",'<tr adult="'+e.adult+'" personId="'+e.id+'"><td data-th="Name">'+t+"</td></tr>"}function u(e){var t="";return e.first_name||e.last_name?(e.first_name&&(t+=e.first_name+" "),e.last_name&&(t+=e.last_name)):t=e.description,t='<a class="person_name" href="manage-person.html?id='+e.id+'">'+t+"</a>",'<tr adult="'+e.adult+'" personId="'+e.id+'"><td data-th="Name">'+t+'</td><td class="report-attendance-table-attendance-col" data-th="First">'+e.First_Service_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Second">'+e.Second_Service_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Total">'+e.Total_Attendance+"</td></tr>"}function p(e){var t="#"+e.target.parentElement.previousElementSibling.id,a=-1==e.target.id.indexOf("top")?$(t)[0].scrollHeight:0;$(t).animate({scrollTop:a},k,"swing",function(){$("<style></style>").appendTo($(document.body)).remove()})}function m(e,t,a){$(".reports-form").mask("Loading..."),$.ajax({type:"GET",url:"ajax/get_report.php",data:{type:e,fromDate:t,toDate:a}}).done(function(t){$(".reports-form").unmask();var a=JSON.parse(t);if(a.success)switch(e){case 1:o(a.totals,a.aggregates);break;case 2:s(a.people);break;case 3:i(a.people)}else 1===a.error?logout():$().toastmessage("showErrorToast","Error loading report")}).fail(function(){$(".reports-form").unmask(),$().toastmessage("showErrorToast","Error loading report")})}function f(){$(".reports-form").mask("Loading..."),$.ajax({type:"GET",url:"ajax/get_first_last_service_dates.php"}).done(function(t){$(".reports-form").unmask();var a=JSON.parse(t);a.success?e(a.first_dt,a.last_dt):1===a.error?logout():$().toastmessage("showErrorToast","Error loading data")}).fail(function(){$(".reports-form").unmask(),$().toastmessage("showErrorToast","Error loading data")})}function v(e){var t=e;if(""===t)return!1;var a=/^(\d{1,2})(\/|-)(\d{1,2})(\/|-)(\d{4})$/,n=t.match(a);if(null===n)return!1;var r=n[1],o=n[3],c=n[5];if(1>r||r>12)return!1;if(1>o||o>31)return!1;if((4==r||6==r||9==r||11==r)&&31==o)return!1;if(2==r){var d=c%4===0&&(c%100!==0||c%400===0);if(o>29||29==o&&!d)return!1}return!0}if(0!==$("#reports").length){$("#from-date").datepicker(),$("#to-date").datepicker();var g=document.querySelector("#to-date"),h=document.querySelector("#from-date"),y=document.querySelector("#first-date"),b=document.querySelector("#last-date"),_=document.querySelector("#report-type"),S=document.querySelector("#go-arrow"),k=300;S.addEventListener("click",a),_.addEventListener("change",t),$(".top-bottom-links a").on("click",p),checkLoginStatus(f)}}();