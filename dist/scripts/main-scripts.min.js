function checkLoginStatus(e,t){$.ajax({type:"POST",url:"ajax/check_login.php"}).done(function(n){var o=JSON.parse(n);o.success?e&&e():t!==!0&&(window.location="index.html")})}function logout(){confirm("If you have unsaved changes logging out will cause you to lose them. Continue?")&&$.ajax({type:"POST",url:"ajax/logout.php"}).done(function(){window.location="index.html"})}!function(){"use strict";function e(){if(t(m.value,u.value)){var e;e={fromDate:m.value,toDate:u.value,active:$("#active").is(":checked"),not_visited:$("#not-visited").is(":checked"),ty_card_not_sent:!1,signed_up_for_baptism:!1,baptized:!1,interested_in_gkids:!1,interested_in_next:!1,interested_in_ggroups:!1,interested_in_gteams:!1,interested_in_joining:!1,would_like_visit:$("#would-like-visit").is(":checked"),no_agent:!1},n(e)}}function t(e,t){var n="";return d(e,!0)||(n+="From Date must be a valid date<br />"),d(t,!0)||(n+="To Date must be a valid date<br />"),n?($().toastmessage("showErrorToast",n),!1):!0}function n(e){$(".address-view-form").mask("Loading..."),$.ajax({type:"POST",url:"ajax/get_report.php",data:{type:4,params:JSON.stringify(e)}}).done(function(e){var t=JSON.parse(e);t.success?(a(t.people),$(".address-view-form").unmask()):1===t.error?logout():$().toastmessage("showErrorToast","Error searching people")}).fail(function(){$().toastmessage("showErrorToast","Error searching people")})}function o(e,t){if(null===e)return"";var n="";return e.first_name||e.last_name?(e.last_name&&(n+=e.last_name),e.last_name&&e.first_name?t===!0?n+=", "+e.first_name:n=e.first_name+" "+n:e.first_name&&(n+=e.first_name+" ")):n=e.description,n}function a(e){$("#address-view-table tbody tr").remove();for(var t=0;t<e.length;t++)r(e[t])}function r(e){var t=o(e);$("#address-view-table > tbody:last").append('<tr person_id="'+e.id+'"><td data-th="Name" person_name="'+t+'"><a class="person_name" href="manage-person.html?id='+e.id+'">'+t+'</a></td><td data-th="Address">'+s(e)+'</td><td data-th="Visit" class="checkbox-table-col"><label for="visit-checkbox-'+e.id+'"><input id="visit-checkbox-'+e.id+'" class="visit-checkbox" type="checkbox" address="'+c(e)+'" /></label></td></tr>')}function i(){var e,t,n,o=$(".visit-checkbox:checked"),a=v;if(o.length>k.length)return $().toastmessage("showErrorToast","Can't show more than "+k.length+" people at once."),void 0;g.innerHTML="";for(var r=0;r<o.length;r++)n=o[r].getAttribute("address"),"OH"!==n&&""!==n&&(a+=b+k[r]+"|"+n,e=o[r].parentElement.parentElement.previousElementSibling.innerHTML,t=o[r].parentElement.parentElement.previousElementSibling.previousElementSibling.getAttribute("person_name"),g.innerHTML+=' <div class="map-legend-item"><span style="font-weight: bold;">'+k[r]+"</span> : "+t+'<br /><a href="'+y+e+'" target="_blank">'+e+"</a></div>");""!==g.innerHTML?(_.innerHTML='<img border="0" src="'+a+'" />',$("#map-legend")[0].style.setProperty("display","block"),$("#map-note")[0].style.setProperty("display","block")):(_.innerHTML="",$("#map-legend")[0].style.setProperty("display","none"),$("#map-note")[0].style.setProperty("display","none"),$().toastmessage("showWarningToast","Must select at least 1 person with an address"))}function c(e){var t="";return t+=e.street1||"",t+=" ",t+=e.street2||"",t+=" ",t+=e.city||"",t+=" ",t+=e.state||"",t+=" ",t+=e.zip||"",t.trim()}function s(e){var t="";return t+=e.street1||"",e.street1&&(t+="<br />"),t+=e.street2||"",e.street2&&(t+="<br />"),t+=e.city||"",e.city&&e.state&&(t+=","),t+=" ",t+=e.state||"",t+=" ",t+=e.zip||"",t.trim()}function d(e,t){var n=e;if(""===n)return!!t;var o=/^(\d{1,2})(\/|-)(\d{1,2})(\/|-)(\d{4})$/,a=n.match(o);if(null===a)return!1;var r=a[1],i=a[3],c=a[5];if(1>r||r>12)return!1;if(1>i||i>31)return!1;if((4==r||6==r||9==r||11==r)&&31==i)return!1;if(2==r){var s=c%4===0&&(c%100!==0||c%400===0);if(i>29||29==i&&!s)return!1}return!0}function l(e){var t=$("#address-view-table-container"),n=-1==e.target.id.indexOf("top")?t[0].scrollHeight:0;t.stop().animate({scrollTop:n},h,"swing",function(){$("<style></style>").appendTo($(document.body)).remove()})}if(0!==$(".address-view-form").length){$("#from-date").datepicker(),$("#to-date").datepicker();var u=document.querySelector("#to-date"),m=document.querySelector("#from-date"),p=document.querySelector("#go-arrow"),f=document.querySelector("#gen-map"),h=1e3,_=document.querySelector("#address-map-panel"),g=document.querySelector("#map-legend"),v="//maps.googleapis.com/maps/api/staticmap?zoom=11&size=500x500",y="https://www.google.com/maps/place/",b="&markers=color:red%7Clabel:",k=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","1","2","3","4","5","6","7","8","9","0"];$(".navigation-links a").on("click",l),p.addEventListener("click",e),f.addEventListener("click",i),checkLoginStatus()}}(),function(){"use strict";function e(){window.location="ajax/export_attendance.php"}function t(){try{$(".attendance-form").mask("Loading..."),setTimeout(n,50)}catch(e){$(".attendance-form").unmask()}}function n(){var e,t,n,o,a,r,i,c,s,d,l=[];for(n=$("#attendance-table > tbody:last").children(),e=0;e<n.length;e++)if(null!==n[e].getAttribute("modified")){if(o=n[e].getAttribute("personId"),r=n[e].querySelector("[name=name_description]"),c=E(o),s=T(o),r){if(a=$.trim(r.value),""===a)continue}else a=void 0;if(-1===o.indexOf("-")&&(d=L(o))){for(i=!1,t=0;t<d.attendance.length;t++)d.attendance[t].date===J&&(d.attendance[t].first=c,d.attendance[t].second=s,i=!0);i||d.attendance.push({date:J,first:c,second:s})}l.push({id:o,adult:rt,display:a,attendanceDate:J,first:c,second:s})}l.length>0?S(l):($(".attendance-form").unmask(),$().toastmessage("showWarningToast","No attendance was modified"))}function o(){(tt||confirm("Clear out any unsaved changes?"))&&a()}function a(){r(),u(Z)}function r(){tt=!0,$("#attendance-table > tbody:last").children().remove()}function i(){W.blur(),tt=!1;var e={id:O(),adult:!0},t=p(e,J);$("#attendance-table > tbody:last").append(t),$("[personid="+e.id+"] input:checkbox").on("change",h),$("#attendance-table-container").animate({scrollTop:$("#attendance-table-container")[0].scrollHeight},nt)}function c(){var e=new Date,t=e.getDate()-e.getDay(),n=new Date(e.setDate(t));$("#attendance-date").datepicker("setDate",n),J=U.value,F=n,K.innerHTML=s(n)}function s(e){return at[e.getMonth()]+" "+e.getDate()+", "+e.getFullYear()}function d(){tt||confirm("If you change the date you will lose any unsaved changes. Continue?")?(F=new Date(U.value),J=U.value,r(),w()):$("#attendance-date").datepicker("setDate",F),K.innerHTML=s($("#attendance-date").datepicker("getDate"))}function l(e){var t="#attendance-table-container",n=$(t),o=-1==e.target.id.indexOf("top")?n[0].scrollHeight:0;n.stop().animate({scrollTop:o},nt,"swing",function(){$("<style></style>").appendTo($(document.body)).remove()})}function u(e){H(),C(),$(".attendance-table-attendance-col input:checkbox").off("change"),y(),Z=e;for(var t=J,n="",o=0;o<Z.length;o++)Z[o].active==G.checked&&(n+=m(Z[o],t));b(it),$("#attendance-table > tbody:last").append(n),$(".attendance-table-attendance-col input:checkbox").on("change",h),j()}function m(e,t){P(e.id,e.last_name,e.adult);var n,o="",a="",r="",i=M(),c=M();return-1!=(n=A(e,t))&&(o=e.attendance[n].first?"checked":"",a=e.attendance[n].second?"checked":""),r=q(e),r='<a class="person_name" href="manage-person.html?id='+e.id+'">'+r+"</a>",'<tr adult="'+e.adult+'" personId="'+e.id+'"><td data-th="Name"><button class="attendance-history-button"><i class="fa fa-archive" /></button>'+r+'</td><td class="attendance-table-attendance-col" service="first" data-th="First?"><label for="'+i+'"><input id="'+i+'" type="checkbox" '+o+'/></label></td><td class="attendance-table-attendance-col" service="second" data-th="Second?"><label for="'+c+'"><input id="'+c+'" type="checkbox" '+a+"/></label></td></tr>"}function p(e){var t=M(),n=M();return'<tr adult="'+e.adult+'" personId="'+e.id+'" modified="true"><td data-th="Name"><input name="name_description" type="text" placeholder="Last, First or Description" /></td><td class="attendance-table-attendance-col" service="first" data-th="First?"><label for="'+t+'"><input id="'+t+'" type="checkbox" /></label></td><td class="attendance-table-attendance-col" service="second" data-th="Second?"><label for="'+n+'"><input id="'+n+'" type="checkbox" /></label></td></tr>'}function f(e){if(tt=!0,e&&0!==e.length){var t,n,o,a,r,i,c=[],s=0,d=0;for($("[personid^=-]").remove(),t=0;t<e.length;t++)Z.push(e[t]),c.push(m(e[t],J));for(t=0;t<e.length;t++){for(a=e[t],r=!1,n=0;n<Z.length;n++)if(o=Z[n],o.adult===!0?s=n:d=n,o.adult===a.adult&&-1===x(a,o)){$(c[t]).insertBefore("[personid="+o.id+"]"),Z.splice(n,0,a),r=!0;break}r===!1&&(a.adult===!0?($("#adult-attendance-table > tbody:last").append(c[t]),Z.splice(s+1,0,a)):($("#kid-attendance-table > tbody:last").append(c[t]),Z.splice(d+1,0,a))),i=$("[personid="+a.id+"]"),i.find("a.person_name").on("click",D),i.find("button.attendance-history-button").on("click",N),i.find("input:checkbox").on("change",h)}}}function h(e){var t=e.target,n=t.parentElement.parentElement.parentElement.getAttribute("personId"),o="first"===t.parentElement.parentElement.getAttribute("service"),a=(rt?"adult":"kid")+"_total_count",r=(rt?"adult":"kid")+"_"+(o?"first":"second")+"_count",i=o?T:E;tt=!1,t.parentElement.parentElement.parentElement.setAttribute("modified",!0),t.checked?(it[r]++,i(n)||it[a]++):(it[r]--,i(n)||it[a]--),ct[r].innerHTML=it[r],ct[a].innerHTML=it[a],it.total_first_count=it.adult_first_count+it.kid_first_count,it.total_second_count=it.adult_second_count+it.kid_second_count,it.total_total_count=it.adult_total_count+it.kid_total_count,ct.total_first_count.innerHTML=it.total_first_count,ct.total_second_count.innerHTML=it.total_second_count,ct.total_total_count.innerHTML=it.total_total_count}function _(e){$("#person-attendance-history-table > tbody:last").children().remove(),ot.dialog("open"),ot[0].querySelector("#person-name").innerHTML=q(e,!1);for(var t="",n=0;n<e.attendance.length;n++)t+=g(e.attendance[n]);$("#person-attendance-history-table > tbody:last").append(t)}function g(e){var t=e.first?"checked":"",n=e.second?"checked":"";return'<tr><td data-th="Date">'+e.date+'</td><td class="attendance-table-attendance-col" service="first" data-th="First?"><input type="checkbox" '+t+' disabled/></td><td class="attendance-table-attendance-col" service="second" data-th="Second?"><input type="checkbox" '+n+" disabled/></td></tr>"}function v(){for(var e in it)it.hasOwnProperty(e)&&(it[e]=parseInt(it[e]))}function y(){it=jQuery.extend({},z);for(var e in it)it.hasOwnProperty(e)&&(ct[e].innerHTML=it[e])}function b(e){it.total_first_count=it.adult_first_count+it.kid_first_count,it.total_second_count=it.adult_second_count+it.kid_second_count,it.total_total_count=it.adult_total_count+it.kid_total_count;for(var t in e)e.hasOwnProperty(t)&&(it[t]=e[t],ct[t].innerHTML=e[t])}function k(e){$(".attendance-form").mask("Loading..."),$.ajax({type:"GET",url:"ajax/get_person_attendance.php",data:{id:e}}).done(function(e){$(".attendance-form").unmask();var t=JSON.parse(e);t.success?_(t.person):1===t.error?logout():$().toastmessage("showErrorToast","Error loading person's attendance history")}).fail(function(){$(".attendance-form").unmask(),$().toastmessage("showErrorToast","Error loading person's attendance history")})}function w(){$(".attendance-form").mask("Loading..."),$.ajax({type:"POST",url:"ajax/get_attendance.php",data:{date:U.value,active:G.checked,adult:R.checked}}).done(function(e){$(".attendance-form").unmask();var t=JSON.parse(e);if(t.success){if(rt=R.checked,$("#name-table-header").text(rt?"Adults":"Kids"),it=t.totals,v(),z=jQuery.extend({},it),u(t.people),t.scroll_to_id&&t.scroll_to_id>=0){var n=$("[personid="+t.scroll_to_id+"]")[0];if(n){var o="#attendance-table-container",a=$(o).offset().top,r=n.offsetTop;$("body").animate({scrollTop:a},300),$(o).animate({scrollTop:r},nt)}}}else 1===t.error?logout():$().toastmessage("showErrorToast","Error loading")}).fail(function(){$(".attendance-form").unmask(),$().toastmessage("showErrorToast","Error loading")})}function S(e){$.ajax({type:"POST",url:"ajax/save_people.php",data:{people:JSON.stringify(e)}}).done(function(e){$(".attendance-form").unmask();var t=JSON.parse(e);t.success?(z=jQuery.extend({},it),f(t.people),$().toastmessage("showSuccessToast","Save successful")):1===t.error?logout():$().toastmessage("showErrorToast","Error saving")})}function E(e){return $("[personId="+e+"] input:checkbox:first")[0].checked}function T(e){return $("[personId="+e+"] input:checkbox:last")[0].checked}function x(e,t){if(e==t)return 0;if(null===e)return-1;if(null===t)return 1;var n=q(e,!0),o=q(t,!0);if(e.first_name||e.last_name){if(!t.first_name&&!t.last_name)return-1;if(n===o)return 0;if(n.toLowerCase()<o.toLowerCase())return-1;if(n.toLowerCase()>o.toLowerCase())return 1}else{if(t.first_name||t.last_name)return 1;if(n===o)return 0;if(n.toLowerCase()<o.toLowerCase())return-1;if(n.toLowerCase()>o.toLowerCase())return 1}}function q(e,t){if(null===e)return"";var n="";return e.first_name||e.last_name?(e.last_name&&(n+=e.last_name),e.last_name&&e.first_name?t===!0?n+=", "+e.first_name:n=e.first_name+" "+n:e.first_name&&(n+=e.first_name+" ")):n=e.description,n}function A(e,t){for(var n=0;n<e.attendance.length;n++)if(e.attendance[n].date===t)return n;return-1}function L(e){for(var t=0;t<Z.length;t++)if(Z[t].id===e)return Z[t];return null}function M(){return"id-"+ ++X}function O(){return--et}function j(){$("#attendance-nav").on("click",D),$("#reports-nav").on("click",D),$("a.person_name").on("click",D),$("button.attendance-history-button").on("click",N)}function C(){$("#attendance-nav").off("click",D),$("#reports-nav").off("click",D),$("a.person_name").off("click",D),$("button.attendance-history-button").off("click",N)}function N(){var e=this.parentElement.parentElement.getAttribute("personId");k(e)}function H(){document.querySelector("#jump-to").innerHTML="<option>--Jump To Letter--</option>"}function P(e,t){if(t){var n="#jump-to",o=t.substr(0,1).toUpperCase();if(!($(n+' option:contains("'+o+'")').length>0)){var a=document.querySelector(n),r=document.createElement("option");r.setAttribute("scroll_to_id",e),r.innerHTML=o,a.appendChild(r)}}}function I(e){var t=e.target.options[e.target.options.selectedIndex];if(t){var n=$("[personid="+t.getAttribute("scroll_to_id")+"]")[0];if(n){var o="#attendance-table-container",a=$(o).offset().top,r=n.offsetTop;$("body").animate({scrollTop:a},300),$(o).animate({scrollTop:r},nt)}}}function D(e){tt||confirm("If you continue you will lose any unsaved changes. Continue?")||e.preventDefault()}if(0!==$("#attendance").length){$("#attendance-date").datepicker({dateFormat:"m/d/yy"});var F,J,z,U=document.querySelector("#attendance-date"),G=document.querySelector("#active-true"),R=document.querySelector("#adults-true"),Y=document.querySelector("#update"),V=document.querySelector("#cancel"),B=document.querySelector("#export"),Q=document.querySelector("#go-arrow"),W=document.querySelector("#add-person"),K=document.querySelector("#attendance-date-display"),Z=[],X=0,et=-1,tt=!0,nt=1e3,ot=$(".dialog-form").dialog({autoOpen:!1,height:400,width:450,modal:!0}),at=["January","February","March","April","May","June","July","August","September","October","November","December"],rt=!0,it={},ct={total_first_count:document.querySelector("#total-first-count"),total_second_count:document.querySelector("#total-second-count"),total_total_count:document.querySelector("#total-total-count"),adult_first_count:document.querySelector("#adult-first-count"),adult_second_count:document.querySelector("#adult-second-count"),adult_total_count:document.querySelector("#adult-total-count"),kid_first_count:document.querySelector("#kid-first-count"),kid_second_count:document.querySelector("#kid-second-count"),kid_total_count:document.querySelector("#kid-total-count")};c(),Y.addEventListener("click",t),V.addEventListener("click",o),B.addEventListener("click",e),Q.addEventListener("click",d),W.addEventListener("click",i),$(".jump-to").on("change",I),$(".navigation-links a").on("click",l),checkLoginStatus(w)}}(),function(){"use strict";function e(){var e=$("#follow-up-type");$.each(kt,function(t,n){e.append("<option value="+t+">"+n+"</option>")}),e.val("2")}function t(){var e=$.trim(ht.value);""===e?$().toastmessage("showErrorToast","Must enter Name"):o(e)}function n(){var e=$.trim(ht.value);""===e?$().toastmessage("showErrorToast","Must enter Name"):a(e)}function o(e){$.ajax({type:"POST",url:"ajax/create_person.php",data:{person_display:e}}).done(function(e){var t=JSON.parse(e);t.success?p(t.person_id,t.person_name):1===t.error?logout():$().toastmessage("showErrorToast","Error loading visitors")}).fail(function(){$().toastmessage("showErrorToast","Error loading visitors")})}function a(e){$.ajax({type:"GET",url:"ajax/search.php",data:{search:e}}).done(function(e){var t=JSON.parse(e);t.success?h(t.people):1===t.error?logout():$().toastmessage("showErrorToast","Error loading visitors")}).fail(function(){$().toastmessage("showErrorToast","Error loading visitors")})}function r(){$.ajax({type:"GET",url:"ajax/get_visitors.php"}).done(function(t){var n=JSON.parse(t);n.success?(F=n.people,k(),e(),i()):1===n.error?logout():$().toastmessage("showErrorToast","Error loading visitors")}).fail(function(){$().toastmessage("showErrorToast","Error loading visitors")})}function i(){$.ajax({type:"POST",url:"ajax/get_follow_ups.php",data:{date:V.value}}).done(function(e){var t=JSON.parse(e);t.success?v(t.follow_ups):1===t.error?logout():$().toastmessage("showErrorToast","Error loading visitors")}).fail(function(){$().toastmessage("showErrorToast","Error loading visitors")})}function c(e,t,n){$.ajax({type:"POST",url:"ajax/save_follow_up.php",data:{follow_up:JSON.stringify(e)}}).done(function(o){var a=JSON.parse(o);a.success?(e.id=a.follow_up_id,t.call(this,e,n),$().toastmessage("showSuccessToast","Save successful")):1===a.error?logout():a.warning?$().toastmessage("showErrorToast",a.warning):$().toastmessage("showErrorToast","Error saving follow up")}).fail(function(){$().toastmessage("showErrorToast","Error saving follow up")})}function s(e,t){$.ajax({type:"POST",url:"ajax/delete_follow_up.php",data:{id:e,personId:t}}).done(function(t){var n=JSON.parse(t);n.success?$("#follow-up-table tr[follow_up_id="+e+"]").remove():1===n.error?logout():n.warning?$().toastmessage("showErrorToast",n.warning):$().toastmessage("showErrorToast","Error deleting Follow Up")}).fail(function(){$().toastmessage("showErrorToast","Error deleting Follow Up")})}function d(e,t){if(null===e)return"";var n="";return e.first_name||e.last_name?(e.last_name&&(n+=e.last_name),e.last_name&&e.first_name?t===!0?n+=", "+e.first_name:n=e.first_name+" "+n:e.first_name&&(n+=e.first_name+" ")):n=e.description,n}function l(){z.text("Add Follow Up"),G.innerHTML="(Select a person)",G.setAttribute("personid",""),G.setAttribute("person_name",""),R.value="2",Y.value="",Q.checked=!1,W.checked=!1,K.checked=!1,Z.checked=!1,X.checked=!1,et.checked=!1,tt.checked=!1,nt.checked=!1,ot.checked=!1,at.checked=!1,rt.checked=!1,dt.value="",ct.checked=!1,Y.disabled=!1;for(var e=st.querySelectorAll("input"),t=0;t<e.length;t++)e[t].checked=!1;N()}function u(){var e=$.trim(G.getAttribute("person_name")),t=$.trim(G.getAttribute("personid")),n=$.trim(Y.value),o=$.trim(R.value),a=$.trim(dt.value),r={commitment_christ:!1,recommitment_christ:!1,commitment_tithe:!1,commitment_ministry:!1,commitment_baptism:!1,info_next:!1,info_gkids:!1,info_ggroups:!1,info_gteams:!1,info_member:!1,info_visit:!1},i=[],c=[],s="",d="";(""===t||0>t)&&(s+="Must select a person<br />"),""!==a||1!=o&&2!=o||(s+="Must specify comments<br />"),""!==n||ct.checked||(s+="Must specify a date or mark it unknown<br />"),a.length>5e3&&(s+="Comments cannot exceed 5000 characters<br />");for(var l=st.querySelectorAll("input"),u=0;u<l.length;u++)l[u].checked&&(i.push($.trim(l[u].nextSibling.innerHTML)),c.push(l[u].getAttribute("personid")));return 0===c.length&&(s+="Must specify a visitor<br />"),s?($().toastmessage("showErrorToast",s),!1):(3==o&&(r={commitment_christ:Q.checked,recommitment_christ:W.checked,commitment_tithe:K.checked,commitment_ministry:Z.checked,commitment_baptism:X.checked,info_next:et.checked,info_gkids:tt.checked,info_ggroups:nt.checked,info_gteams:ot.checked,info_member:at.checked,info_visit:rt.checked}),{id:q()?I():U.value,date:n,name:e,personId:t,spouseId:d,typeCd:o,type:R.selectedOptions[0].text,comments:a,communication_card_options:r,visitors:i,visitorsIds:c})}function m(e){var t=e.currentTarget.parentElement.parentElement,n=t.getAttribute("person_id"),o=t.children[0].getAttribute("person_name");p(n,o)}function p(e,t){L(),G.innerHTML='<a class="person_name" href="manage-person.html?id='+e+'">'+t+"</a>",G.setAttribute("personid",e),G.setAttribute("person_name",t)}function f(e){var t=e.currentTarget.parentElement.parentElement,n=t.getAttribute("person_id");window.location="manage-person.html?id="+n}function h(e){$("a.person_name").off("click",m),$("button.search-button").off("click",f),$("#search-table tbody tr").remove();for(var t=0;t<e.length;t++)_(e[t]);$("a.person_name").on("click",m),$("button.search-button").on("click",f)}function _(e){var t=d(e);$("#search-table > tbody:last").append('<tr person_id="'+e.id+'"><td data-th="Name" person_name="'+t+'"><a class="person_name" href="javascript:void(0);">'+t+'</a></td><td data-th="Address">'+g(e)+'</td><td data-th="" class="search-table-button-col"><button class="search-button button--blue-x-small">Manage</button></td></tr>')}function g(e){var t="";return t+=e.street1||"",e.street1&&(t+="<br />"),t+=e.street2||"",e.street2&&(t+="<br />"),t+=e.city||"",e.city&&e.state&&(t+=","),t+=" ",t+=e.state||"",t+=" ",t+=e.zip||"",t.trim()}function v(e){P(),$("#follow-up-table tbody tr").remove();for(var t=0;t<e.length;t++)y(e[t]);H()}function y(e){!e.type&&e.typeCd&&(e.type=kt[e.typeCd]||""),e.date=e.date||"",e.name=e.name||"";var t,n=e.name;e.personId>=0&&(t='<a class="person_name" href="manage-person.html?id='+e.personId+'">'+n+"</a>");var o=[];for(var a in e.communication_card_options)e.communication_card_options.hasOwnProperty(a)&&e.communication_card_options[a]===!0&&o.push(a);$("#follow-up-table > tbody:last").append('<tr follow_up_id="'+e.id+'" communication_card_options="'+o.join(",")+'"><td data-th="Name" personid="'+e.personId+'" person_name="'+n+'">'+t+'</td><td data-th="Type" typeCd="'+e.typeCd+'">'+e.type+'</td><td data-th="Date" class="follow-up-table-date-col">'+e.date+'</td><td data-th="By" visitorsIds="'+e.visitorsIds.join(",")+'">'+e.visitors.join(", ")+'</td><td data-th="Comments" class="follow-up-table-comments-col">'+e.comments+'</td><td data-th="" class="follow-up-table-button-col"><button class="edit-follow-up"><i class="fa fa-edit"></i></button><button class="delete-follow-up"><i class="fa fa-minus-circle"></i></button></td></tr>')}function b(e){var t=$("#follow-up-table tr[follow_up_id="+e.id+"]"),n=t.children(),o=[];for(var a in e.communication_card_options)e.communication_card_options.hasOwnProperty(a)&&e.communication_card_options[a]===!0&&o.push(a);t[0].setAttribute("communication_card_options",o.join(",")),n[0].setAttribute("personid",e.personId),n[0].setAttribute("person_name",e.name),n[0].innerHTML='<a class="person_name" href="manage-person.html?id='+e.personId+'">'+e.name+"</a>",n[1].setAttribute("typeCd",e.typeCd),n[1].innerHTML=e.type,n[2].innerHTML=e.date,n[3].innerHTML=e.visitors.join(", "),n[4].setAttribute("visitorsIds",e.visitorsIds.join(",")),n[4].innerHTML=e.comments}function k(){if(""===st.innerHTML.trim())for(var e,t=0;t<F.length;t++)e=F[t],st.innerHTML+='<div class="check-field"><input type="checkbox" personid="'+e.id+'" id="follow-up-by-'+e.id+'"/><label for="follow-up-by-'+e.id+'">'+d(e)+"</label></div>"}function w(e,t){y(e),$("button.edit-follow-up:last").on("click",x),$("button.delete-follow-up:last").on("click",j),t===!0&&l()}function S(e,t){b(e),t===!0&&l()}function E(){var e=u();return e===!1?!1:(c(e,q()?w:S,!1),void 0)}function T(){var e=u();return e===!1?!1:(c(e,q()?w:S,!0),void 0)}function x(e){var t,n=e.currentTarget.parentElement.parentElement,o=n.children[2].innerHTML||"",a=(n.getAttribute("communication_card_options")||"").split(","),r={commitment_christ:!1,recommitment_christ:!1,commitment_tithe:!1,commitment_ministry:!1,commitment_baptism:!1,info_next:!1,info_gkids:!1,info_ggroups:!1,info_gteams:!1,info_member:!1,info_visit:!1};for(t=0;t<a.length;t++)r[a[t]]=!0;G.setAttribute("personid",n.children[0].getAttribute("personid")||""),G.setAttribute("person_name",n.children[0].getAttribute("person_name")||""),G.innerHTML=n.children[0].innerHTML||"",R.value=n.children[1].getAttribute("typeCd")||"",Y.value=o,Q.checked=r.commitment_christ,W.checked=r.recommitment_christ,K.checked=r.commitment_tithe,Z.checked=r.commitment_ministry,X.checked=r.commitment_baptism,et.checked=r.info_next,tt.checked=r.info_gkids,nt.checked=r.info_ggroups,ot.checked=r.info_gteams,at.checked=r.info_member,rt.checked=r.info_visit,dt.value=n.children[4].innerHTML||"",U.value=n.getAttribute("follow_up_id"),ct.checked=""===o,Y.disabled=ct.checked;var i=n.children[3].getAttribute("visitorsIds")||"",c=i.split(","),s=st.querySelectorAll("input");for(t=0;t<s.length;t++)s[t].checked=c.indexOf(s[t].getAttribute("personid"))>=0;N(),z.text("Edit Follow Up");var d=$(".follow-ups-form").offset().top;$("body").animate({scrollTop:d},200),$(".follow-ups-form").effect("highlight",{},1200)}function q(){return-1===z.text().indexOf("Edit")}function A(){gt.dialog("open")}function L(){gt.dialog("close")}function M(e){J||confirm("If you continue you will lose any unsaved changes. Continue?")||e.preventDefault()}function O(){confirm("If you continue you will lose any unsaved changes. Continue?")&&l()}function j(e){if(confirm("Are you sure you would like to PERMANENTLY delete this Follow Up?")){var t=e.currentTarget.parentElement.parentElement,n=t.getAttribute("follow_up_id"),o=t.children[0].getAttribute("personid");s(n,o)}}function C(e){Y.disabled=e.target.checked,Y.value=""}function N(){B.style.display=3==R.value?"inherit":"none"}function H(){$("#attendance-nav").on("click",M),$("#reports-nav").on("click",M),$("button.edit-follow-up").on("click",x),$("button.delete-follow-up").on("click",j)}function P(){$("#attendance-nav").off("click",M),$("#reports-nav").off("click",M),$("button.edit-follow-up").off("click",x),$("button.delete-follow-up").off("click",j)}function I(){return--bt}function D(e){var t=$("#search-table-container"),n=-1==e.target.id.indexOf("top")?t[0].scrollHeight:0;t.stop().animate({scrollTop:n},vt,"swing",function(){$("<style></style>").appendTo($(document.body)).remove()})}if(0!==$(".follow-ups-form").length){$("#follow-up-date").datepicker(),$("#follow-ups-for-date").datepicker({dateFormat:"m/d/yy"}),$("#follow-ups-for-date").datepicker("setDate",new Date);var F=[],J=!0,z=$("#follow-ups-form-title"),U=document.querySelector("#follow-up-id"),G=document.querySelector("#follow-up-person"),R=document.querySelector("#follow-up-type"),Y=document.querySelector("#follow-up-date"),V=document.querySelector("#follow-ups-for-date"),B=document.querySelector(".communication-card-options"),Q=document.querySelector("#follow-up-commitment-christ"),W=document.querySelector("#follow-up-recommitment-christ"),K=document.querySelector("#follow-up-commitment-tithe"),Z=document.querySelector("#follow-up-commitment-ministry"),X=document.querySelector("#follow-up-commitment-baptism"),et=document.querySelector("#follow-up-info-next"),tt=document.querySelector("#follow-up-info-gkids"),nt=document.querySelector("#follow-up-info-ggroups"),ot=document.querySelector("#follow-up-info-gteams"),at=document.querySelector("#follow-up-info-member"),rt=document.querySelector("#follow-up-info-visit"),it=document.querySelector("#get-follow-ups"),ct=document.querySelector("#unknown-date"),st=document.querySelector("#follow-up-visitors"),dt=document.querySelector("#follow-up-comments"),lt=document.querySelector("#add-clear"),ut=document.querySelector("#add-copy"),mt=document.querySelector("#clear"),pt=document.querySelector("#add-new-person"),ft=document.querySelector("#search"),ht=document.querySelector("#search-name"),_t=document.querySelector("#close"),gt=$(".dialog-form").dialog({autoOpen:!1,height:400,width:510,modal:!0}),vt=1e3,yt=document.querySelector("#select-person-btn"),bt=-1,kt={1:"Phone Call",2:"Visit",3:"Communication Card",4:"Entered in The City",5:"Thank You Card Sent"};$(".navigation-links a").on("click",D),ut.addEventListener("click",E),lt.addEventListener("click",T),mt.addEventListener("click",O),yt.addEventListener("click",A),pt.addEventListener("click",t),ft.addEventListener("click",n),ht.addEventListener("keydown",function(e){13==e.keyCode&&n()}),_t.addEventListener("click",L),it.addEventListener("click",i),$("#unknown-date").on("change",C),$("#follow-up-type").on("change",N),l(),checkLoginStatus(r)}}(),function(){"use strict";function e(){var e=r.value,o=i.value;t(e,o)&&n(e,$.md5(o))}function t(e,t){var n="";return $.trim(e)||(n+="Username cannot be blank<br />"),t||(n+="Password cannot be blank<br />"),n?($().toastmessage("showErrorToast",n),!1):!0}function n(e,t){$.ajax({type:"POST",url:"ajax/login.php",data:{username:e,password:t}}).done(function(e){var t=JSON.parse(e);t.success?window.location="attendance.html":$().toastmessage("showErrorToast","Username or password is incorrect")})}function o(){window.location="attendance.html"}var a=document.querySelector("#login-btn"),r=document.querySelector("#username"),i=document.querySelector("#password");a&&(a.addEventListener("click",e),$(document).keypress(function(t){13==t.which&&e()}),checkLoginStatus(o,!0))}(),function(){"use strict";function e(){o.classList.remove("open"),n.classList.remove("open")}function t(){o.classList.toggle("open"),n.classList.toggle("open")}if(0!==$(".menu").length){var n=document.querySelector(".navdrawer-container"),o=document.querySelector(".app-bar"),a=document.querySelector(".menu"),r=document.querySelector("main");r.addEventListener("touchstart",e),r.addEventListener("click",e),a.addEventListener("click",t),n.addEventListener("click",function(t){("A"===t.target.nodeName||"LI"===t.target.nodeName)&&e()})}}(),function(){"use strict";function e(e){var t=$("#state");$.each(e,function(e,n){t.append("<option value="+n.abbreviation+">"+n.name+"</option>")}),t.val("OH")}function t(){var e=$("#follow-up-type");$.each(Kn,function(t,n){e.append("<option value="+t+">"+n+"</option>")}),e.val("2"),e=$("#relationship-type"),$.each(Zn,function(t,n){e.append("<option value="+t+">"+n+"</option>")}),e.val("1")}function n(e){bt.value=e.first_name,kt.value=e.last_name,$t.value=e.description,wt.value=e.first_visit,St.innerHTML=e.first_attendance_dt||'<span style="font-style: italic;">(None)</span>',Et.checked=e.adult,Tt.checked=e.active,xt.checked=e.baptized,qt.checked=e.saved,At.checked=e.member,Lt.checked=e.visitor,Mt.checked=e.assigned_agent,Ot.value=e.street1,jt.value=e.street2,Ct.value=e.city,Nt.value=e.zip,e.state&&(Dt.value=e.state),Ht.value=e.email,Pt.value=_t(e.primary_phone),It.value=_t(e.secondary_phone),o(e),a(e),H(e.follow_ups),D(e.relationships)}function o(e){Ft.checked=e.commitment_christ,Jt.checked=e.recommitment_christ,zt.checked=e.commitment_tithe,Ut.checked=e.commitment_ministry,Gt.checked=e.commitment_baptism,Rt.checked=e.info_next,Yt.checked=e.info_gkids,Vt.checked=e.info_ggroups,Bt.checked=e.info_gteams,Qt.checked=e.info_member,Wt.checked=e.info_visit}function a(e){var t=ct(e);Bn.innerHTML="OH"===t||""===t?"":'<a href="'+Wn+t+'" target="_blank"><img border="0" src="'+Qn+t+'" /></a>'}function r(){var e={id:vt.id,first_name:$.trim(bt.value),last_name:$.trim(kt.value),description:$.trim($t.value),first_visit:$.trim(wt.value),adult:Et.checked,active:Tt.checked,baptized:xt.checked,saved:qt.checked,member:At.checked,visitor:Lt.checked,assigned_agent:Mt.checked,street1:$.trim(Ot.value),street2:$.trim(jt.value),city:$.trim(Ct.value),zip:$.trim(Nt.value),state:$.trim(Dt.value),email:$.trim(Ht.value),primary_phone:$.trim(Pt.value),secondary_phone:$.trim(It.value),commitment_christ:Ft.checked,recommitment_christ:Jt.checked,commitment_tithe:zt.checked,commitment_ministry:Ut.checked,commitment_baptism:Gt.checked,info_next:Rt.checked,info_gkids:Yt.checked,info_ggroups:Vt.checked,info_gteams:Bt.checked,info_member:Qt.checked,info_visit:Wt.checked,follow_ups:i()};
"OH"===$.trim(ct(e))&&(e.state=""),c(e)&&g(e)}function i(){var e=[];return $("#follow-up-table tbody tr").each(function(t,n){e.push({id:n.getAttribute("follow_up_id"),typeCd:n.children[0].getAttribute("typeCd")||"",date:n.children[1].innerHTML||"",comments:n.children[3].innerHTML||"",visitorsIds:n.children[2].getAttribute("visitorsIds").split(",")||"",visitors:n.children[2].innerHTML.split(", ")||""})}),e}function c(e){var t="",n=!!e.first_name,o=!!e.last_name,a=!!e.description;return!n&&o?t+="First Name cannot be blank if Last Name is specified<br />":n&&!o?t+="Last Name cannot be blank if First Name is specified<br />":n||o||a||(t+="Must specify either First and Last Name or Description<br />"),e.first_name.length>50&&(t+="First Name cannot exceed 50 characters<br />"),e.last_name.length>50&&(t+="Last Name cannot exceed 50 characters<br />"),e.description.length>250&&(t+="Description cannot exceed 250 characters<br />"),e.email.length>100&&(t+="Email cannot exceed 100 characters<br />"),Ht.checkValidity()||(t+="Email is not valid<br />"),e.primary_phone.length>15?t+="Primary Phone cannot exceed 15 characters<br />":e.primary_phone.length>0&&!Vn.test(e.primary_phone)&&(t+="Primary Phone is not a valid phone number format<br />"),e.secondary_phone.length>15?t+="Secondary Phone cannot exceed 15 characters<br />":e.secondary_phone.length>0&&!Vn.test(e.secondary_phone)&&(t+="Secondary Phone is not a valid phone number format<br />"),e.street1.length>100&&(t+="Street 1 cannot exceed 100 characters<br />"),e.street2.length>100&&(t+="Street 2 cannot exceed 100 characters<br />"),e.city.length>100&&(t+="City cannot exceed 100 characters<br />"),e.zip.length>5&&(t+="Zip Code cannot exceed 5 characters<br />"),e.street1.length>100&&(t+="Street 1 cannot exceed 100 characters<br />"),t?($().toastmessage("showErrorToast",t),!1):!0}function s(){confirm("Deleting someone also deletes their attendance history. Continue?")&&v()}function d(){confirm("If you continue you will lose any unsaved changes. Continue?")&&(n(vt),Yn=!0)}function l(){var e=$.trim(fn.value);""===e?$().toastmessage("showErrorToast","Must enter Name"):m(e)}function u(){var e=$.trim(fn.value);""===e?$().toastmessage("showErrorToast","Must enter Name"):p(e)}function m(e){$.ajax({type:"POST",url:"ajax/create_person.php",data:{person_display:e}}).done(function(e){var t=JSON.parse(e);t.success?T(t.person_id,t.person_name):1===t.error?logout():$().toastmessage("showErrorToast","Error loading visitors")}).fail(function(){$().toastmessage("showErrorToast","Error loading visitors")})}function p(e){$.ajax({type:"GET",url:"ajax/search.php",data:{search:e}}).done(function(e){var t=JSON.parse(e);t.success?q(t.people):1===t.error?logout():$().toastmessage("showErrorToast","Error loading visitors")}).fail(function(){$().toastmessage("showErrorToast","Error loading visitors")})}function f(){$.ajax({type:"GET",url:"ajax/states.json"}).done(function(n){if($.isArray(n))e(n);else{var o=JSON.parse(n);e(o)}t(),_(),h()}).fail(function(){$().toastmessage("showErrorToast","Error loading states")})}function h(){$.ajax({type:"GET",url:"ajax/get_visitors.php"}).done(function(e){var t=JSON.parse(e);t.success?yt=t.people:1===t.error?logout():$().toastmessage("showErrorToast","Error loading visitors")}).fail(function(){$().toastmessage("showErrorToast","Error loading visitors")})}function _(){$.ajax({type:"GET",url:"ajax/get_person.php",data:{id:gt.id}}).done(function(e){var t=JSON.parse(e);t.success?(vt=t.person,n(t.person)):1===t.error?logout():$().toastmessage("showErrorToast","Error loading")}).fail(function(){$().toastmessage("showErrorToast","Error loading person")})}function g(e){$.ajax({type:"POST",url:"ajax/save_person.php",data:{person:JSON.stringify(e)}}).done(function(t){var n=JSON.parse(t);n.success?(vt=e,Yn=!0,a(e),H(n.follow_ups),$().toastmessage("showSuccessToast","Save successful")):1===n.error?logout():$().toastmessage("showErrorToast","Error saving person")}).fail(function(){$().toastmessage("showErrorToast","Error saving person")})}function v(){$.ajax({type:"POST",url:"ajax/delete_person.php",data:{id:vt.id}}).done(function(e){var t=JSON.parse(e);t.success?window.location="attendance.html":1===t.error?logout():$().toastmessage("showErrorToast","Error deleting person")}).fail(function(){$().toastmessage("showErrorToast","Error deleting person")})}function y(e,t){$.ajax({type:"POST",url:"ajax/save_follow_up.php",data:{follow_up:JSON.stringify(e)}}).done(function(n){var a=JSON.parse(n);a.success?(e.id=a.follow_up_id,k(a.communication_card_options[0]),o(a.communication_card_options[0]),t.call(this,e),$().toastmessage("showSuccessToast","Follow up save successful")):1===a.error?logout():a.warning?$().toastmessage("showErrorToast",a.warning):$().toastmessage("showErrorToast","Error saving follow up")}).fail(function(){$().toastmessage("showErrorToast","Error saving follow up")})}function b(e){$.ajax({type:"POST",url:"ajax/delete_follow_up.php",data:{id:e,personId:vt.id}}).done(function(t){var n=JSON.parse(t);n.success?($("#follow-up-table tr[follow_up_id="+e+"]").remove(),k(n.communication_card_options[0]),o(n.communication_card_options[0])):1===n.error?logout():n.warning?$().toastmessage("showErrorToast",n.warning):$().toastmessage("showErrorToast","Error deleting follow up")}).fail(function(){$().toastmessage("showErrorToast","Error deleting follow up")})}function k(e){for(var t in e)e.hasOwnProperty(t)&&(e[t]="true"===e[t])}function w(e,t){$.ajax({type:"POST",url:"ajax/save_relationship.php",data:{relationship:JSON.stringify(e)}}).done(function(n){var o=JSON.parse(n);o.success?(e.id=o.relationship_id,t.call(this,e),$().toastmessage("showSuccessToast","Relationship save successful")):1===o.error?logout():$().toastmessage("showErrorToast","Error saving relationship")}).fail(function(){$().toastmessage("showErrorToast","Error saving relationship")})}function S(e){$.ajax({type:"POST",url:"ajax/delete_relationship.php",data:{id:e}}).done(function(t){var n=JSON.parse(t);n.success?$("#relationship-table tr[relationship_id="+e+"]").remove():1===n.error?logout():$().toastmessage("showErrorToast","Error deleting relationship")}).fail(function(){$().toastmessage("showErrorToast","Error deleting relationship")})}function E(e){var t=e.currentTarget.parentElement.parentElement,n=t.getAttribute("person_id"),o=t.children[0].getAttribute("person_name");T(n,o)}function T(e,t){M(),sn.innerHTML='<a class="person_name" href="manage-person.html?id='+e+'">'+t+"</a>",sn.setAttribute("relationid",e),sn.setAttribute("person_name",t)}function x(e){var t=e.currentTarget.parentElement.parentElement,n=t.getAttribute("person_id");window.location="manage-person.html?id="+n}function q(e){$("a.person_name").off("click",E),$("button.search-button").off("click",x),$("#search-table tbody tr").remove();for(var t=0;t<e.length;t++)A(e[t]);$("a.person_name").on("click",E),$("button.search-button").on("click",x)}function A(e){var t=j(e);$("#search-table > tbody:last").append('<tr person_id="'+e.id+'"><td data-th="Name" person_name="'+t+'"><a class="person_name" href="javascript:void(0);">'+t+'</a></td><td data-th="Address">'+O(e)+'</td><td data-th="" class="search-table-button-col"><button class="search-button button--blue-x-small">Manage</button></td></tr>')}function L(){un.dialog("open")}function M(){un.dialog("close")}function O(e){var t="";return t+=e.street1||"",e.street1&&(t+="<br />"),t+=e.street2||"",e.street2&&(t+="<br />"),t+=e.city||"",e.city&&e.state&&(t+=","),t+=" ",t+=e.state||"",t+=" ",t+=e.zip||"",t.trim()}function j(e,t){if(null===e)return"";var n="";return e.first_name||e.last_name?(e.last_name&&(n+=e.last_name),e.last_name&&e.first_name?t===!0?n+=", "+e.first_name:n=e.first_name+" "+n:e.first_name&&(n+=e.first_name+" ")):n=e.description,n}function C(){Tn.value="2",xn.value="",xn.disabled=!1,qn.checked=!1,zn.value="",Mn.checked=!1,On.checked=!1,jn.checked=!1,Cn.checked=!1,Nn.checked=!1,Hn.checked=!1,Pn.checked=!1,In.checked=!1,Dn.checked=!1,Fn.checked=!1,Jn.checked=!1,lt();var e=$("#relationship-table td[typecd=1]");wn.style.display=e.length>0?"inherit":"none",Sn.checked=!0;for(var t=An.querySelectorAll("input"),n=0;n<t.length;n++)t[n].checked=!1}function N(){var e=$.trim(xn.value),t=$.trim(Tn.value),n=$.trim(zn.value),o=[],a=[],r={commitment_christ:!1,recommitment_christ:!1,commitment_tithe:!1,commitment_ministry:!1,commitment_baptism:!1,info_next:!1,info_gkids:!1,info_ggroups:!1,info_gteams:!1,info_member:!1,info_visit:!1},i="",c="";""!==n||1!=t&&2!=t||(i+="Must specify comments<br />"),""!==e||qn.checked||(i+="Must specify a date or mark it unknown<br />"),n.length>5e3&&(i+="Comments cannot exceed 5000 characters<br />");for(var s=An.querySelectorAll("input"),d=0;d<s.length;d++)s[d].checked&&(o.push($.trim(s[d].nextSibling.innerHTML)),a.push(s[d].getAttribute("personid")));if(0===a.length&&(i+="Must specify a visitor<br />"),i)return $().toastmessage("showErrorToast",i),!1;var l=$("#relationship-table td[typecd=1]");return l.length>0&&Sn.checked&&-1===Un.text().indexOf("Edit")&&(c=l.next()[0].getAttribute("relationid")),3==t&&(r={commitment_christ:Mn.checked,recommitment_christ:On.checked,commitment_tithe:jn.checked,commitment_ministry:Cn.checked,commitment_baptism:Nn.checked,info_next:Hn.checked,info_gkids:Pn.checked,info_ggroups:In.checked,info_gteams:Dn.checked,info_member:Fn.checked,info_visit:Jn.checked}),{id:-1===Un.text().indexOf("Edit")?ft():En.value,personId:vt.id,spouseId:c,date:e,typeCd:t,type:Tn.selectedOptions[0].text,comments:n,visitors:o,visitorsIds:a,communication_card_options:r}}function H(e){pt(),$("#follow-up-table tbody tr").remove();for(var t=0;t<e.length;t++)P(e[t]);mt()}function P(e){!e.type&&e.typeCd&&(e.type=Kn[e.typeCd]||""),e.date=e.date||"";var t=[];for(var n in e.communication_card_options)e.communication_card_options.hasOwnProperty(n)&&e.communication_card_options[n]===!0&&t.push(n);$("#follow-up-table > tbody:last").append('<tr follow_up_id="'+e.id+'" communication_card_options="'+t.join(",")+'"><td data-th="Type" typeCd="'+e.typeCd+'">'+e.type+'</td><td data-th="Date" class="follow-up-table-date-col">'+e.date+'</td><td data-th="By" visitorsIds="'+e.visitorsIds.join(",")+'">'+e.visitors.join(", ")+'</td><td data-th="Comments" class="follow-up-table-comments-col">'+e.comments+'</td><td data-th="" class="follow-up-table-button-col"><button class="edit-follow-up"><i class="fa fa-edit"></i></button><button class="delete-follow-up"><i class="fa fa-minus-circle"></i></button></td></tr>')}function I(e){var t=$("#follow-up-table tr[follow_up_id="+e.id+"]"),n=t.children(),o=[];for(var a in e.communication_card_options)e.communication_card_options.hasOwnProperty(a)&&e.communication_card_options[a]===!0&&o.push(a);t[0].setAttribute("communication_card_options",o.join(",")),n[0].setAttribute("typeCd",e.typeCd),n[0].innerHTML=e.type,n[1].innerHTML=e.date,n[2].innerHTML=e.visitors.join(", "),n[2].setAttribute("visitorsIds",e.visitorsIds.join(",")),n[3].innerHTML=e.comments}function D(e){pt(),$("#relationship-table tbody tr").remove();for(var t=0;t<e.length;t++)F(e[t]);mt()}function F(e){!e.type&&e.typeCd&&(e.type=Zn[e.typeCd]||""),$("#relationship-table > tbody:last").append('<tr relationship_id="'+e.id+'"><td data-th="Type" typeCd="'+e.typeCd+'">'+e.type+'</td><td data-th="Name" relationId="'+e.relation_id+'" relationname="'+e.name+'"><a class="person_name" href="manage-person.html?id='+e.relation_id+'">'+e.name+'</a></td><td data-th="" class="relationship-table-button-col"><button class="edit-relationship"><i class="fa fa-edit"></i></button><button class="delete-relationship"><i class="fa fa-minus-circle"></i></button></td></tr>')}function J(e){var t=$("#relationship-table tr[relationship_id="+e.id+"]").children();t[0].setAttribute("typeCd",e.typeCd),t[0].innerHTML=e.type,t[1].innerHTML=e.name}function z(){if(""===An.innerHTML.trim())for(var e,t=0;t<yt.length;t++)e=yt[t],An.innerHTML+='<div class="check-field"><input type="checkbox" personid="'+e.id+'" id="follow-up-by-'+e.id+'"/><label for="follow-up-by-'+e.id+'">'+j(e)+"</label></div>"}function U(){tn.dialog("open"),R(),Gn.text("Add Relationship")}function G(){tn.dialog("close")}function R(){on.value="1",sn.innerHTML="(Select a person)",sn.setAttribute("relationid",""),sn.setAttribute("person_name",""),dn.style.display="none"}function Y(){var e=Q();return e===!1?!1:(w(e,function(e){F(e),$("button.edit-relationship:last").on("click",W),$("button.delete-relationship:last").on("click",K),tn.dialog("close")}),void 0)}function V(){var e=Q();return e===!1?!1:(w(e,function(e){J(e),tn.dialog("close")}),void 0)}function B(){-1===Gn.text().indexOf("Edit")?Y():V()}function Q(){var e=$.trim(on.value),t=sn.getAttribute("relationid"),n="",o="";if(t?t==vt.id&&(n+="Person cannot have a relationship with themself<br />"):n+="Must select a person<br />",n)return $().toastmessage("showErrorToast",n),!1;var a=$("#relationship-table td[typecd=1]");return a.length>0&&"2"===e&&ln.checked&&(o=a.next()[0].getAttribute("relationid")),{id:-1===Gn.text().indexOf("Edit")?ht():nn.value,spouseId:o,typeCd:e,type:on.selectedOptions[0].text,person_id:vt.id,relation_id:t,name:sn.getAttribute("person_name")}}function W(e){tn.dialog("open");var t=e.currentTarget.parentElement.parentElement;on.value=t.children[0].getAttribute("typeCd")||"",nn.value=t.getAttribute("relationship_id"),T(t.children[1].getAttribute("relationid"),t.children[1].getAttribute("relationname")),Gn.text("Edit Follow Up")}function K(e){if(confirm("Are you sure you would like to PERMANENTLY delete this Relationship?")){var t=e.currentTarget.parentElement.parentElement.getAttribute("relationship_id");S(t)}}function Z(){$n.dialog("open"),C(),z(),Un.text("Add Follow Up")}function X(){$n.dialog("close")}function et(e){var t=N();return t===!1?!1:(y(t,function(t){P(t),$("button.edit-follow-up:last").on("click",rt),$("button.delete-follow-up:last").on("click",it),Yn=!1,e.call(this)}),void 0)}function tt(e){var t=N();return t===!1?!1:(y(t,function(t){I(t),Yn=!1,e.call(this)}),void 0)}function nt(){-1===Un.text().indexOf("Edit")?et():tt()}function ot(){-1===Un.text().indexOf("Edit")?et(C):tt(C)}function at(){-1===Un.text().indexOf("Edit")?et(X):tt(X)}function rt(e){$n.dialog("open"),wn.style.display="none",z();var t,n=e.currentTarget.parentElement.parentElement,o=n.children[1].innerHTML||"",a=(n.getAttribute("communication_card_options")||"").split(","),r={commitment_christ:!1,recommitment_christ:!1,commitment_tithe:!1,commitment_ministry:!1,commitment_baptism:!1,info_next:!1,info_gkids:!1,info_ggroups:!1,info_gteams:!1,info_member:!1,info_visit:!1};for(t=0;t<a.length;t++)r[a[t]]=!0;Tn.value=n.children[0].getAttribute("typeCd")||"",xn.value=o,zn.value=n.children[3].innerHTML||"",En.value=n.getAttribute("follow_up_id"),qn.checked=""===o,Mn.checked=r.commitment_christ,On.checked=r.recommitment_christ,jn.checked=r.commitment_tithe,Cn.checked=r.commitment_ministry,Nn.checked=r.commitment_baptism,Hn.checked=r.info_next,Pn.checked=r.info_gkids,In.checked=r.info_ggroups,Dn.checked=r.info_gteams,Fn.checked=r.info_member,Jn.checked=r.info_visit,xn.disabled=qn.checked;var i=n.children[2].getAttribute("visitorsIds")||"",c=i.split(","),s=An.querySelectorAll("input");for(t=0;t<s.length;t++)s[t].checked=c.indexOf(s[t].getAttribute("personid"))>=0;lt(),Un.text("Edit Follow Up")}function it(e){if(confirm("Are you sure you would like to PERMANENTLY delete this Follow Up?")){var t=e.currentTarget.parentElement.parentElement.getAttribute("follow_up_id");b(t)}}function ct(e){var t="";return t+=e.street1||"",t+=" ",t+=e.street2||"",t+=" ",t+=e.city||"",t+=" ",t+=e.state||"",t+=" ",t+=e.zip||"",t.trim()}function st(e){xn.disabled=e.currentTarget.checked,xn.value=""}function dt(){var e=$.trim(on.value);if("2"===e){var t=$("#relationship-table td[typecd=1]");dn.style.display=t.length>0?"inherit":"none",ln.checked=!0}else dn.style.display="none"}function lt(){Ln.style.display=3==Tn.value?"inherit":"none"}function ut(e){Yn||confirm("If you continue you will lose any unsaved changes. Continue?")||e.preventDefault()}function mt(){$("#attendance-nav").on("click",ut),$("#reports-nav").on("click",ut),$("button.edit-follow-up").on("click",rt),$("button.delete-follow-up").on("click",it),$("button.edit-relationship").on("click",W),$("button.delete-relationship").on("click",K)}function pt(){$("#attendance-nav").off("click",ut),$("#reports-nav").off("click",ut),$("button.edit-follow-up").off("click",rt),$("button.delete-follow-up").off("click",it),$("button.edit-relationship").off("click",W),$("button.delete-relationship").off("click",K)}function ft(){return Rn--}function ht(){return gn--}function _t(e){if(e=e||"",null===e.match(/\D/g,"")){var t=e.replace(/\D/g);7===t.length?e=t.substr(0,3)+"-"+t.substr(3):10===t.length&&(e="("+t.substr(0,3)+") "+t.substr(3,3)+"-"+t.substr(6))}return e}if(0!==$("#manage-person").length){$("#follow-up-date").datepicker(),$("#first-visit").datepicker();var gt={},vt={},yt=[],bt=document.querySelector("#first-name"),kt=document.querySelector("#last-name"),$t=document.querySelector("#description"),wt=document.querySelector("#first-visit"),St=document.querySelector("#first-recorded-visit"),Et=document.querySelector("#adult"),Tt=document.querySelector("#active"),xt=document.querySelector("#baptized"),qt=document.querySelector("#saved"),At=document.querySelector("#member"),Lt=document.querySelector("#visitor"),Mt=document.querySelector("#assigned-agent"),Ot=document.querySelector("#street1"),jt=document.querySelector("#street2"),Ct=document.querySelector("#city"),Nt=document.querySelector("#zip"),Ht=document.querySelector("#email"),Pt=document.querySelector("#primary-phone"),It=document.querySelector("#secondary-phone"),Dt=document.querySelector("#state"),Ft=document.querySelector("#commitment-christ"),Jt=document.querySelector("#recommitment-christ"),zt=document.querySelector("#commitment-tithe"),Ut=document.querySelector("#commitment-ministry"),Gt=document.querySelector("#commitment-baptism"),Rt=document.querySelector("#info-next"),Yt=document.querySelector("#info-gkids"),Vt=document.querySelector("#info-ggroups"),Bt=document.querySelector("#info-gteams"),Qt=document.querySelector("#info-member"),Wt=document.querySelector("#info-visit"),Kt=document.querySelector("#update"),Zt=document.querySelector("#cancel"),Xt=document.querySelector("#delete"),en=document.querySelector("#add-follow-up"),tn=$(".manage-person-relationship-form").dialog({autoOpen:!1,height:400,width:510,modal:!0}),nn=tn[0].querySelector("#relationship-id"),on=tn[0].querySelector("#relationship-type"),an=document.querySelector("#add-relationship"),rn=document.querySelector("#add-close-relationship"),cn=document.querySelector("#close-relationship"),sn=document.querySelector("#relationship-relation"),dn=tn[0].querySelector("#add-to-spouse-container-relationship"),ln=tn[0].querySelector("#add-to-spouse-relationship"),un=$(".select-person-form").dialog({autoOpen:!1,height:400,width:510,modal:!0}),mn=document.querySelector("#add-new-person"),pn=document.querySelector("#search"),fn=document.querySelector("#search-name"),hn=document.querySelector("#close-select-person"),_n=document.querySelector("#select-person-btn"),gn=-1,vn=document.querySelector("#add-clear"),yn=document.querySelector("#add-copy"),bn=document.querySelector("#add-close"),kn=document.querySelector("#close"),$n=$(".manage-person-follow-up-form").dialog({autoOpen:!1,height:400,width:510,modal:!0}),wn=$n[0].querySelector("#add-to-spouse-container-follow-up"),Sn=$n[0].querySelector("#add-to-spouse-follow-up"),En=$n[0].querySelector("#follow-up-id"),Tn=$n[0].querySelector("#follow-up-type"),xn=$n[0].querySelector("#follow-up-date"),qn=document.querySelector("#manage-unknown-date"),An=$n[0].querySelector("#follow-up-visitors"),Ln=$n[0].querySelector(".communication-card-options"),Mn=$n[0].querySelector("#follow-up-commitment-christ"),On=$n[0].querySelector("#follow-up-recommitment-christ"),jn=$n[0].querySelector("#follow-up-commitment-tithe"),Cn=$n[0].querySelector("#follow-up-commitment-ministry"),Nn=$n[0].querySelector("#follow-up-commitment-baptism"),Hn=$n[0].querySelector("#follow-up-info-next"),Pn=$n[0].querySelector("#follow-up-info-gkids"),In=$n[0].querySelector("#follow-up-info-ggroups"),Dn=$n[0].querySelector("#follow-up-info-gteams"),Fn=$n[0].querySelector("#follow-up-info-member"),Jn=$n[0].querySelector("#follow-up-info-visit"),zn=$n[0].querySelector("#follow-up-comments"),Un=$(".ui-dialog-title").text("Edit Follow Up"),Gn=$(".ui-dialog-title").text("Edit Relationship"),Rn=-1,Yn=!0,Vn=/^((\(?([2-9][0-8][0-9])\))|([2-9][0-8][0-9]))?[-. ]?([2-9][0-9]{2})[-. ]?([0-9]{4})$/,Bn=document.querySelector("#map-panel"),Qn="//maps.googleapis.com/maps/api/staticmap?zoom=11&size=400x400&markers=color:red%7Clabel:A|",Wn="https://www.google.com/maps/place/",Kn={1:"Phone Call",2:"Visit",3:"Communication Card",4:"Entered in The City",5:"Thank You Card Sent"},Zn={1:"Spouse",2:"Child",3:"Parent"};(window.onpopstate=function(){var e,t=/\+/g,n=/([^&=]+)=?([^&]*)/g,o=function(e){return decodeURIComponent(e.replace(t," "))},a=window.location.search.substring(1);for(gt={};null!==(e=n.exec(a));)gt[o(e[1])]=o(e[2])}).call(),gt.id||(window.location="attendance.html"),Kt.addEventListener("click",r),Zt.addEventListener("click",d),Xt.addEventListener("click",s),en.addEventListener("click",Z),yn.addEventListener("click",nt),vn.addEventListener("click",ot),bn.addEventListener("click",at),kn.addEventListener("click",X),$("#follow-up-type").on("change",lt),an.addEventListener("click",U),rn.addEventListener("click",B),cn.addEventListener("click",G),$("#relationship-type").on("change",dt),_n.addEventListener("click",L),mn.addEventListener("click",l),pn.addEventListener("click",u),fn.addEventListener("keydown",function(e){13==e.keyCode&&u()}),hn.addEventListener("click",close),$("#manage-unknown-date").on("change",st),checkLoginStatus(f)}}(),function(){"use strict";function e(e,t){k.innerHTML=e?e:"N/A",w.innerHTML=t?t:"N/A";var n=new Date;b.value=$.datepicker.formatDate("mm/dd/yy",new Date(n.getFullYear(),n.getMonth(),1,0,0,0,0)),y.value=$.datepicker.formatDate("mm/dd/yy",n)}function t(){var e=parseInt(S.value);$("#report-type-container")[0].style.setProperty("display",3===e?"inline-block":"block"),$("#from-to-dates")[0].style.setProperty("display",3===e?"none":"inline-block"),(3===e||4===e)&&(b.value="",y.value=""),$("#first-last-dates")[0].style.setProperty("display",4===e?"none":"inherit"),$("#communication-card-header")[0].style.setProperty("display",4===e?"inherit":"none"),$("#follow-up-options")[0].style.setProperty("display",4===e?"inline-block":"none"),$("#follow-up-options-spacer")[0].style.setProperty("display",4===e?"inherit":"none")}function n(){var e=parseInt(S.value);if(a(b.value,y.value,1===e||2===e)){o();var t;switch(e){case 1:$("#attendance-by-date-container")[0].style.setProperty("display","inherit"),t={fromDate:b.value,toDate:y.value};break;case 2:$("#attendance-by-person-container")[0].style.setProperty("display","inherit"),t={fromDate:b.value,toDate:y.value};break;case 3:$("#attendance-by-mia-container")[0].style.setProperty("display","inherit");break;case 4:$("#follow-up-container")[0].style.setProperty("display","inherit"),t={fromDate:b.value,toDate:y.value,active:$("#active").is(":checked"),not_visited:$("#not-visited").is(":checked"),ty_card_not_sent:$("#ty-card-not-sent").is(":checked"),signed_up_for_baptism:$("#signed-up-for-baptism").is(":checked"),baptized:$("#baptized").is(":checked"),interested_in_gkids:$("#interested-in-gkids").is(":checked"),interested_in_next:$("#interested-in-next").is(":checked"),interested_in_ggroups:$("#interested-in-ggroups").is(":checked"),interested_in_gteams:$("#interested-in-gteams").is(":checked"),interested_in_joining:$("#interested-in-joining").is(":checked"),would_like_visit:$("#would-like-visit").is(":checked"),no_agent:$("#no-agent").is(":checked"),commitment_christ:$("#commitment-christ").is(":checked"),recommitment_christ:$("#recommitment-christ").is(":checked"),commitment_tithe:$("#commitment-tithe").is(":checked"),commitment_ministry:$("#commitment-ministry").is(":checked")}}h(e,t)}}function o(){$("#attendance-by-person-container")[0].style.setProperty("display","none"),$("#attendance-by-date-container")[0].style.setProperty("display","none"),$("#attendance-by-mia-container")[0].style.setProperty("display","none"),$("#follow-up-container")[0].style.setProperty("display","none")}function a(e,t,n){var o="";return g(e,!0)||(o+="From Date must be a valid date<br />"),g(t,!0)||(o+="To Date must be a valid date<br />"),o?($().toastmessage("showErrorToast",o),!1):!n||e||t?!0:($().toastmessage("showErrorToast","From Date or To Date must be specified"),!1)}function r(e,t){$("#attendance-date-table > tbody:last").empty(),$("#attendance-date-aggregates-table > tbody:last").empty();for(var n="",o=0;o<e.length;o++)n+=i(e[o]);$("#attendance-date-table > tbody:last").append(n),$("#attendance-date-aggregates-table > tbody:last").append(c(t))}function i(e){return'<tr><td data-th="Date">'+e.Attendance_dt+'</td><td class="report-attendance-table-attendance-col" data-th="Total">'+e.Total_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="First">'+e.First_Service_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Second">'+e.Second_Service_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="First Adult">'+e.First_Service_Adult_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Second Adult">'+e.Second_Service_Adult_Attendance+"</td></tr>"}function c(e){var t="",n=e[0];return t+='<tr><td data-th="Aggregate">Average</td><td class="report-attendance-table-attendance-col" data-th="Average Total">'+n.Avg_Total_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Average First">'+n.Avg_First_Service_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Average Second">'+n.Avg_Second_Service_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Average First Adult">'+n.Avg_First_Service_Adult_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Average Second Adult">'+n.Avg_Second_Service_Adult_Attendance+"</td></tr>",t+='<tr><td data-th="Aggregate">Max</td><td class="report-attendance-table-attendance-col" data-th="Max Total">'+n.Max_Total_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Max First">'+n.Max_First_Service_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Max Second">'+n.Max_Second_Service_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Max First Adult">'+n.Max_First_Service_Adult_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Max Second Adult">'+n.Max_Second_Service_Adult_Attendance+"</td></tr>",t+='<tr><td data-th="Aggregate">Min</td><td class="report-attendance-table-attendance-col" data-th="Min Total">'+n.Min_Total_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Min First">'+n.Min_First_Service_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Min Second">'+n.Min_Second_Service_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Min First Adult">'+n.Min_First_Service_Adult_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Min Second Adult">'+n.Min_Second_Service_Adult_Attendance+"</td></tr>"}function s(e){$("#adult-attendance-table > tbody:last").empty();for(var t="",n=0;n<e.length;n++)"true"==e[n].adult&&(t+=m(e[n]));$("#adult-attendance-table > tbody:last").append(t)}function d(e){$("#mia-attendance-table > tbody:last").empty();for(var t="",n=0;n<e.length;n++)"true"==e[n].adult&&(t+=u(e[n]));$("#mia-attendance-table > tbody:last").append(t)}function l(e){$("#follow-up-table > tbody:last").empty();for(var t="",n=0;n<e.length;n++)t+=p(e[n]);$("#follow-up-table > tbody:last").append(t)}function u(e){var t="";return e.first_name||e.last_name?(e.first_name&&(t+=e.first_name+" "),e.last_name&&(t+=e.last_name)):t=e.description,t='<a class="person_name" href="manage-person.html?id='+e.id+'">'+t+"</a>",'<tr adult="'+e.adult+'" personId="'+e.id+'"><td data-th="Name">'+t+"</td></tr>"}function m(e){var t="";return e.first_name||e.last_name?(e.first_name&&(t+=e.first_name+" "),e.last_name&&(t+=e.last_name)):t=e.description,t='<a class="person_name" href="manage-person.html?id='+e.id+'">'+t+"</a>",'<tr adult="'+e.adult+'" personId="'+e.id+'"><td data-th="Name">'+t+'</td><td class="report-attendance-table-attendance-col" data-th="First">'+e.First_Service_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Second">'+e.Second_Service_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Total">'+e.Total_Attendance+"</td></tr>"}function p(e){var t="",n=e.primary_phone||"";return e.first_name||e.last_name?(e.first_name&&(t+=e.first_name+" "),e.last_name&&(t+=e.last_name)):t=e.description,t='<a class="person_name" href="manage-person.html?id='+e.id+'">'+t+"</a>",n=v(n),'<tr personId="'+e.id+'"><td data-th="Name">'+t+'</td><td class="checkbox-table-col" data-th="Visited?"><input type="checkbox" disabled '+("true"===e.visited?"checked ":"")+'/></td><td class="checkbox-table-col" data-th="Phone Number">'+n+'</td><td data-th="Thank You<br />Card Sent">'+(e.ty_card_date||"")+'</td><td data-th="Communication Card<br />Received">'+(e.communication_card_date||"")+"</td></tr>"}function f(e){var t="#"+e.target.parentElement.previousElementSibling.id,n=-1==e.target.id.indexOf("top")?$(t)[0].scrollHeight:0;$(t).animate({scrollTop:n},T,"swing",function(){$("<style></style>").appendTo($(document.body)).remove()})}function h(e,t){$(".reports-form").mask("Loading..."),$.ajax({type:"POST",url:"ajax/get_report.php",data:{type:e,params:JSON.stringify(t)}}).done(function(t){$(".reports-form").unmask();var n=JSON.parse(t);if(n.success)switch(e){case 1:r(n.totals,n.aggregates);break;case 2:s(n.people);break;case 3:d(n.people);break;case 4:l(n.people)}else 1===n.error?logout():$().toastmessage("showErrorToast","Error loading report")}).fail(function(){$(".reports-form").unmask(),$().toastmessage("showErrorToast","Error loading report")})}function _(){$(".reports-form").mask("Loading..."),$.ajax({type:"GET",url:"ajax/get_first_last_service_dates.php"}).done(function(t){$(".reports-form").unmask();var n=JSON.parse(t);n.success?e(n.first_dt,n.last_dt):1===n.error?logout():$().toastmessage("showErrorToast","Error loading data")}).fail(function(){$(".reports-form").unmask(),$().toastmessage("showErrorToast","Error loading data")})}function g(e,t){var n=e;if(""===n)return!!t;var o=/^(\d{1,2})(\/|-)(\d{1,2})(\/|-)(\d{4})$/,a=n.match(o);if(null===a)return!1;var r=a[1],i=a[3],c=a[5];if(1>r||r>12)return!1;if(1>i||i>31)return!1;if((4==r||6==r||9==r||11==r)&&31==i)return!1;if(2==r){var s=c%4===0&&(c%100!==0||c%400===0);if(i>29||29==i&&!s)return!1}return!0}function v(e){if(e=e||"",null===e.match(/\D/g,"")){var t=e.replace(/\D/g);7===t.length?e=t.substr(0,3)+"-"+t.substr(3):10===t.length&&(e="("+t.substr(0,3)+") "+t.substr(3,3)+"-"+t.substr(6))}return e}if(0!==$("#reports").length){$("#from-date").datepicker(),$("#to-date").datepicker();var y=document.querySelector("#to-date"),b=document.querySelector("#from-date"),k=document.querySelector("#first-date"),w=document.querySelector("#last-date"),S=document.querySelector("#report-type"),E=document.querySelector("#go-arrow"),T=300;S.value="1",E.addEventListener("click",n),S.addEventListener("change",t),$(".top-bottom-links a").on("click",f),checkLoginStatus(_)}}(),function(){"use strict";function e(){var e=$.trim(s.value);""===e?$().toastmessage("showErrorToast","Must enter Name"):t(e)}function t(e){$(".search-form").mask("Loading..."),$.ajax({type:"GET",url:"ajax/search.php",data:{search:e}}).done(function(e){var t=JSON.parse(e);
t.success?(o(t.people),$(".search-form").unmask()):1===t.error?logout():$().toastmessage("showErrorToast","Error searching people")}).fail(function(){$().toastmessage("showErrorToast","Error searching people")})}function n(e,t){if(null===e)return"";var n="";return e.first_name||e.last_name?(e.last_name&&(n+=e.last_name),e.last_name&&e.first_name?t===!0?n+=", "+e.first_name:n=e.first_name+" "+n:e.first_name&&(n+=e.first_name+" ")):n=e.description,n}function o(e){$("#search-table tbody tr").remove();for(var t=0;t<e.length;t++)a(e[t])}function a(e){var t=n(e);$("#search-table > tbody:last").append('<tr person_id="'+e.id+'"><td data-th="Name" person_name="'+t+'"><a class="person_name" href="manage-person.html?id='+e.id+'">'+t+'</a></td><td data-th="Email">'+e.email+'</td><td data-th="Address">'+r(e)+"</td></tr>")}function r(e){var t="";return t+=e.street1||"",e.street1&&(t+="<br />"),t+=e.street2||"",e.street2&&(t+="<br />"),t+=e.city||"",e.city&&e.state&&(t+=","),t+=" ",t+=e.state||"",t+=" ",t+=e.zip||"",t.trim()}function i(e){var t=$("#search-table-container"),n=-1==e.target.id.indexOf("top")?t[0].scrollHeight:0;t.stop().animate({scrollTop:n},d,"swing",function(){$("<style></style>").appendTo($(document.body)).remove()})}if(0!==$(".search-form").length){var c=document.querySelector("#search"),s=document.querySelector("#search-name"),d=1e3;$(".navigation-links a").on("click",i),c.addEventListener("click",e),s.addEventListener("keydown",function(t){13==t.keyCode&&e()}),checkLoginStatus()}}();