function checkLoginStatus(e){$.ajax({type:"POST",url:"ajax/check_login.php"}).done(function(t){var a=JSON.parse(t);a.success?e&&e():window.location="index.html"})}function logout(){confirm("If you have unsaved changes logging out will cause you to lose them. Continue?")&&$.ajax({type:"POST",url:"ajax/logout.php"}).done(function(e){var t=JSON.parse(e);t.success?window.location="index.html":$().toastmessage("showErrorToast","Problem logging out")})}!function(){"use strict";function e(){window.location="ajax/export_attendance.php"}function t(){try{$(".attendance-form").mask("Loading..."),setTimeout(a,50)}catch(e){$(".attendance-form").unmask()}}function a(){var e,t,a,n,r,o,c,d,i,l,s=[];for(a=$("#adult-attendance-table > tbody:last").children(),e=0;e<a.length;e++)if(null!==a[e].getAttribute("modified")){if(n=a[e].getAttribute("personId"),o=a[e].querySelector("[name=name_description]"),d=_(n),i=S(n),o){if(r=$.trim(o.value),""===r)continue}else r=void 0;if(-1===n.indexOf("-")&&(l=A(n))){for(c=!1,t=0;t<l.attendance.length;t++)l.attendance[t].date===D&&(l.attendance[t].first=d,l.attendance[t].second=i,c=!0);c||l.attendance.push({date:D,first:d,second:i})}s.push({id:n,adult:!0,display:r,attendanceDate:D,first:d,second:i})}for(a=$("#kid-attendance-table > tbody:last").children(),e=0;e<a.length;e++)if(null!==a[e].getAttribute("modified")){if(n=a[e].getAttribute("personId"),o=a[e].querySelector("[name=name_description]")){if(r=$.trim(o.value),!r)continue}else r=void 0;s.push({id:n,adult:!1,display:r,attendanceDate:D,first:_(n),second:S(n)})}s.length>0?b(s):($(".attendance-form").unmask(),$().toastmessage("showWarningToast","No attendance was modified"))}function n(){(lt||confirm("Clear out any unsaved changes?"))&&r()}function r(){lt=!0,$("#adult-attendance-table > tbody:last").children().remove(),$("#kid-attendance-table > tbody:last").children().remove(),s(et)}function o(){Q.blur(),lt=!1;var e={id:L(),adult:!0},t=p(e,D);$("#adult-attendance-table > tbody:last").append(t),$("[personid="+e.id+"] input:checkbox").on("change",m),$("#adult-attendance-table-container").animate({scrollTop:$("#adult-attendance-table-container")[0].scrollHeight},st)}function c(){X.blur(),lt=!1;var e={id:L(),adult:!1},t=p(e,D);$("#kid-attendance-table > tbody:last").append(t),$("[personid="+e.id+"] input:checkbox").on("change",m),$("#kid-attendance-table-container").animate({scrollTop:$("#kid-attendance-table-container")[0].scrollHeight},st)}function d(){var e=new Date,t=e.getDate()-e.getDay(),a=new Date(e.setDate(t));I.value=T(a),D=I.value,N=a,Z.innerHTML=I.value}function i(){lt||confirm("If you change the date you will lose any unsaved changes. Continue?")?(N=new Date(I.value),D=I.value,r()):I.value=T(N),Z.innerHTML=I.value}function l(e){var t="#"+(-1==e.target.id.indexOf("adult")?"kid":"adult")+"-attendance-table-container",a=$(t),n=-1==e.target.id.indexOf("top")?a[0].scrollHeight:0;a.stop().animate({scrollTop:n},st,"swing",function(){$("<style></style>").appendTo($(document.body)).remove()})}function s(e){j(),M(),$(".attendance-table-attendance-col input:checkbox").off("change"),tt=0,at=0,nt=0,rt=0,ot=0,ct=0,et=e;for(var t=D,a="",n="",r=0;r<et.length;r++)et[r].active==B.checked&&(et[r].adult?a+=u(et[r],t):n+=u(et[r],t));y(tt,at,nt,rt,ot,ct),$("#adult-attendance-table > tbody:last").append(a),$("#kid-attendance-table > tbody:last").append(n),$(".attendance-table-attendance-col input:checkbox").on("change",m),q()}function u(e,t){H(e.id,e.last_name,e.adult);var a,n="",r="",o="",c=x(),d=x();return-1!=(a=E(e,t))&&(n=e.attendance[a].first?"checked":"",r=e.attendance[a].second?"checked":""),o=w(e),o='<a class="person_name" href="manage-person.html?id='+e.id+'">'+o+"</a>",e.adult?(n&&++at,r&&++nt,(n||r)&&++tt):(n&&++ot,r&&++ct,(n||r)&&++rt),'<tr adult="'+e.adult+'" personId="'+e.id+'"><td data-th="Name"><button class="attendance-history-button"><i class="fa fa-archive" /></button>'+o+'</td><td class="attendance-table-attendance-col" service="first" data-th="First?"><label for="'+c+'"><input id="'+c+'" type="checkbox" '+n+'/></label></td><td class="attendance-table-attendance-col" service="second" data-th="Second?"><label for="'+d+'"><input id="'+d+'" type="checkbox" '+r+"/></label></td></tr>"}function p(e){var t=x(),a=x();return'<tr adult="'+e.adult+'" personId="'+e.id+'" modified="true"><td data-th="Name"><input name="name_description" type="text" placeholder="Last, First or Description" /></td><td class="attendance-table-attendance-col" service="first" data-th="First?"><label for="'+t+'"><input id="'+t+'" type="checkbox" /></label></td><td class="attendance-table-attendance-col" service="second" data-th="Second?"><label for="'+a+'"><input id="'+a+'" type="checkbox" /></label></td></tr>'}function f(e){if(lt=!0,e&&0!==e.length){var t,a,n,r,o,c,d=[],i=0,l=0;for($("[personid^=-]").remove(),t=0;t<e.length;t++)et.push(e[t]),d.push(u(e[t],D));for(t=0;t<e.length;t++){for(r=e[t],o=!1,a=0;a<et.length;a++)if(n=et[a],n.adult===!0?i=a:l=a,n.adult===r.adult&&-1===k(r,n)){$(d[t]).insertBefore("[personid="+n.id+"]"),et.splice(a,0,r),o=!0;break}o===!1&&(r.adult===!0?($("#adult-attendance-table > tbody:last").append(d[t]),et.splice(i+1,0,r)):($("#kid-attendance-table > tbody:last").append(d[t]),et.splice(l+1,0,r))),c=$("[personid="+r.id+"]"),c.find("a.person_name").on("click",C),c.find("button.attendance-history-button").on("click",O),c.find("input:checkbox").on("change",m)}}}function m(e){var t=e.target,a=t.parentElement.parentElement.parentElement.getAttribute("personId"),n=t.parentElement.parentElement.parentElement.getAttribute("adult");lt=!1,t.parentElement.parentElement.parentElement.setAttribute("modified",!0),"true"==n?("first"===t.parentElement.parentElement.getAttribute("service")?(t.checked?(++at,S(a)||++tt):(--at,S(a)||--tt),J.innerHTML=at):"second"===t.parentElement.parentElement.getAttribute("service")&&(t.checked?(++nt,_(a)||++tt):(--nt,_(a)||--tt),U.innerHTML=nt),P.innerHTML=tt):("first"===t.parentElement.parentElement.getAttribute("service")?(t.checked?(++ot,S(a)||++rt):(--ot,S(a)||--rt),G.innerHTML=ot):"second"===t.parentElement.parentElement.getAttribute("service")&&(t.checked?(++ct,_(a)||++rt):(--ct,_(a)||--rt),Y.innerHTML=ct),z.innerHTML=rt)}function v(e){var t=A(e);if(t){$("#person-attendance-history-table > tbody:last").children().remove(),ut.dialog("open"),ut[0].querySelector("#person-name").innerHTML=w(t,!1);for(var a="",n=0;n<t.attendance.length;n++)a+=h(t.attendance[n]);$("#person-attendance-history-table > tbody:last").append(a)}}function h(e){var t=e.first?"checked":"",a=e.second?"checked":"";return'<tr><td data-th="Date">'+e.date+'</td><td class="attendance-table-attendance-col" service="first" data-th="First?"><input type="checkbox" '+t+' disabled/></td><td class="attendance-table-attendance-col" service="second" data-th="Second?"><input type="checkbox" '+a+" disabled/></td></tr>"}function y(e,t,a,n,r,o){tt=e,at=t,nt=a,P.innerHTML=e,J.innerHTML=t,U.innerHTML=a,rt=n,ot=r,ct=o,z.innerHTML=n,G.innerHTML=r,Y.innerHTML=o}function g(){$(".attendance-form").mask("Loading..."),$.ajax({type:"GET",url:"ajax/get_attendance.php"}).done(function(e){$(".attendance-form").unmask();var t=JSON.parse(e);if(t.success){if(s(t.people),t.scroll_to_id&&t.scroll_to_id>=0){var a=$("[personid="+t.scroll_to_id+"]")[0];if(a){var n="true"==a.getAttribute("adult")?"adult":"kid",r="#"+n+"-attendance-table-container",o=$(r).offset().top,c=a.offsetTop;$("body").animate({scrollTop:o},300),$(r).animate({scrollTop:c},st)}}}else 1===t.error?logout():$().toastmessage("showErrorToast","Error loading")}).fail(function(){$(".attendance-form").unmask(),$().toastmessage("showErrorToast","Error loading")})}function b(e){$.ajax({type:"POST",url:"ajax/save_people.php",data:{people:JSON.stringify(e)}}).done(function(e){$(".attendance-form").unmask();var t=JSON.parse(e);t.success?(f(t.people),$().toastmessage("showSuccessToast","Save successful")):1===t.error?logout():$().toastmessage("showErrorToast","Error saving")})}function _(e){return $("[personId="+e+"] input:checkbox:first")[0].checked}function S(e){return $("[personId="+e+"] input:checkbox:last")[0].checked}function k(e,t){if(e==t)return 0;if(null===e)return-1;if(null===t)return 1;var a=w(e,!0),n=w(t,!0);if(e.first_name||e.last_name){if(!t.first_name&&!t.last_name)return-1;if(a===n)return 0;if(a.toLowerCase()<n.toLowerCase())return-1;if(a.toLowerCase()>n.toLowerCase())return 1}else{if(t.first_name||t.last_name)return 1;if(a===n)return 0;if(a.toLowerCase()<n.toLowerCase())return-1;if(a.toLowerCase()>n.toLowerCase())return 1}}function w(e,t){if(null===e)return"";var a="";return e.first_name||e.last_name?(e.last_name&&(a+=e.last_name),e.last_name&&e.first_name?t===!0?a+=", "+e.first_name:a=e.first_name+" "+a:e.first_name&&(a+=e.first_name+" ")):a=e.description,a}function E(e,t){for(var a=0;a<e.attendance.length;a++)if(e.attendance[a].date===t)return a;return-1}function T(e){var t=e.getDate(),a=e.getMonth(),n=e.getFullYear();return t=10>t?"0"+t:""+t,a++,a=10>a?"0"+a:""+a,a+"/"+t+"/"+n}function A(e){for(var t=0;t<et.length;t++)if(et[t].id===e)return et[t];return null}function x(){return"id-"+ ++dt}function L(){return--it}function q(){$("#attendance-nav").on("click",C),$("#reports-nav").on("click",C),$("a.person_name").on("click",C),$("button.attendance-history-button").on("click",O)}function M(){$("#attendance-nav").off("click",C),$("#reports-nav").off("click",C),$("a.person_name").off("click",C),$("button.attendance-history-button").off("click",O)}function O(){var e=this.parentElement.parentElement.getAttribute("personId");v(e)}function j(){document.querySelector("#adult-jump-to").innerHTML="<option>--Jump To Letter--</option>",document.querySelector("#kid-jump-to").innerHTML="<option>--Jump To Letter--</option>"}function H(e,t,a){if(t){var n="#"+(a?"adult":"kid")+"-jump-to",r=t.substr(0,1).toUpperCase();if(!($(n+' option:contains("'+r+'")').length>0)){var o=document.querySelector(n),c=document.createElement("option");c.setAttribute("scroll_to_id",e),c.innerHTML=r,o.appendChild(c)}}}function F(e){var t=e.target.options[e.target.options.selectedIndex];if(t){var a=$("[personid="+t.getAttribute("scroll_to_id")+"]")[0];if(a){var n="#"+(-1==e.target.id.indexOf("adult")?"kid":"adult")+"-attendance-table-container",r=$(n).offset().top,o=a.offsetTop;$("body").animate({scrollTop:r},300),$(n).animate({scrollTop:o},st)}}}function C(e){lt||confirm("If you continue you will lose any unsaved changes. Continue?")||e.preventDefault()}if(0!==$("#attendance").length){$("#attendance-date").datepicker();var N,D,I=document.querySelector("#attendance-date"),P=document.querySelector("#adult-total-attendance"),J=document.querySelector("#adult-first-service-attendance"),U=document.querySelector("#adult-second-service-attendance"),z=document.querySelector("#kid-total-attendance"),G=document.querySelector("#kid-first-service-attendance"),Y=document.querySelector("#kid-second-service-attendance"),B=document.querySelector("#active-true"),R=(document.querySelector("#active-false"),document.querySelector("#update")),V=document.querySelector("#cancel"),W=document.querySelector("#export"),K=document.querySelector("#go-arrow"),Q=document.querySelector("#add-adult"),X=document.querySelector("#add-kid"),Z=document.querySelector("#attendance-date-display"),et=[],tt=0,at=0,nt=0,rt=0,ot=0,ct=0,dt=0,it=-1,lt=!0,st=1e3,ut=$(".dialog-form").dialog({autoOpen:!1,height:400,width:450,modal:!0});d(),R.addEventListener("click",t),V.addEventListener("click",n),W.addEventListener("click",e),K.addEventListener("click",i),Q.addEventListener("click",o),X.addEventListener("click",c),$(".jump-to").on("change",F),$(".navigation-links a").on("click",l),checkLoginStatus(g)}}(),function(){"use strict";function e(){var e=r.value,n=o.value;t(e,n)&&a(e,$.md5(n))}function t(e,t){var a="";return $.trim(e)||(a+="Username cannot be blank<br />"),t||(a+="Password cannot be blank<br />"),a?($().toastmessage("showErrorToast",a),!1):!0}function a(e,t){$.ajax({type:"POST",url:"ajax/login.php",data:{username:e,password:t}}).done(function(e){var t=JSON.parse(e);t.success?window.location="attendance.html":$().toastmessage("showErrorToast","Username or password is incorrect")})}var n=document.querySelector("#login-btn"),r=document.querySelector("#username"),o=document.querySelector("#password");n&&(n.addEventListener("click",e),$(document).keypress(function(t){13==t.which&&e()}))}(),function(){"use strict";function e(){n.classList.remove("open"),a.classList.remove("open")}function t(){n.classList.toggle("open"),a.classList.toggle("open")}if(0!==$(".menu").length){var a=document.querySelector(".navdrawer-container"),n=document.querySelector(".app-bar"),r=document.querySelector(".menu"),o=document.querySelector("main");o.addEventListener("touchstart",e),o.addEventListener("click",e),r.addEventListener("click",t),a.addEventListener("click",function(t){("A"===t.target.nodeName||"LI"===t.target.nodeName)&&e()})}}(),function(){"use strict";function e(e){var t=$("#state");$.each(e,function(e,a){t.append("<option value="+a.abbreviation+">"+a.name+"</option>")}),t.val("OH")}function t(){var e=$("#follow-up-type");$.each(_t,function(t,a){e.append("<option value="+t+">"+a+"</option>")}),e.val("2")}function a(e){I.value=e.first_name,P.value=e.last_name,J.value=e.description,U.checked=e.adult,z.checked=e.active,G.checked=e.baptized,Y.checked=e.saved,B.checked=e.member,R.checked=e.visitor,V.value=e.street1,W.value=e.street2,K.value=e.city,Q.value=e.zip,e.state&&(et.value=e.state),X.value=e.primary_phone,Z.value=e.secondary_phone,n(e),y(e.follow_ups)}function n(e){var t=M(e);gt.innerHTML="OH"===t||""===t?"":'<a href="'+$t+t+'" target="_blank"><img border="0" src="'+bt+t+'" /></a>'}function r(){var e={id:N.id,first_name:$.trim(I.value),last_name:$.trim(P.value),description:$.trim(J.value),adult:U.checked,active:z.checked,baptized:G.checked,saved:Y.checked,member:B.checked,visitor:R.checked,street1:$.trim(V.value),street2:$.trim(W.value),city:$.trim(K.value),zip:$.trim(Q.value),state:$.trim(et.value),email:$.trim(email.value),primary_phone:$.trim(X.value),secondary_phone:$.trim(Z.value)};o(e)&&u(e)}function o(e){var t="",a=!!e.first_name,n=!!e.last_name,r=!!e.description;return!a&&n?t+="First Name cannot be blank if Last Name is specified<br />":a&&!n?t+="Last Name cannot be blank if First Name is specified<br />":a||n||r||(t+="Must specify either First and Last Name or Description<br />"),t?($().toastmessage("showErrorToast",t),!1):!0}function c(){confirm("Deleting someone also deletes their attendance history. Continue?")&&p()}function d(){a(N),yt=!0}function i(){$.ajax({type:"GET",url:"ajax/states.json"}).done(function(a){if($.isArray(a))e(a);else{var n=JSON.parse(a);e(n)}t(),s(),l()}).fail(function(){$().toastmessage("showErrorToast","Error loading states")})}function l(){$.ajax({type:"GET",url:"ajax/get_visitors.php"}).done(function(e){var t=JSON.parse(e);t.success?D=t.people:1===t.error?logout():$().toastmessage("showErrorToast","Error loading visitors")}).fail(function(){$().toastmessage("showErrorToast","Error loading visitors")})}function s(){$.ajax({type:"GET",url:"ajax/get_person.php",data:{id:C.id}}).done(function(e){var t=JSON.parse(e);t.success?(N=t.person,a(t.person)):1===t.error?logout():$().toastmessage("showErrorToast","Error loading")}).fail(function(){$().toastmessage("showErrorToast","Error loading person")})}function u(e){$.ajax({type:"POST",url:"ajax/save_person.php",data:{person:JSON.stringify(e)}}).done(function(t){var a=JSON.parse(t);a.success?(n(e),$().toastmessage("showSuccessToast","Save successful")):1===a.error?logout():$().toastmessage("showErrorToast","Error saving person")}).fail(function(){$().toastmessage("showErrorToast","Error saving person")})}function p(){$.ajax({type:"POST",url:"ajax/delete_person.php",data:{id:N.id}}).done(function(e){var t=JSON.parse(e);t.success?window.location="attendance.html":1===t.error?logout():$().toastmessage("showErrorToast","Error deleting person")}).fail(function(){$().toastmessage("showErrorToast","Error deleting person")})}function f(e){$.ajax({type:"POST",url:"ajax/delete_follow_up.php",data:{id:e}}).done(function(t){var a=JSON.parse(t);a.success?$("#follow-up-table tr[follow_up_id="+e+"]").remove():1===a.error?logout():$().toastmessage("showErrorToast","Error deleting Follow Up")}).fail(function(){$().toastmessage("showErrorToast","Error deleting Follow Up")})}function m(e,t){if(null===e)return"";var a="";return e.first_name||e.last_name?(e.last_name&&(a+=e.last_name),e.last_name&&e.first_name?t===!0?a+=", "+e.first_name:a=e.first_name+" "+a:e.first_name&&(a+=e.first_name+" ")):a=e.description,a}function v(){ut.value="2",pt.value="",mt.value="";for(var e=ft.querySelectorAll("input"),t=0;t<e.length;t++)e[t].checked=!1}function h(){var e=$.trim(pt.value),t=$.trim(ut.value),a=$.trim(mt.value),n=[],r=[];if(""===e&&""===a)return $().toastmessage("showErrorToast","Must specify either Date or Comments"),!1;if(a.length>5e3)return $().toastmessage("showErrorToast","Comments cannot exceed 5000 characters"),!1;for(var o=ft.querySelectorAll("input"),c=0;c<o.length;c++)o[c].checked&&(n.push($.trim(o[c].previousSibling.innerHTML)),r.push(o[c].getAttribute("personid")));return{id:-1===vt.text().indexOf("Edit")?F():st.value,date:e,typeCd:t,type:ut.selectedOptions[0].text,comments:a,visitors:n,visitorsIds:r}}function y(e){H(),$("#follow-up-table tbody tr").remove();for(var t=0;t<e.length;t++)g(e[t]);j()}function g(e){!e.type&&e.typeCd&&(e.type=_t[e.typeCd]||""),$("#follow-up-table > tbody:last").append('<tr follow_up_id="'+e.id+'"><td typeCd="'+e.typeCd+'">'+e.type+'</td><td class="follow-up-table-date-col">'+e.date+'</td><td visitorsIds="'+e.visitorsIds.join(",")+'">'+e.visitors.join(", ")+'</td><td class="follow-up-table-comments-col">'+e.comments+'</td><td class="follow-up-table-button-col"><button class="edit-follow-up"><i class="fa fa-edit"></i></button><button class="delete-follow-up"><i class="fa fa-minus-circle"></i></button></td></tr>')}function b(e){var t=$("#follow-up-table tr[follow_up_id="+e.id+"]").children();t[0].setAttribute("typeCd",e.typeCd),t[0].innerHTML=e.type,t[1].innerHTML=e.date,t[2].innerHTML=e.visitors.join(", "),t[2].setAttribute("visitorsIds",e.visitorsIds.join(",")),t[3].innerHTML=e.comments}function _(){if(""===ft.innerHTML.trim())for(var e,t=0;t<D.length;t++)e=D[t],ft.innerHTML+='<div class="check-field"><label for="follow-up-by-'+e.id+'">'+m(e)+'</label><input type="checkbox" personid="'+e.id+'" id="follow-up-by-'+e.id+'"/></div>'}function S(){lt.dialog("open"),v(),_(),vt.text("Add Follow Up")}function k(){lt.dialog("close")}function w(){var e=h();return e===!1?!1:(g(e),$("button.edit-follow-up:last").on("click",L),$("button.delete-follow-up:last").on("click",q),yt=!1,e)}function E(){var e=h();return e===!1?!1:(b(e),yt=!1,e)}function T(){-1===vt.text().indexOf("Edit")?w():E()}function A(){var e;e=-1===vt.text().indexOf("Edit")?w():E(),e&&v()}function x(){var e;e=-1===vt.text().indexOf("Edit")?w():E(),e&&lt.dialog("close")}function L(e){lt.dialog("open"),_();var t=e.currentTarget.parentElement.parentElement;ut.value=t.children[0].getAttribute("typeCd")||"",pt.value=t.children[1].innerHTML||"",mt.value=t.children[3].innerHTML||"",st.value=t.getAttribute("follow_up_id");for(var a=t.children[2].getAttribute("visitorsIds")||"",n=a.split(","),r=ft.querySelectorAll("input"),o=0;o<r.length;o++)r[o].checked=n.indexOf(r[o].getAttribute("personid"))>=0;vt.text("Edit Follow Up")}function q(e){if(confirm("Are you sure you would like to delete this Follow Up?")){var t=e.currentTarget.parentElement.parentElement.getAttribute("follow_up_id");f(t)}}function M(e){var t="";return t+=e.street1||"",t+=" ",t+=e.street2||"",t+=" ",t+=e.city||"",t+=" ",t+=e.state||"",t+=" ",t+=e.zip||"",t.trim()}function O(e){yt||confirm("If you continue you will lose any unsaved changes. Continue?")||e.preventDefault()}function j(){$("#attendance-nav").on("click",O),$("#reports-nav").on("click",O),$("button.edit-follow-up").on("click",L),$("button.delete-follow-up").on("click",q)}function H(){$("#attendance-nav").off("click",O),$("#reports-nav").off("click",O),$("button.edit-follow-up").off("click",L),$("button.delete-follow-up").off("click",q)}function F(){return--ht}if(0!==$("#manage-person").length){$("#follow-up-date").datepicker();var C={},N={},D=[],I=document.querySelector("#first-name"),P=document.querySelector("#last-name"),J=document.querySelector("#description"),U=document.querySelector("#adult"),z=document.querySelector("#active"),G=document.querySelector("#baptized"),Y=document.querySelector("#saved"),B=document.querySelector("#member"),R=document.querySelector("#visitor"),V=document.querySelector("#street1"),W=document.querySelector("#street2"),K=document.querySelector("#city"),Q=document.querySelector("#zip"),X=document.querySelector("#primary-phone"),Z=document.querySelector("#secondary-phone"),et=document.querySelector("#state"),tt=document.querySelector("#update"),at=document.querySelector("#cancel"),nt=document.querySelector("#delete"),rt=document.querySelector("#add-follow-up"),ot=(document.querySelector("#edit-follow-up"),document.querySelector("#d-follow-up"),document.querySelector("#add-clear")),ct=document.querySelector("#add-copy"),dt=document.querySelector("#add-close"),it=document.querySelector("#close"),lt=$(".dialog-form").dialog({autoOpen:!1,height:400,width:510,modal:!0}),st=lt[0].querySelector("#follow-up-id"),ut=lt[0].querySelector("#follow-up-type"),pt=lt[0].querySelector("#follow-up-date"),ft=lt[0].querySelector("#follow-up-visitors"),mt=lt[0].querySelector("#follow-up-comments"),vt=$(".ui-dialog-title").text("Edit Follow Up"),ht=-1,yt=!0,gt=document.querySelector("#map-panel"),bt="//maps.googleapis.com/maps/api/staticmap?zoom=11&size=400x400&markers=color:red%7Clabel:A|",$t="https://www.google.com/maps/place/",_t={1:"Phone Call",2:"Visit",3:"Communication Card",4:"Entered in The City"};(window.onpopstate=function(){var e,t=/\+/g,a=/([^&=]+)=?([^&]*)/g,n=function(e){return decodeURIComponent(e.replace(t," "))},r=window.location.search.substring(1);for(C={};null!==(e=a.exec(r));)C[n(e[1])]=n(e[2])}).call(),C.id||(window.location="attendance.html"),tt.addEventListener("click",r),at.addEventListener("click",d),nt.addEventListener("click",c),rt.addEventListener("click",S),ct.addEventListener("click",T),ot.addEventListener("click",A),dt.addEventListener("click",x),it.addEventListener("click",k),checkLoginStatus(i)}}(),function(){"use strict";function e(e,t){g.innerHTML=e?e:"N/A",b.innerHTML=t?t:"N/A";var a=new Date;y.value=$.datepicker.formatDate("mm/dd/yy",new Date(a.getFullYear(),a.getMonth(),1,0,0,0,0)),h.value=$.datepicker.formatDate("mm/dd/yy",a)}function t(){var e=parseInt(_.value);3===e?($("#report-type-container")[0].style.setProperty("display","inline-block"),$("#from-to-dates")[0].style.setProperty("display","none")):($("#report-type-container")[0].style.setProperty("display","block"),$("#from-to-dates")[0].style.setProperty("display","inline-block"))}function a(){if(r(y.value,h.value)){var e=parseInt(_.value);switch(n(),e){case 1:$("#attendance-by-date-container")[0].style.setProperty("display","inherit");break;case 2:$("#attendance-by-person-container")[0].style.setProperty("display","inherit");break;case 3:$("#attendance-by-mia-container")[0].style.setProperty("display","inherit")}f(e,y.value,h.value)}}function n(){$("#attendance-by-person-container")[0].style.setProperty("display","none"),$("#attendance-by-date-container")[0].style.setProperty("display","none"),$("#attendance-by-mia-container")[0].style.setProperty("display","none")}function r(e,t){var a="";return v(e)||(a+="From Date must be a valid date<br />"),v(t)||(a+="To Date must be a valid date<br />"),a?($().toastmessage("showErrorToast",a),!1):!0}function o(e,t){$("#attendance-date-table > tbody:last").empty(),$("#attendance-date-aggregates-table > tbody:last").empty();for(var a="",n=0;n<e.length;n++)a+=c(e[n]);$("#attendance-date-table > tbody:last").append(a),$("#attendance-date-aggregates-table > tbody:last").append(d(t))}function c(e){return'<tr><td data-th="Date">'+e.Attendance_dt+'</td><td class="report-attendance-table-attendance-col" data-th="Total">'+e.Total_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="First">'+e.First_Service_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Second">'+e.Second_Service_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="First Adult">'+e.First_Service_Adult_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Second Adult">'+e.Second_Service_Adult_Attendance+"</td></tr>"}function d(e){var t="",a=e[0];return t+='<tr><td data-th="Aggregate">Average</td><td class="report-attendance-table-attendance-col" data-th="Average Total">'+a.Avg_Total_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Average First">'+a.Avg_First_Service_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Average Second">'+a.Avg_Second_Service_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Average First Adult">'+a.Avg_First_Service_Adult_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Average Second Adult">'+a.Avg_Second_Service_Adult_Attendance+"</td></tr>",t+='<tr><td data-th="Aggregate">Max</td><td class="report-attendance-table-attendance-col" data-th="Max Total">'+a.Max_Total_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Max First">'+a.Max_First_Service_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Max Second">'+a.Max_Second_Service_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Max First Adult">'+a.Max_First_Service_Adult_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Max Second Adult">'+a.Max_Second_Service_Adult_Attendance+"</td></tr>",t+='<tr><td data-th="Aggregate">Min</td><td class="report-attendance-table-attendance-col" data-th="Min Total">'+a.Min_Total_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Min First">'+a.Min_First_Service_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Min Second">'+a.Min_Second_Service_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Min First Adult">'+a.Min_First_Service_Adult_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Min Second Adult">'+a.Min_Second_Service_Adult_Attendance+"</td></tr>"}function i(e){$("#adult-attendance-table > tbody:last").empty();for(var t="",a=0;a<e.length;a++)"true"==e[a].adult&&(t+=u(e[a]));$("#adult-attendance-table > tbody:last").append(t)}function l(e){$("#mia-attendance-table > tbody:last").empty();for(var t="",a=0;a<e.length;a++)"true"==e[a].adult&&(t+=s(e[a]));$("#mia-attendance-table > tbody:last").append(t)}function s(e){var t="";return e.first_name||e.last_name?(e.first_name&&(t+=e.first_name+" "),e.last_name&&(t+=e.last_name)):t=e.description,t='<a class="person_name" href="manage-person.html?id='+e.id+'">'+t+"</a>",'<tr adult="'+e.adult+'" personId="'+e.id+'"><td data-th="Name">'+t+"</td></tr>"}function u(e){var t="";return e.first_name||e.last_name?(e.first_name&&(t+=e.first_name+" "),e.last_name&&(t+=e.last_name)):t=e.description,t='<a class="person_name" href="manage-person.html?id='+e.id+'">'+t+"</a>",'<tr adult="'+e.adult+'" personId="'+e.id+'"><td data-th="Name">'+t+'</td><td class="report-attendance-table-attendance-col" data-th="First">'+e.First_Service_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Second">'+e.Second_Service_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Total">'+e.Total_Attendance+"</td></tr>"}function p(e){var t="#"+e.target.parentElement.previousElementSibling.id,a=-1==e.target.id.indexOf("top")?$(t)[0].scrollHeight:0;$(t).animate({scrollTop:a},k,"swing",function(){$("<style></style>").appendTo($(document.body)).remove()})}function f(e,t,a){$(".reports-form").mask("Loading..."),$.ajax({type:"GET",url:"ajax/get_report.php",data:{type:e,fromDate:t,toDate:a}}).done(function(t){$(".reports-form").unmask();var a=JSON.parse(t);if(a.success)switch(e){case 1:o(a.totals,a.aggregates);break;case 2:i(a.people);break;case 3:l(a.people)}else 1===a.error?logout():$().toastmessage("showErrorToast","Error loading report")}).fail(function(){$(".reports-form").unmask(),$().toastmessage("showErrorToast","Error loading report")})}function m(){$(".reports-form").mask("Loading..."),$.ajax({type:"GET",url:"ajax/get_first_last_service_dates.php"}).done(function(t){$(".reports-form").unmask();var a=JSON.parse(t);a.success?e(a.first_dt,a.last_dt):1===a.error?logout():$().toastmessage("showErrorToast","Error loading data")}).fail(function(){$(".reports-form").unmask(),$().toastmessage("showErrorToast","Error loading data")})}function v(e){var t=e;if(""===t)return!1;var a=/^(\d{1,2})(\/|-)(\d{1,2})(\/|-)(\d{4})$/,n=t.match(a);if(null===n)return!1;var r=n[1],o=n[3],c=n[5];if(1>r||r>12)return!1;if(1>o||o>31)return!1;if((4==r||6==r||9==r||11==r)&&31==o)return!1;if(2==r){var d=c%4===0&&(c%100!==0||c%400===0);if(o>29||29==o&&!d)return!1}return!0}if(0!==$("#reports").length){$("#from-date").datepicker(),$("#to-date").datepicker();var h=document.querySelector("#to-date"),y=document.querySelector("#from-date"),g=document.querySelector("#first-date"),b=document.querySelector("#last-date"),_=document.querySelector("#report-type"),S=document.querySelector("#go-arrow"),k=300;S.addEventListener("click",a),_.addEventListener("change",t),$(".top-bottom-links a").on("click",p),checkLoginStatus(m)}}();