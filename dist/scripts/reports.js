!function(){"use strict";function e(){var e=$("#service-label-1"),t=$("#service-label-2");$.each(J.service_labels,function(a,n){e.append('<option value="'+a+'">'+n+"</option>"),t.append('<option value="'+a+'">'+n+"</option>")}),t.append('<option value="">--None--</option>'),e.val(J.default_first_service_label),t.val(J.default_second_service_label),e=$("#campus"),$.each(J.campuses,function(t,a){e.append('<option value="'+t+'">'+a+"</option>")}),e.val(J.default_campus)}function t(e,t){D.innerHTML=e?e:"N/A",M.innerHTML=t?t:"N/A";var a=new Date;x.value=$.datepicker.formatDate("mm/dd/yy",new Date(a.getFullYear(),a.getMonth(),1,0,0,0,0)),E.value=$.datepicker.formatDate("mm/dd/yy",a)}function a(){var e=parseInt(P.value);$("#from-to-dates")[0].style.setProperty("display",3===e||5===e?"none":""),$(".service-label-container").css("display",3===e||4===e||5===e?"none":""),(3===e||4===e||5===e)&&(x.value="",E.value=""),$("#first-last-dates")[0].style.setProperty("display",4===e?"none":"inherit"),$("#communication-card-header")[0].style.setProperty("display",4===e?"inherit":"none"),$("#follow-up-options")[0].style.setProperty("display",4===e?"inline-block":"none"),$("#follow-up-options-spacer")[0].style.setProperty("display",4===e?"inherit":"none")}function n(){var e=parseInt(P.value);if((1===e||2===e)&&F.value==N.value)return $().toastmessage("showErrorToast","First and Second Service cannot be the same"),void 0;if(o(x.value,E.value,1===e||2===e)){switch(s(),z=q.value,C=F.value,H="",e){case 1:$("#attendance-by-date-container")[0].style.setProperty("display","inherit"),I={fromDate:x.value,toDate:E.value,campus:q.value,label1:F.value,label2:N.value},H=N.value,H?($(".service-header").css("display",""),$(".first-service-header").text(J.service_labels[C]),$(".second-service-header").text(J.service_labels[H])):$(".service-header").css("display","none");break;case 2:$("#attendance-by-person-container")[0].style.setProperty("display","inherit"),I={fromDate:x.value,toDate:E.value,campus:q.value,label1:F.value,label2:N.value},H=N.value,H?($(".service-header").css("display",""),$(".first-service-header").text(J.service_labels[C]),$(".second-service-header").text(J.service_labels[H])):$(".service-header").css("display","none");break;case 3:$("#attendance-by-mia-container")[0].style.setProperty("display","inherit"),I={fromDate:"",toDate:"",campus:q.value};break;case 4:$("#follow-up-container")[0].style.setProperty("display","inherit"),I=r(),I.campus=q.value;break;case 5:$("#people-by-attender-status-container")[0].style.setProperty("display","inherit"),I={fromDate:"",toDate:"",campus:q.value}}g(e,I)}}function r(){return{fromDate:x.value,toDate:E.value,active:$("#active").is(":checked"),not_visited:$("#not-visited").is(":checked"),ty_card_not_sent:$("#ty-card-not-sent").is(":checked"),signed_up_for_baptism:$("#signed-up-for-baptism").is(":checked"),baptized:$("#baptized").is(":checked"),interested_in_gkids:$("#interested-in-gkids").is(":checked"),interested_in_next:$("#interested-in-next").is(":checked"),interested_in_ggroups:$("#interested-in-ggroups").is(":checked"),interested_in_gteams:$("#interested-in-gteams").is(":checked"),interested_in_joining:$("#interested-in-joining").is(":checked"),would_like_visit:$("#would-like-visit").is(":checked"),no_agent:$("#no-agent").is(":checked"),commitment_christ:$("#commitment-christ").is(":checked"),recommitment_christ:$("#recommitment-christ").is(":checked"),commitment_tithe:$("#commitment-tithe").is(":checked"),commitment_ministry:$("#commitment-ministry").is(":checked"),attendance_frequency:$("#first-time-visitor").is(":checked")}}function s(){$("#attendance-by-person-container")[0].style.setProperty("display","none"),$("#attendance-by-date-container")[0].style.setProperty("display","none"),$("#attendance-by-mia-container")[0].style.setProperty("display","none"),$("#follow-up-container")[0].style.setProperty("display","none"),$("#people-by-attender-status-container")[0].style.setProperty("display","none")}function o(e,t,a){var n="";return S(e,!0)||(n+="From Date must be a valid date<br />"),S(t,!0)||(n+="To Date must be a valid date<br />"),n?($().toastmessage("showErrorToast",n),!1):!a||e||t?!0:($().toastmessage("showErrorToast","From Date or To Date must be specified"),!1)}function d(e,t){$("#attendance-date-table > tbody:last").empty(),$("#attendance-date-aggregates-table > tbody:last").empty();for(var a="",n=0;n<e.length;n++)a+=c(e[n]);$("#attendance-date-table > tbody:last").append(a),$("#attendance-date-aggregates-table > tbody:last").append(i(t))}function c(e){return R=""===H?"":'<td class="report-attendance-table-attendance-col" data-th="First">'+e.First_Service_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Second">'+e.Second_Service_Attendance+"</td>",'<tr><td data-th="Date">'+e.Attendance_dt+'</td><td class="report-attendance-table-attendance-col" data-th="Total">'+e.Total_Attendance+"</td>"+R+"</tr>"}function i(e){var t="";return R=""===H?"":'<td class="report-attendance-table-attendance-col" data-th="Average First">'+e.Avg_First_Service_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Average Second">'+e.Avg_Second_Service_Attendance+"</td>",t+='<tr><td data-th="Aggregate">Average</td><td class="report-attendance-table-attendance-col" data-th="Average Total">'+e.Avg_Total_Attendance+"</td>"+R+"</tr>",R=""===H?"":'<td class="report-attendance-table-attendance-col" data-th="Max First">'+e.Max_First_Service_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Max Second">'+e.Max_Second_Service_Attendance+"</td>",t+='<tr><td data-th="Aggregate">Max</td><td class="report-attendance-table-attendance-col" data-th="Max Total">'+e.Max_Total_Attendance+"</td>"+R+"</tr>",R=""===H?"":'<td class="report-attendance-table-attendance-col" data-th="Min First">'+e.Min_First_Service_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Min Second">'+e.Min_Second_Service_Attendance+"</td>",t+='<tr><td data-th="Aggregate">Min</td><td class="report-attendance-table-attendance-col" data-th="Min Total">'+e.Min_Total_Attendance+"</td>"+R+"</tr>"}function l(e){$("#adult-attendance-table > tbody:last").empty();for(var t="",a=0;a<e.length;a++)t+=y(e[a]);$("#adult-attendance-table > tbody:last").append(t)}function u(e){$("#mia-attendance-table > tbody:last").empty();for(var t="",a=0;a<e.length;a++)t+=v(e[a]);$("#mia-attendance-table > tbody:last").append(t)}function p(e){$("#follow-up-table > tbody:last").empty();for(var t="",a=0;a<e.length;a++)t+=f(e[a]);$("#follow-up-table > tbody:last").append(t)}function m(e){if($("#people-by-attender-status-table > tbody:last").empty(),0!==e.length){for(var t="",a="",n=0;n<e.length;n++)"true"==e[n].adult&&(e[n].attender_status!=a&&(t+=h(V[e[n].attender_status]),a=e[n].attender_status),t+=v(e[n]));$("#people-by-attender-status-table > tbody:last").append(t)}}function h(e){return'<tr class="row-header"><td>'+e+"</td></tr>"}function v(e){var t="";return e.first_name||e.last_name?(e.first_name&&(t+=e.first_name+" "),e.last_name&&(t+=e.last_name)):t=e.description,t='<a class="person_name" href="manage-person.html?id='+e.id+'">'+t+"</a>",'<tr adult="'+e.adult+'" personId="'+e.id+'"><td data-th="Name">'+t+"</td></tr>"}function y(e){return R=""===H?"":'<td class="report-attendance-table-attendance-col" data-th="First">'+e.First_Service_Attendance+'</td><td class="report-attendance-table-attendance-col" data-th="Second">'+e.Second_Service_Attendance+"</td>",'<tr personId="'+e.id+'"><td data-th="Name"><a class="person_name" href="manage-person.html?id='+e.id+'">'+e.display+"</a></td>"+R+'<td class="report-attendance-table-attendance-col" data-th="Total">'+e.Total_Attendance+"</td></tr>"}function f(e){var t="",a=e.primary_phone||"";return e.first_name||e.last_name?(e.first_name&&(t+=e.first_name+" "),e.last_name&&(t+=e.last_name)):t=e.description,t='<a class="person_name" href="manage-person.html?id='+e.id+'">'+t+"</a>",a=T(a),'<tr personId="'+e.id+'"><td data-th="Name">'+t+'</td><td class="checkbox-table-col" data-th="Visited?"><input type="checkbox" disabled '+("true"===e.visited?"checked ":"")+'/></td><td class="checkbox-table-col" data-th="Phone Number">'+a+'</td><td data-th="Thank You<br />Card Sent">'+(e.ty_card_date||"")+'</td><td data-th="Communication Card<br />Received">'+(e.communication_card_date||"")+"</td></tr>"}function _(e){var t="#"+e.target.parentElement.parentElement.parentElement.previousElementSibling.id,a=-1==e.target.id.indexOf("top")?$(t)[0].scrollHeight:0;$(t).animate({scrollTop:a},Y,"swing",function(){$("<style></style>").appendTo($(document.body)).remove()})}function b(){$.ajax({type:"POST",url:"ajax/get_service_options.php"}).done(function(t){$(".reports-form").unmask();var a=JSON.parse(t);a.success&&a.options?(J=a.options,e()):1===a.error?logout():$().toastmessage("showErrorToast","Error loading settings")}).fail(function(){$(".reports-form").unmask(),$().toastmessage("showErrorToast","Error loading settings")})}function g(e,t){$(".reports-form").mask("Loading..."),$.ajax({type:"POST",url:"ajax/get_report.php",data:{type:e,params:JSON.stringify(t)}}).done(function(t){$(".reports-form").unmask();var a=JSON.parse(t);if(a.success)switch(e){case 1:d(a.totals,a.aggregates);break;case 2:l(a.people);break;case 3:u(a.people);break;case 4:p(a.people);break;case 5:m(a.people)}else 1===a.error?logout():$().toastmessage("showErrorToast","Error loading report")}).fail(function(){$(".reports-form").unmask(),$().toastmessage("showErrorToast","Error loading report")})}function k(){$(".reports-form").mask("Loading..."),$.ajax({type:"GET",url:"ajax/get_first_last_service_dates.php"}).done(function(e){var a=JSON.parse(e);a.success?(t(a.first_dt,a.last_dt),b()):1===a.error?logout():$().toastmessage("showErrorToast","Error loading data")}).fail(function(){$(".reports-form").unmask(),$().toastmessage("showErrorToast","Error loading data")})}function S(e,t){var a=e;if(""===a)return!!t;var n=/^(\d{1,2})(\/|-)(\d{1,2})(\/|-)(\d{4})$/,r=a.match(n);if(null===r)return!1;var s=r[1],o=r[3],d=r[5];if(1>s||s>12)return!1;if(1>o||o>31)return!1;if((4==s||6==s||9==s||11==s)&&31==o)return!1;if(2==s){var c=d%4===0&&(d%100!==0||d%400===0);if(o>29||29==o&&!c)return!1}return!0}function T(e){if(e=e||"",null===e.match(/\D/g,"")){var t=e.replace(/\D/g);7===t.length?e=t.substr(0,3)+"-"+t.substr(3):10===t.length&&(e="("+t.substr(0,3)+") "+t.substr(3,3)+"-"+t.substr(6))}return e}function w(){var e=$.trim(O.value);return e&&O.checkValidity()?($(".reports-form").mask("Sending..."),$.ajax({type:"POST",url:"ajax/email_follow_up_summary.php",data:{email:e,params:JSON.stringify(I)}}).done(function(e){$(".reports-form").unmask();var t=JSON.parse(e);t.success?$().toastmessage("showSuccessToast","Summary sent successfully"):1===t.error?logout():$().toastmessage("showErrorToast","Error sending summary")}).fail(function(){$(".reports-form").unmask(),$().toastmessage("showErrorToast","Error sending summary")}),void 0):($().toastmessage("showErrorToast","Must specify a valid email"),void 0)}function A(){var e=$("#include-all-checkboxes input[type=checkbox]");$("#toggle-check").is(":checked")?e.each(function(e,t){t.checked=!0}):e.each(function(e,t){t.checked=!1})}$("#from-date").datepicker(),$("#to-date").datepicker();var E=document.querySelector("#to-date"),x=document.querySelector("#from-date"),D=document.querySelector("#first-date"),M=document.querySelector("#last-date"),P=document.querySelector("#report-type"),F=document.querySelector("#service-label-1"),N=document.querySelector("#service-label-2"),q=document.querySelector("#campus"),j=document.querySelector("#go-arrow"),O=document.querySelector("#email"),L=document.querySelector("#email-summary"),I=null,J={},C=-1,H=-1,z=-1,R="",V={1:"Member",2:"Regular",3:"Irregular"},Y=300;P.value="1",j.addEventListener("click",n),L.addEventListener("click",w),P.addEventListener("change",a),$(".top-bottom-links a").on("click",_),$("#toggle-check").on("change",A),checkLoginStatus(k)}();