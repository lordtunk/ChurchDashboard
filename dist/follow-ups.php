<?php
	session_start();
	include("utils/func.php");
	include("utils/follow_ups.php");
	$f = new Func();
	$followUps = new FollowUps($f);

	if($f->doRedirect($_SESSION)) { header("Location: ".$f->getLoginUrl()); die(); } $success = TRUE; try { $query = "SELECT p.id, p.first_name, p.last_name, p.description FROM People p WHERE p.visitor=true"; $visitors = $f->fetchAndExecute($query); $follow_ups = $followUps->getFollowUpsByDate(date("n/j/Y")); } catch (Exception $e) { $success = FALSE; $f->logMessage($e->getMessage()); } ?><!DOCTYPE html><html lang=en><head><?php include("head.php"); ?><link rel=stylesheet href=styles/main.min.css></head><body><?php include("navbar.php"); ?><div class=container><h1 id=follow-ups>Follow Ups</h1><div class="app-content app-form"><div class="follow-ups-form app-form"><h3 id=follow-ups-form-title>Add Follow Up</h3><div class=follow-ups-form-inner><input type=hidden id=follow-up-id value=-1><div id=follow-up-person-container><label for=follow-up-person>Person:</label><div id=follow-up-person personid=-1>(Select a person)</div><button id=select-person-btn class="btn btn-xs btn-info">Select Person</button></div><label for=follow-up-type>Type:</label><select id=follow-up-type></select><br><label for=follow-up-date>Date:</label> <input type=text id=follow-up-date class=date-field><div id=follow-up-unknown-date-container><label for=unknown-date>Unknown</label> <input type=checkbox id=unknown-date></div><br><label for=follow-up-by>By:</label><div id=follow-up-visitors></div><br><div id=follow-up-frequency-container><label for=follow-up-frequency>Frequency:</label><select id=follow-up-frequency></select></div><div class=communication-card-options style="display: none;"><h4 class="form-section-title commitments-form-section-title">Committing To...</h4><div class="form-section commitments-form-section"><input type=checkbox id=follow-up-commitment-christ> <label for=follow-up-commitment-christ>Committing life to Christ</label><br><input type=checkbox id=follow-up-recommitment-christ> <label for=follow-up-recommitment-christ>Recommitting life to Christ</label><br><input type=checkbox id=follow-up-commitment-tithe> <label for=follow-up-commitment-tithe>Committing to tithe</label><br><input type=checkbox id=follow-up-commitment-ministry> <label for=follow-up-commitment-ministry>Committing to serving in ministry at Guide Church Baptist</label><br><input type=checkbox id=follow-up-commitment-baptism> <label for=follow-up-commitment-baptism>Sign up for the next baptism</label></div><h4 class="form-section-title interested-form-section-title">Interested In...</h4><div class="form-section interested-form-section"><input type=checkbox id=follow-up-info-next> <label for=follow-up-info-next>Interested in attending Next</label><br><input type=checkbox id=follow-up-info-gkids> <label for=follow-up-info-gkids>Get more information on serving in gKids (nursery to age 12)</label><br><input type=checkbox id=follow-up-info-ggroups> <label for=follow-up-info-ggroups>Get more information on joining or hosting a gGroup</label><br><input type=checkbox id=follow-up-info-gteams> <label for=follow-up-info-gteams>Get more information about gTeams</label><br><input type=checkbox id=follow-up-info-member> <label for=follow-up-info-member>Get more information about joining Guide Church Baptist</label><br><input type=checkbox id=follow-up-info-visit> <label for=follow-up-info-visit>I would like a visit from a Guide Church Pastor</label></div></div><label for=follow-up-comments id=follow-up-comments-label>Comments:</label><br><textarea rows=4 cols=40 id=follow-up-comments></textarea></div><div class="form-bar background color--gray-keyline"><button id=add-clear type=button class="btn btn-primary first-button"><span class="glyphicon glyphicon-plus" aria-hidden=true></span>/<span class="glyphicon glyphicon-refresh" aria-hidden=true></span></button><button id=add-copy type=button class="btn btn-primary"><span class="glyphicon glyphicon-plus" aria-hidden=true></span>/<span class="glyphicon glyphicon-copy" aria-hidden=true></span></button><div class=spacer></div><button id=clear type=button class="btn btn-default"><span class="glyphicon glyphicon-refresh" aria-hidden=true></span></button></div></div><label for=follow-ups-for-date>Follow Ups Entered On:</label> <input type=text id=follow-ups-for-date class=date-field> <button id=get-follow-ups class="btn btn-default"><span class="glyphicon glyphicon-arrow-right" aria-hidden=true></span></button><div id=follow-up-table-container><div class=legend><div class=item><div class="legend-icon first-time-visitor"></div><div class=text>First Time Visitor</div></div></div><table class="table table-responsive table-striped" id=follow-up-table><thead><tr><th>Name</th><th>Type</th><th>Date</th><th>By</th><th>Comments</th><th></th></tr></thead><tbody></tbody></table></div></div></div><div class="dialog-form app-form" id=search-form title="Select Person"><label for=search-name>Name</label> <input type=text id=search-name> <button id=search type=button class=button--primary-small><span class="glyphicon glyphicon-search" aria-hidden=true></span></button><div id=search-container><div class=search-table-container id=search-table-container><table class="table table-responsive table-striped search-table" id=search-table><thead><tr><th>Name</th><th>Address</th><th></th></tr></thead><tbody></tbody></table></div></div><div class="form-bar background color--gray-keyline"><button id=add-new-person type=button class="btn btn-primary first-button"><span class="glyphicon glyphicon-plus" aria-hidden=true></span></button><div class=spacer></div><button id=close type=button class="btn btn-default"><span class="glyphicon glyphicon-remove" aria-hidden=true></span></button></div></div><div id=error-container style="display: none;"><div id=error-msg></div><button id=email-error type=button class="btn btn-primary"><span class="glyphicon glyphicon-envelope" aria-hidden=true></span> <span class=btn-text>Email Error</span></button></div><script src=scripts/main.min.js></script><script type=text/javascript>
<?php
	if($success && count($visitors) > 0) {
		echo "var visitors = ".json_encode($visitors).";
		var followUps = ".json_encode($follow_ups).";\n";
	} else {
		echo "$().toastmessage('showErrorToast', 'Error loading visitors');";
	}
?>
		var el = $('#navbar a[id=follow-ups-nav]');
		el.attr('href', '#');
		el.parent().addClass('active');
	</script><script src=scripts/login.js></script><script src=scripts/follow-ups.js></script></body></html>